<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>CHAI JEHYUNG</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="CHAI JEHYUNG"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="CHAI JEHYUNG"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="CHAI JEHYUNG"><meta property="og:url" content="https://westar99.github.io/"><meta property="og:site_name" content="CHAI JEHYUNG"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://westar99.github.io/img/og_image.png"><meta property="article:author" content="John Doe"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://westar99.github.io"},"headline":"CHAI JEHYUNG","image":["https://westar99.github.io/img/og_image.png"],"author":{"@type":"Person","name":"John Doe"},"publisher":{"@type":"Organization","name":"CHAI JEHYUNG","logo":{"@type":"ImageObject","url":"https://westar99.github.io/img/logo.svg"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 6.2.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="CHAI JEHYUNG" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item is-active" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-07-27T22:58:32.000Z" title="2022. 7. 28. 오전 7:58:32">2022-07-28</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-07-28T08:13:08.249Z" title="2022. 7. 28. 오후 5:13:08">2022-07-28</time></span><span class="level-item">5 minutes read (About 722 words)</span></div></div><div class="content"><hr>
<h1 id="title-‘Airflow-amp-Pyspark’"><a href="#title-‘Airflow-amp-Pyspark’" class="headerlink" title="title: ‘Airflow &amp; Pyspark’"></a><strong>title: ‘Airflow &amp; Pyspark’</strong></h1><h1 id="date-‘2022-07-28-09-00’"><a href="#date-‘2022-07-28-09-00’" class="headerlink" title="date: ‘2022-07-28 09:00’"></a><strong>date: ‘2022-07-28 09:00’</strong></h1><hr>
<ul>
<li>에어플로우 튜토리얼 링크</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://airflow.apache.org/docs/apache-airflow/stable/tutorial.html">Tutorial - Airflow Documentation</a></p>
<ul>
<li>데이터 파이프라인</li>
</ul>
<p><a target="_blank" rel="noopener" href="http://www.yes24.com/Product/Goods/107878326">Apache Airflow 기반의 데이터 파이프라인 - YES24</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">import datetime as dt</span><br><span class="line">from datetime import timedelta</span><br><span class="line"></span><br><span class="line">from airflow import DAG</span><br><span class="line">from airflow.operators.bash import BashOperator</span><br><span class="line">from airflow.operators.python import PythonOperator</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line"></span><br><span class="line">def csvToJson():</span><br><span class="line">    df=pd.read_csv(&#x27;data.csv&#x27;)</span><br><span class="line">    for i,r in df.iterrows():</span><br><span class="line">        print(r[&#x27;name&#x27;])</span><br><span class="line">    df.to_json(&#x27;fromAirflow.json&#x27;,orient=&#x27;records&#x27;)</span><br><span class="line"></span><br><span class="line">default_args = &#123;</span><br><span class="line">    &#x27;owner&#x27;: &#x27;evan&#x27;,</span><br><span class="line">    &#x27;start_date&#x27;: dt.datetime(2022, 7, 27),</span><br><span class="line">    &#x27;retries&#x27;: 1,</span><br><span class="line">    &#x27;retry_delay&#x27;: dt.timedelta(minutes=1),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">with DAG(&#x27;MyCSVDAG&#x27;,</span><br><span class="line">         default_args=default_args,</span><br><span class="line">         schedule_interval=timedelta(minutes=1),      # &#x27;0 * * * *&#x27;,</span><br><span class="line">         ) as dag:</span><br><span class="line"></span><br><span class="line">    print_starting = BashOperator(task_id=&#x27;starting&#x27;,</span><br><span class="line">                               bash_command=&#x27;echo &quot;I am reading the CSV now.....&quot;&#x27;)</span><br><span class="line"></span><br><span class="line">    csvJson = PythonOperator(task_id=&#x27;convertCSVtoJson&#x27;,</span><br><span class="line">                                 python_callable=csvToJson)</span><br><span class="line"></span><br><span class="line">print_starting &gt;&gt; csvJson</span><br></pre></td></tr></table></figure>

<p>—&gt;중간에 data.csv를 dags&#x2F;data.csv로 위치 변경해줌</p>
<ul>
<li><p>가상환경에서 에어플로우 실행</p>
</li>
<li><p>리눅스(우분투)실행</p>
<p>  <img src="/images/220728/Untitled2.png" alt="png"></p>
</li>
<li><p>vs코드 실행되면서  아래와 같이 쳐줌</p>
</li>
<li><p>source venv&#x2F;bin&#x2F;activate (가상환경설정)</p>
</li>
<li><p>airflow db reset (데이터베이스 리셋)</p>
</li>
<li><p>airflow webserver -p 8081 (로컬호스트 명 결정)</p>
<p>  <img src="/images/220728/Untitled3.png" alt="png"></p>
<p>  <img src="/images/220728/Untitled4.png" alt="png"></p>
</li>
<li><p>다른 터미널을 열고 airflow scheduler 실행</p>
</li>
<li><p>웹사이트에 localhost:8081 실행</p>
</li>
<li><p>아이디와 암호를 넣으면 에어플로어가 돌아간다</p>
</li>
</ul>
<h2 id="아파치-스파크"><a href="#아파치-스파크" class="headerlink" title="아파치 스파크"></a>아파치 스파크</h2><ul>
<li><p>폴더를 만들고 다음과 같이 친다.</p>
<p>  <img src="/images/220728/Untitled5.png" alt="png"></p>
</li>
<li><p><code>sudo apt-get install openjdk-8-jdk</code></p>
</li>
<li><p><code>sudo wget [https://archive.apache.org/dist/spark/spark-3.2.0/spark-3.2.0-bin-hadoop3.2.tgz](https://archive.apache.org/dist/spark/spark-3.2.0/spark-3.2.0-bin-hadoop3.2.tgz)</code> (압축파일을 다운로드 받음)</p>
</li>
<li><p>mv 는 폴더를 통체로 옮기는 명령어이다.</p>
<p>  <img src="/images/220728/Untitled6.png" alt="png"></p>
<p>  <img src="/images/220728/Untitled7.png" alt="png"></p>
<p>  <img src="/images/220728/Untitled8.png" alt="png"></p>
<p>  <img src="/images/220728/Untitled9.png" alt="png"></p>
</li>
<li><p>직렬 방식은 처리 시간이 느리지만  구글의 병렬방식(hadoop)로  처리하면 빠르다. 이를 더 업그래이드 시킨 것이 spark이다. (분산처리 방식)</p>
</li>
</ul>
<p><img src="/images/220728/Untitled10.png" alt="png"></p>
<p>mv이동 cp복사</p>
<ul>
<li><p>cp -r spark3&#x2F; spark-node # spar3를 spark-node로 복사하라.</p>
<p>  <img src="/images/220728/Untitled11.png" alt="png"></p>
<p>  <img src="/images/220728/Untitled12.png" alt="png"></p>
</li>
<li><p>리눅스(우분투)로 들어가서 환경변수를 설정해야 한다.</p>
</li>
<li><p>vi ~&#x2F;.bashrc  를 넣으면 환경설정에 들어간다.(i 눌러야 키가 들어가고 끝나면 esc)</p>
</li>
<li><p>환경변수편집과 같은 것.</p>
<p>  <img src="/images/220728/Untitled13.png" alt="png"></p>
</li>
</ul>
<p>export AIRFLOW_HOME&#x3D;&#x2F;home&#x2F;human&#x2F;airflow<br>export JAVA_HOME&#x3D;&#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;java-8-openjdk-amd64<br>export SPARK_HOME&#x3D;&#x2F;home&#x2F;human&#x2F;spark3<br>export PATH&#x3D;$SPARK_HOME&#x2F;bin:$PATH<br>export PYSPARK_PYTHON&#x3D;python3<br>export PYSPARK_DRIVER_PYTHON&#x3D;jupyter<br>export PYSAPRK_DRIVER_PYTHON_OPTS&#x3D;’notebook’</p>
<ul>
<li><p>:wq!를 쳐주면 터미널로 나간다.(wright quit!)</p>
</li>
<li><p>source ~&#x2F;.bashrc 하면 저장이 됨</p>
</li>
<li><p>리스타트를 하고 pyspark를 써주면 이런 화면이 나온다.</p>
<p>  <img src="/images/220728/Untitled14.png" alt="png"></p>
<p>  <img src="/images/220728/Untitled15.png" alt="png"></p>
<p>  <img src="/images/220728/Untitled16.png" alt="png"></p>
<p>  → 가상환경을 만들어 준다.</p>
<ul>
<li>pip3 install pyspark</li>
<li>pip3 install findspark</li>
<li>pip3 install jupyter 를 차례대로 실행하여 깔아준다.</li>
</ul>
<p>  → 새 터미널 bash를 띄워서 편집을 해야 한다. 안그러면 가상환경이 풀린다.</p>
<p>  <img src="/images/220728/Untitled17.png" alt="png"></p>
<p>  vi ~&#x2F;.bashrc (</p>
<p>  source ~&#x2F;.bashrc</p>
<p>  jupyter notebook</p>
<p>  <img src="/images/220728/Untitled18.png" alt="png"></p>
<p>  <img src="/images/220728/Untitled19.png" alt="png"></p>
<p>  <img src="/images/220728/Untitled20.png" alt="png"></p>
</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-07-27T08:07:35.835Z" title="2022. 7. 27. 오후 5:07:35">2022-07-27</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-07-27T08:15:57.506Z" title="2022. 7. 27. 오후 5:15:57">2022-07-27</time></span><span class="level-item">10 minutes read (About 1522 words)</span></div></div><div class="content"><hr>
<h1 id="title-request로-웹페이지-문서-불러오기"><a href="#title-request로-웹페이지-문서-불러오기" class="headerlink" title="title: request로 웹페이지 문서 불러오기"></a><strong>title: request로 웹페이지 문서 불러오기</strong></h1><h1 id="date-‘2022-07-26-09-00’"><a href="#date-‘2022-07-26-09-00’" class="headerlink" title="date: ‘2022-07-26 09:00’"></a><strong>date: ‘2022-07-26 09:00’</strong></h1><hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://www.naver.com&quot;</span></span><br><span class="line"></span><br><span class="line">req = requests.get(url) <span class="comment"># 웹내용을 텍스트로 만들어줌.</span></span><br><span class="line"><span class="built_in">print</span>(req.status_code) <span class="comment"># 웹페이지가 존재하면 200이라는 숫자가 뜬다. 웹페이지가 없으면 404가 생김</span></span><br><span class="line"><span class="comment">#print(req.text)</span></span><br></pre></td></tr></table></figure>

<pre><code>200
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crawling</span>(<span class="params">soup</span>): <span class="comment"># 크롤링할 클래스 명을 찾아서 넣으면 됨</span></span><br><span class="line">  div = soup.find(<span class="string">&quot;div&quot;</span>,class_ = <span class="string">&quot;list_issue&quot;</span>)</span><br><span class="line">  <span class="comment">#print(div)</span></span><br><span class="line">  result = []</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> a <span class="keyword">in</span> div.find_all(<span class="string">&quot;a&quot;</span>):</span><br><span class="line">    <span class="comment">#print(a.get_text())</span></span><br><span class="line">    result.append(a.get_text())</span><br><span class="line"></span><br><span class="line">  links = []</span><br><span class="line">  <span class="keyword">for</span> a <span class="keyword">in</span> div.find_all(<span class="string">&quot;a&quot;</span>):</span><br><span class="line">    <span class="comment">#print(a[&#x27;href&#x27;])</span></span><br><span class="line">    <span class="comment">#result.append(a.get_text())</span></span><br><span class="line">    links.append(a[<span class="string">&#x27;href&#x27;</span>])</span><br><span class="line"></span><br><span class="line">  <span class="built_in">print</span>(result)</span><br><span class="line">  <span class="built_in">print</span>(links)</span><br><span class="line">  <span class="comment">#new_list = pd.DataFrame(&#123;&#x27;제목&#x27;: result,&#x27;링크&#x27;: links&#125;)</span></span><br><span class="line">   </span><br><span class="line">  <span class="comment">#return new_list</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;Main&quot;</span>)</span><br><span class="line"></span><br><span class="line">  url =<span class="string">&quot;https://www.naver.com/&quot;</span></span><br><span class="line">  req = requests.get(url)</span><br><span class="line">  soup = BeautifulSoup(req.text,<span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line"></span><br><span class="line">  crawling(soup)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">  main()</span><br></pre></td></tr></table></figure>

<pre><code>Main
[&quot;&#39;행안부 경찰국 신설안&#39; 국무회의 통과…내달 2일 공포&quot;, &#39;한동훈 &quot;사면, 대통령 고유권한…기준·방향 말하는건 부적절&quot;&#39;, &#39;尹, 한동훈에 &quot;부정부패 엄정대응…기업위축 과도한 형벌 개선&quot;&#39;, &#39;한총리 &quot;흥청망청 재정, 타이트한 재정으로…건전성 회복 목표&quot;&#39;, &#39;국방부 &quot;유엔사, 판문점 통과 허용한 것…북송 승인 의미 아냐&quot;&#39;, &#39;BA.5 사실상 우세종…국내감염 검출률 49.1%, 해외 합치면 56.3%&#39;, &#39;&quot;금리 1%p 더 오르면 대출자 97만명, 2금융권서도 밀려나&quot;&#39;, &#39;한국인 기대수명 83.5세로 증가…외래진료 1년에 14.7번 간다&#39;, &#39;용산정비창, 초고층 복합업무지구로 탈바꿈…&quot;롯데타워급 가능&quot;&#39;, &#39;대우조선 경영진 &quot;책임 통감…위기 극복하고 거취 포함 책임질 것&quot;&#39;]
[&#39;https://news.naver.com/main/list.naver?mode=LPOD&amp;mid=sec&amp;sid1=001&amp;sid2=140&amp;oid=001&amp;isYeonhapFlash=Y&amp;aid=0013334288&#39;, &#39;https://news.naver.com/main/list.naver?mode=LPOD&amp;mid=sec&amp;sid1=001&amp;sid2=140&amp;oid=001&amp;isYeonhapFlash=Y&amp;aid=0013334689&#39;, &#39;https://news.naver.com/main/list.naver?mode=LPOD&amp;mid=sec&amp;sid1=001&amp;sid2=140&amp;oid=001&amp;isYeonhapFlash=Y&amp;aid=0013334556&#39;, &#39;https://news.naver.com/main/list.naver?mode=LPOD&amp;mid=sec&amp;sid1=001&amp;sid2=140&amp;oid=001&amp;isYeonhapFlash=Y&amp;aid=0013335408&#39;, &#39;https://news.naver.com/main/list.naver?mode=LPOD&amp;mid=sec&amp;sid1=001&amp;sid2=140&amp;oid=001&amp;isYeonhapFlash=Y&amp;aid=0013334533&#39;, &#39;https://news.naver.com/main/list.naver?mode=LPOD&amp;mid=sec&amp;sid1=001&amp;sid2=140&amp;oid=001&amp;isYeonhapFlash=Y&amp;aid=0013335089&#39;, &#39;https://news.naver.com/main/list.naver?mode=LPOD&amp;mid=sec&amp;sid1=001&amp;sid2=140&amp;oid=001&amp;isYeonhapFlash=Y&amp;aid=0013334570&#39;, &#39;https://news.naver.com/main/list.naver?mode=LPOD&amp;mid=sec&amp;sid1=001&amp;sid2=140&amp;oid=001&amp;isYeonhapFlash=Y&amp;aid=0013334595&#39;, &#39;https://news.naver.com/main/list.naver?mode=LPOD&amp;mid=sec&amp;sid1=001&amp;sid2=140&amp;oid=001&amp;isYeonhapFlash=Y&amp;aid=0013334642&#39;, &#39;https://news.naver.com/main/list.naver?mode=LPOD&amp;mid=sec&amp;sid1=001&amp;sid2=140&amp;oid=001&amp;isYeonhapFlash=Y&amp;aid=0013335458&#39;]
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crawling</span>(<span class="params">soup</span>): </span><br><span class="line">  tbody = soup.find(<span class="string">&quot;tbody&quot;</span>)</span><br><span class="line">  <span class="comment">#print(tbody)</span></span><br><span class="line">  </span><br><span class="line">  result = []</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> p <span class="keyword">in</span> tbody.find_all(<span class="string">&quot;p&quot;</span>,class_ = <span class="string">&quot;title&quot;</span>):</span><br><span class="line">    result.append(p.find(<span class="string">&quot;a&quot;</span>).get_text())</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">  </span><br><span class="line">  url =<span class="string">&quot;https://music.bugs.co.kr/chart&quot;</span></span><br><span class="line">  req = requests.get(url)</span><br><span class="line">  soup = BeautifulSoup(req.text,<span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">print</span>(crawling(soup))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">   main()</span><br></pre></td></tr></table></figure>

<pre><code>[&#39;Somebody!&#39;, &#39;그때 그 순간 그대로 (그그그)&#39;, &#39;SNEAKERS&#39;, &#39;POP!&#39;, &#39;보고싶었어&#39;, &#39;Girls&#39;, &#39;LOVE DIVE&#39;, &#39;그라데이션&#39;, &#39;Sparkling&#39;, &#39;사랑이야&#39;, &quot;I Ain&#39;t Worried&quot;, &#39;Clink Clink (클링 클링)&#39;, &#39;열이올라요 (Heart Burn)&#39;, &#39;That That (prod. &amp; feat. SUGA of BTS)&#39;, &#39;도깨비불 (Illusion)&#39;, &#39;Nerdy&#39;, &#39;BEAUTIFUL MONSTER&#39;, &#39;없었던 일로&#39;, &#39;TOMBOY&#39;, &#39;Stay This Way&#39;, &#39;FEARLESS&#39;, &#39;정이라고 하자 (Feat. 10CM)&#39;, &#39;안하기가 쉽지 않아요&#39;, &#39;나의 X에게&#39;, &#39;SuMMer RaiN&#39;, &#39;ELEVEN&#39;, &#39;GANADARA (Feat. 아이유)&#39;, &#39;Happy Birthday&#39;, &#39;I LOVE U&#39;, &#39;Skydivin’&#39;, &#39;I Like You (A Happier Song) (feat. Doja Cat)&#39;, &#39;Love story&#39;, &#39;Left and Right (Feat. Jung Kook of BTS)&#39;, &#39;사랑인가 봐&#39;, &quot;That&#39;s Hilarious&quot;, &quot;바보에게 바보가 (웹툰 &#39;연애의 발견&#39; X 이석훈)&quot;, &#39;Feel My Rhythm&#39;, &#39;LOVE me&#39;, &#39;말리지 마&#39;, &#39;러브 쉿!&#39;, &#39;Next Level&#39;, &#39;팡파레&#39;, &#39;사랑할 수 없는 너에게&#39;, &#39;신호등&#39;, &#39;다 거짓말일 뿐인걸&#39;, &#39;MY BAG&#39;, &#39;봄여름가을겨울 (Still Life)&#39;, &#39;나빌레라&#39;, &#39;STAY&#39;, &#39;드라마&#39;, &#39;Life′s Too Short (English Ver.)&#39;, &#39;_WORLD&#39;, &#39;늦은 밤 헤어지긴 너무 아쉬워&#39;, &#39;취중고백&#39;, &#39;다정히 내 이름을 부르면&#39;, &#39;Copycat&#39;, &#39;Weekend&#39;, &#39;Hold My Hand&#39;, &#39;너의 모든 순간&#39;, &#39;SMILEY (Feat. BIBI)&#39;, &#39;INVU&#39;, &#39;낙하 (with 아이유)&#39;, &#39;strawberry moon&#39;, &#39;기울이면&#39;, &#39;아무래도 난&#39;, &#39;Yet To Come&#39;, &#39;너에게 꼭 말하고 싶은 게 있어&#39;, &#39;해요 (2022)&#39;, &#39;온통 그대뿐인 나죠&#39;, &#39;참고사항&#39;, &#39;내가 아니라도&#39;, &#39;봄 to 러브&#39;, &#39;듣고 싶을까&#39;, &#39;2step (feat. Lil Baby)&#39;, &#39;Seoul&#39;, &#39;Off My Face&#39;, &#39;어마어마해&#39;, &#39;너를 생각해&#39;, &#39;Drive&#39;, &#39;사랑은 늘 도망가&#39;, &#39;마지막 너의 인사&#39;, &#39;Antifreeze&#39;, &#39;우리들의 블루스&#39;, &#39;스티커 사진&#39;, &#39;낭만교향곡 (Feat. CHANGMO, 박재범)&#39;, &#39;Celebrity&#39;, &#39;어쩌면 우리 (Feat. 죠지)&#39;, &#39;모든 날, 모든 순간 (Every day, Every Moment)&#39;, &#39;Playlist&#39;, &#39;Light Switch&#39;, &#39;도둑놈 (Feat. 민니 of (여자)아이들)&#39;, &#39;Better Than Birthday&#39;, &#39;Dynamite&#39;, &#39;SEOUL DRIFT&#39;, &#39;Blueming&#39;, &#39;Happy Song&#39;, &#39;HOT&#39;, &#39;라일락&#39;, &#39;오르트구름&#39;, &#39;Wrapped Around Your Finger&#39;]
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crawling</span>(<span class="params">soup</span>): <span class="comment"># 크롤링할 클래스 명을 찾아서 넣으면 됨</span></span><br><span class="line">  div = soup.find(<span class="string">&quot;div&quot;</span>,class_ = <span class="string">&quot;list_issue&quot;</span>)</span><br><span class="line">  <span class="comment">#print(div)</span></span><br><span class="line">  result = []</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> a <span class="keyword">in</span> div.find_all(<span class="string">&quot;a&quot;</span>):</span><br><span class="line">    <span class="comment">#print(a.get_text())</span></span><br><span class="line">    result.append(a.get_text())</span><br><span class="line"></span><br><span class="line">  links = []</span><br><span class="line">  <span class="keyword">for</span> a <span class="keyword">in</span> div.find_all(<span class="string">&quot;a&quot;</span>):</span><br><span class="line">    <span class="comment">#print(a[&#x27;href&#x27;])</span></span><br><span class="line">    links.append(a[<span class="string">&#x27;href&#x27;</span>])</span><br><span class="line"></span><br><span class="line">  <span class="comment">#print(result)</span></span><br><span class="line">  <span class="comment">#print(links)</span></span><br><span class="line">  new_list = pd.DataFrame(&#123;<span class="string">&#x27;제목&#x27;</span>: result,<span class="string">&#x27;링크&#x27;</span>: links&#125;)</span><br><span class="line">  <span class="built_in">print</span>(new_list) </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;Main&quot;</span>)</span><br><span class="line"></span><br><span class="line">  url =<span class="string">&quot;https://www.naver.com/&quot;</span></span><br><span class="line">  req = requests.get(url)</span><br><span class="line">  soup = BeautifulSoup(req.text,<span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line"></span><br><span class="line">  crawling(soup)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">  main()</span><br></pre></td></tr></table></figure>

<pre><code>Main
                                          제목  \
0             &quot;쿠데타&quot; &quot;국기문란&quot; 경고에 경찰국 신설 갈등 최고조   
1          한동훈 &quot;사면, 대통령 고유권한…기준·방향 말하는건 부적절&quot;   
2            尹, 한동훈에 &quot;기업활동 위축 과도한 형벌규정 개선하라&quot;   
3                 한일의원연맹 신임 회장에 정진석…간사장엔 윤호중   
4        국방부 &quot;유엔사, 판문점 통과 허용한 것…북송 승인 의미 아냐&quot;   
5  BA.5 사실상 우세종…국내감염 검출률 49.1%, 해외 합치면 56.3%   
6      노무라 &quot;올해 한국 성장률 전망치 1.7%로 하향…3분기 침체시작&quot;   
7                     서울 전역에 오존주의보…&quot;실외활동 자제&quot;   
8       한국인 기대수명 83.5세로 증가…외래진료 1년에 14.7번 간다   
9            대통령실 이전·국제업무지구 개발 &#39;겹호재&#39;…들썩이는 용산   

                                                  링크  
0  https://news.naver.com/main/list.naver?mode=LP...  
1  https://news.naver.com/main/list.naver?mode=LP...  
2  https://news.naver.com/main/list.naver?mode=LP...  
3  https://news.naver.com/main/list.naver?mode=LP...  
4  https://news.naver.com/main/list.naver?mode=LP...  
5  https://news.naver.com/main/list.naver?mode=LP...  
6  https://news.naver.com/main/list.naver?mode=LP...  
7  https://news.naver.com/main/list.naver?mode=LP...  
8  https://news.naver.com/main/list.naver?mode=LP...  
9  https://news.naver.com/main/list.naver?mode=LP...  
</code></pre>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-07-26T22:59:24.000Z" title="2022. 7. 27. 오전 7:59:24">2022-07-27</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-07-28T07:57:41.390Z" title="2022. 7. 28. 오후 4:57:41">2022-07-28</time></span><span class="level-item">8 minutes read (About 1179 words)</span></div></div><div class="content"><hr>
<h1 id="title-리눅스-깔기"><a href="#title-리눅스-깔기" class="headerlink" title="title: 리눅스 깔기"></a><strong>title: 리눅스 깔기</strong></h1><h1 id="date-‘2022-07-27-09-00’"><a href="#date-‘2022-07-27-09-00’" class="headerlink" title="date: ‘2022-07-27 09:00’"></a><strong>date: ‘2022-07-27 09:00’</strong></h1><hr>
<p><a target="_blank" rel="noopener" href="https://www.44bits.io/ko/post/wsl2-install-and-basic-usage">WSL2(Windows Subsystem for Linux 2) 설치 및 사용 방법</a></p>
<h2 id="1단계"><a href="#1단계" class="headerlink" title="1단계"></a>1단계</h2><ul>
<li><p>검색에 PC정보를 확인- 원도10 21H2</p>
<ul>
<li>하이퍼바이저 플랫폼을 체크하면 윈도우가 재가동한다.</li>
</ul>
<p>  <img src="/images/220727/Untitled.png" alt="png"></p>
</li>
</ul>
<h2 id="2단계"><a href="#2단계" class="headerlink" title="2단계"></a>2단계</h2><ul>
<li><p>powershell을 관리자로 실행</p>
</li>
<li><p><code>dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart</code></p>
</li>
<li><p><code>dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart</code></p>
</li>
<li><p>재부팅함</p>
<p>  <img src="/images/220727/Untitled1.png" alt="png"></p>
</li>
</ul>
<h2 id="3단계"><a href="#3단계" class="headerlink" title="3단계"></a>3단계</h2><ul>
<li><p><code>[https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi](https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi)</code></p>
</li>
<li><p>리눅스셋업위자드를 다운받아서 실행.</p>
<p>  <img src="/images/220727/Untitled2.png" alt="png"></p>
</li>
<li><p>참조(<code>Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V -All</code></p>
</li>
</ul>
<h2 id="4단계"><a href="#4단계" class="headerlink" title="4단계"></a>4단계</h2><ul>
<li>마이크로소프트 스토어에서 우분투를 치고 다음과 같은 버전을 설치</li>
</ul>
<p><img src="/images/220727/Untitled3.png" alt="png"></p>
<p><img src="/images/220727/Untitled4.png" alt="png"></p>
<ul>
<li><p>참조)가상환경이 설정안되면 위와같이 뜬다. 1단계 하이퍼바이져 실행 확인</p>
</li>
<li><p>우분트를 실행하면 유저명과 암호를 넣으라고 나온다.</p>
<p>  <img src="/images/220727/Untitled5.png" alt="png"></p>
</li>
<li><p>유저명과 암호를 입력(human 1234)</p>
<p>  <img src="/images/220727/Untitled6.png" alt="png"></p>
</li>
</ul>
<h2 id="5단계-버전확인"><a href="#5단계-버전확인" class="headerlink" title="5단계 버전확인"></a>5단계 버전확인</h2><ul>
<li><p>(파워셀을 지우고) 다시 관리자 파워셀 실행 후 명령어 입력</p>
</li>
<li><p><code>wsl --set-default-version 2</code></p>
<p>  <img src="/images/220727/Untitled7.png" alt="png"></p>
</li>
<li><p>재부팅을 하면 wsl설치 완료</p>
</li>
<li><p>wsl  -l   -v  (버전 확인해봄)</p>
<p>  <img src="/images/220727/Untitled8.png" alt="png"></p>
</li>
</ul>
<h2 id="변수-확인"><a href="#변수-확인" class="headerlink" title="변수 확인"></a>변수 확인</h2><p>- </p>
<pre><code>![png](images/220727/Untitled9.png)

![png](images/220727/Untitled10.png)

![png](images/220727/Untitled11.png)
</code></pre>
<p>C:\Users\human\AppData\Local\Programs\Microsoft VS Code\bin</p>
<p>- </p>
<pre><code>![png](images/220727/Untitled12.png)
</code></pre>
<ul>
<li>빅데이터 플랫폼 구축&#x2F;웹사이트 구축 시 configuration이 되기 위해서 각 설치 프로그램끼리 환경변수로 유기적으로 연결되어져야 함</li>
<li>비주얼 스튜디오 키기</li>
<li>remote wsl 설치 후 재부팅</li>
</ul>
<p><img src="/images/220727/Untitled13.png" alt="png"></p>
<p><img src="/images/220727/Untitled14.png" alt="png"></p>
<h2 id="1-리눅스를-공부하자"><a href="#1-리눅스를-공부하자" class="headerlink" title="1.리눅스를 공부하자"></a>1.리눅스를 공부하자</h2><ul>
<li><p>초기 디렉토리는 이렇게 생겼다. home이나 mnt에 설치하는게 좋다.</p>
<p>  <img src="/images/220727/Untitled15.png" alt="png"></p>
</li>
<li><p>cd(한칸띄고).. #전 단계로 넘어감</p>
</li>
<li><p>참고) ls #(&#x3D;dir) pwd(현제위치) mkdir ariflow(에어플로 폴더 제작)rm -rf *(모두지움)</p>
</li>
<li><p>cd mnt # 컴퓨터 c, d 드라이브가 보임</p>
</li>
<li><p>cd c #c드라이브로 들어감</p>
</li>
<li><p>cd 폴더 # 항상 텝을 눌러서 오타를 방지</p>
</li>
<li><p>code(한칸띄고) . # 비쥬얼 스튜디오 코드가 열림</p>
<p>  <img src="/images/220727/Untitled16.png" alt="png"></p>
</li>
<li><p>sudo apt-get update</p>
</li>
<li><p>sudo apt install python3-pip # 업데이트가 필요→y를 눌러줌</p>
</li>
<li><p>sudo pip3 install virtualenv #전에 친 명령어가 있으면 위화살표를 눌러주면 명령어 반복이 됨</p>
</li>
<li><p>virtualenv venv #가상환경 만들어 주기↔deactivate(가상환경에서 빠져나감)</p>
</li>
<li><p>source venv&#x2F;bin&#x2F;activate #가상환경에 들어가기(리눅스에는 bin이 필요함)</p>
</li>
</ul>
<p>— 가능하면 윈도우10에서 권장하는 home&#x2F;human[유저네임]&#x2F;airflow 폴더에 설치하자.</p>
<h3 id="환경변수-설정-가상환경을-만들어-라이브러리를-설치하기-위한-작업"><a href="#환경변수-설정-가상환경을-만들어-라이브러리를-설치하기-위한-작업" class="headerlink" title="환경변수 설정(가상환경을 만들어 라이브러리를 설치하기 위한 작업)"></a>환경변수 설정(가상환경을 만들어 라이브러리를 설치하기 위한 작업)</h3><p>- </p>
<pre><code>![png](images/220727/Untitled17.png)
</code></pre>
<ul>
<li><p>pwd #현재 경로를 알려줌(&#x2F;home&#x2F;human&#x2F;airflow)</p>
</li>
<li><p>vi 편집기를  사용해야 됨.</p>
</li>
<li><p>vi ~&#x2F;.bashrc #환경설정(배쉬알씨)</p>
<p>  <img src="/images/220727/Untitled18.png" alt="png"></p>
</li>
<li><p>insert 모드로 들어가기 위해  맨끝에서 i를 누름</p>
</li>
<li><p>환경변수 설정 - export AIRFLOW_HOME&#x3D;&#x2F;home&#x2F;human&#x2F;airflow#빈칸이 있으면 안됨:</p>
</li>
</ul>
<p><img src="/images/220727/Untitled19.png" alt="png"></p>
<ul>
<li><p>esc버튼을 누르면 insert가 사라짐</p>
</li>
<li><p>쉬프트 콜론을 누르면 세미클론이 나옴</p>
</li>
<li><p>wq! #엔터치면 터미널로 나옴 →q!는 저장을 안함</p>
</li>
<li><p>앞줄에서 d를 두번누르면 싹 지워진다.</p>
</li>
<li><p>source ~&#x2F;.bashrc #시스템에 반영</p>
<p>  <img src="/images/220727/Untitled20.png" alt="png"></p>
</li>
<li><p>다시 가상환경을 들어가기 위해 source venv&#x2F;bin&#x2F;activate 를 넣어주고</p>
</li>
<li><p>echo $AIRFLOW_HOME을 쳐주면 경로가 반영(echo)pip됨.&#x2F;mnt&#x2F;c&#x2F;dataEngineering-확인작업</p>
</li>
</ul>
<h2 id="아파치-에어플로를-설치해보자"><a href="#아파치-에어플로를-설치해보자" class="headerlink" title="아파치 에어플로를 설치해보자"></a>아파치 에어플로를 설치해보자</h2><blockquote>
<blockquote>
<p>pip3 install ‘apache-airflow[postgres,slack,celery]’(복사하면 안들어감 타자 치세요)</p>
</blockquote>
</blockquote>
<ul>
<li><p>아파치 에어플로의 셀러리 포스트그레스 슬랙을 설치</p>
<p>  <img src="/images/220727/Untitled21.png" alt="png"></p>
</li>
</ul>
<blockquote>
<blockquote>
<p>airflow db init</p>
</blockquote>
</blockquote>
<ul>
<li><p>에어플로의 데이터 베이스 초기화</p>
<p>  <img src="/images/220727/Untitled22.png" alt="png"></p>
</li>
<li><p>먼저 유저네임과 패스워드를 입력해 줘야 한다.</p>
<p>  <code>airflow users create --username airflow --password airflow --firstname evaㅁn --lastname airflow --role Admin --email your_email@some.com</code></p>
</li>
</ul>
<blockquote>
<blockquote>
<p>airflow webserver -p 8081(복사하면 스몰피가 라지피가 된다)</p>
</blockquote>
</blockquote>
<ul>
<li><p>에어플로 웹서버를 실행(기본적으로 8080포트에서 실행되지만 p로 바꿔줄 수 있다)</p>
<p>  <img src="/images/220727/Untitled23.png" alt="png"></p>
<ul>
<li><a target="_blank" rel="noopener" href="http://localhost:8081/">http://localhost:8081/</a> # 웹 빈창에 쓰면 다음과 같은 화면이 나온다.</li>
</ul>
<p>  <img src="/images/220727/Untitled24.png" alt="png"></p>
<p>  -아이디 암호는 airflow</p>
<p>  <img src="/images/220727/Untitled25.png" alt="png">
  </p>
</li>
<li><p>판다스 설치</p>
<p>  <img src="/images/220727/Untitled26.png" alt="png"></p>
<ul>
<li>pip3 install faker pandas</li>
</ul>
<p>  <img src="/images/220727/Untitled27.png" alt="png"></p>
<ul>
<li>판다스의 버전 확인</li>
</ul>
<p>  <a target="_blank" rel="noopener" href="https://docs.microsoft.com/ko-kr/windows/wsl/setup/environment#file-storage">WSL 개발 환경 설정</a></p>
</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-07-25T08:12:31.638Z" title="2022. 7. 25. 오후 5:12:31">2022-07-25</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-07-25T08:14:59.635Z" title="2022. 7. 25. 오후 5:14:59">2022-07-25</time></span><span class="level-item">5 minutes read (About 712 words)</span></div></div><div class="content"><hr>
<h1 id="title-‘크롤링-및-함수’"><a href="#title-‘크롤링-및-함수’" class="headerlink" title="title: ‘크롤링 및 함수’"></a><strong>title: ‘크롤링 및 함수’</strong></h1><h1 id="date-‘2022-07-25-09-00’"><a href="#date-‘2022-07-25-09-00’" class="headerlink" title="date: ‘2022-07-25 09:00’"></a><strong>date: ‘2022-07-25 09:00’</strong></h1><hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"></span><br><span class="line"><span class="comment">#경로</span></span><br><span class="line"><span class="comment">#url = &#x27;C:\\chatbot\\&#x27;</span></span><br><span class="line">driver = webdriver.Chrome(<span class="string">&#x27;chromedriver.exe&#x27;</span>)</span><br><span class="line"><span class="comment">#movieURL = &#x27;https://movie.naver.com/movie/bi/mi/pointWriteFormList.naver?code=38899&amp;type=after&amp;isActualPointWriteExecute=false&amp;isMileageSubscriptionAlready=false&amp;isMileageSubscriptionReject=false&#x27;</span></span><br><span class="line">url = <span class="string">&quot;https://www.naver.com&quot;</span></span><br><span class="line">driver.get(url)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<pre><code>C:\Users\human\AppData\Local\Temp\ipykernel_11136\640968799.py:6: DeprecationWarning: executable_path has been deprecated, please pass in a Service object
  driver = webdriver.Chrome(&#39;chromedriver.exe&#39;)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#step1</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cnt_letter</span>(<span class="params">content,letter</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;문자를 세는 함수입니다.!!</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        content(str): 탐색 문자열</span></span><br><span class="line"><span class="string">        letter(str): 찾을 문자열</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        int</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Raises:</span></span><br><span class="line"><span class="string">        valueError: 만약 Return값이 문자가 아니면 에러를 발생시킨다.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>    </span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;함수 테스트!&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">not</span> <span class="built_in">isinstance</span>(letter, <span class="built_in">str</span>)) <span class="keyword">or</span> <span class="built_in">len</span>(letter) != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&#x27;`letter` 반드시 숫자여야 합니다.&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">len</span>([char <span class="keyword">for</span> char <span class="keyword">in</span> content <span class="keyword">if</span> char == letter]))</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment">#print(cnt_letter())</span></span><br><span class="line">    docstring = cnt_letter.__doc__</span><br><span class="line"></span><br><span class="line">    border = <span class="string">&quot;#&quot;</span>*<span class="number">28</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&#123;&#125;\n&#123;&#125;\n&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(border, docstring, border))</span><br><span class="line"></span><br><span class="line">    cal = cnt_letter(<span class="string">&quot;abcabcabcb&quot;</span>,<span class="string">&quot;b&quot;</span>) <span class="comment"># b가 총 4개</span></span><br><span class="line">    <span class="built_in">print</span> (cal)</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&quot;---------------&quot;</span>)</span><br><span class="line">    <span class="comment"># print (help(cnt_letter))</span></span><br></pre></td></tr></table></figure>

<pre><code>############################
문자를 세는 함수입니다.!!
    Args:
        content(str): 탐색 문자열
        letter(str): 찾을 문자열
    
    Returns:
        int

    Raises:
        valueError: 만약 Return값이 문자가 아니면 에러를 발생시킨다.
    
############################
함수 테스트!
4
---------------
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#step2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 함수에서 list 사용 시 주의할 점- 반복하면서 늘어날 수 있다.</span></span><br><span class="line"><span class="comment"># list vs tuple </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list_a</span>(<span class="params">var=[]</span>):</span><br><span class="line">     var.append(<span class="number">1</span>)</span><br><span class="line">     <span class="keyword">return</span> var</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list_b</span>(<span class="params">var=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> var <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        var=[]</span><br><span class="line">    var.append(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> var        </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(list_a())</span><br><span class="line">    <span class="built_in">print</span>(list_a())</span><br><span class="line">    <span class="built_in">print</span>(list_a())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-----&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(list_b())</span><br><span class="line">    <span class="built_in">print</span>(list_b())</span><br><span class="line">    <span class="built_in">print</span>(list_b())</span><br></pre></td></tr></table></figure>

<pre><code>[1]
[1, 1]
[1, 1, 1]
-----
[1]
[1]
[1]
</code></pre>
<ul>
<li>text 파일에 있는 글자를 불러와서 단어의 갯수를 세어본다.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#step3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># fun_class./data</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;파일 불러오기 시작&quot;</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;data/fun.txt&quot;</span>,encoding=<span class="string">&quot;utf=8&quot;</span>)<span class="keyword">as</span> file:</span><br><span class="line">        text = file.read()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;파일 불러오기 완료&quot;</span>)</span><br><span class="line"></span><br><span class="line">    n = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> text.split():</span><br><span class="line">        <span class="keyword">if</span> word <span class="keyword">in</span> [<span class="string">&#x27;개인정보&#x27;</span>,<span class="string">&#x27;메타가&#x27;</span>]:</span><br><span class="line">            n +=<span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;단어의 갯수=&quot;</span>,n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">   main()   </span><br><span class="line">   </span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#step4</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">db_create</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;DB 생성시작&quot;</span>)</span><br><span class="line"></span><br><span class="line">    conn = sqlite3.connect(<span class="string">&#x27;example.db&#x27;</span>)</span><br><span class="line">    cur = conn.cursor()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># CREATE TABLE</span></span><br><span class="line">    sql_create_query = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        CREATE TABLE stokcs (</span></span><br><span class="line"><span class="string">            date      text</span></span><br><span class="line"><span class="string">            , trans   text</span></span><br><span class="line"><span class="string">            , symbol  text</span></span><br><span class="line"><span class="string">            , qty     real</span></span><br><span class="line"><span class="string">            , price   real</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    cur.execute(sql_create_query)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 데이터 추가</span></span><br><span class="line">    sql_insert_query = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        INSERT INTO stokcs VALUES (&#x27;2006-01-05&#x27;, &#x27;BUY&#x27;, &#x27;RHAT&#x27;, 100, 35.14)</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    cur.execute(sql_insert_query)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># save </span></span><br><span class="line">    conn.commit()</span><br><span class="line">    conn.close</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    db_create()</span><br></pre></td></tr></table></figure>

<pre><code>DB 생성시작
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#step5</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"><span class="keyword">import</span> contextlib</span><br><span class="line"></span><br><span class="line"><span class="meta">@contextlib.contextmanager</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">db_connect</span>(<span class="params">url</span>):</span><br><span class="line">    db= sqlite3.connect(url)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">yield</span> db</span><br><span class="line">    db.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="keyword">with</span> db_connect(url) <span class="keyword">as</span> conn:</span><br><span class="line">        cur = conn.cursor()</span><br><span class="line">        sql_get_query=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">            SELECT * FROM stokcs     </span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> cur.execute(sql_get_query):</span><br><span class="line">            <span class="built_in">print</span>(row) </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    url=<span class="string">&#x27;example.db&#x27;</span></span><br><span class="line">    main(url)</span><br></pre></td></tr></table></figure>

<pre><code>(&#39;2006-01-05&#39;, &#39;BUY&#39;, &#39;RHAT&#39;, 100.0, 35.14)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#step6</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> contextlib</span><br><span class="line"><span class="keyword">import</span> time </span><br><span class="line"></span><br><span class="line"><span class="meta">@contextlib.contextmanager</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">timer</span>():</span><br><span class="line">    <span class="comment"># 시간 측정</span></span><br><span class="line"></span><br><span class="line">    start = time.time()</span><br><span class="line">    <span class="keyword">yield</span> </span><br><span class="line">    end = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;(시간측정(Elapsed): &#123;:.2f&#125; 초)&quot;</span>.<span class="built_in">format</span>(end-start))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">with</span> timer():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;얼마나 오래 걸릴까요?&quot;</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<pre><code>얼마나 오래 걸릴까요?
(시간측정(Elapsed): 1.01 초)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#step7</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> contextlib</span><br><span class="line"><span class="keyword">import</span> step6</span><br><span class="line"><span class="keyword">import</span> time </span><br><span class="line"></span><br><span class="line"><span class="meta">@contextlib.contextmanager</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">openReadOnly</span>(<span class="params">fileName</span>):</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    read_file = <span class="built_in">open</span>(fileName, mode=<span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">yield</span> read_file</span><br><span class="line"></span><br><span class="line">    read_file.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">fileName</span>):</span><br><span class="line">    <span class="keyword">with</span> openReadOnly(fileName) <span class="keyword">as</span> file:</span><br><span class="line">        text= file.read()</span><br><span class="line">    </span><br><span class="line">    n = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> text.split():</span><br><span class="line">        <span class="keyword">if</span> word <span class="keyword">in</span> [<span class="string">&#x27;메타&#x27;</span>, <span class="string">&#x27;개인정보&#x27;</span>]:</span><br><span class="line">            n +=<span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;단어 갯수:&quot;</span>, n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    fileName = <span class="string">&quot;data/fun.txt&quot;</span></span><br><span class="line">    <span class="keyword">with</span> step6.timer():</span><br><span class="line">        main(fileName)</span><br><span class="line">        time.sleep(<span class="number">0.25</span>)</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-07-21T08:02:00.887Z" title="2022. 7. 21. 오후 5:02:00">2022-07-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-07-21T08:05:55.735Z" title="2022. 7. 21. 오후 5:05:55">2022-07-21</time></span><span class="level-item">11 minutes read (About 1705 words)</span></div></div><div class="content"><hr>
<h1 id="title-‘오라클SQL3’"><a href="#title-‘오라클SQL3’" class="headerlink" title="title: ‘오라클SQL3’"></a><strong>title: ‘오라클SQL3’</strong></h1><h1 id="date-‘2022-07-21-09-00’"><a href="#date-‘2022-07-21-09-00’" class="headerlink" title="date: ‘2022-07-21 09:00’"></a><strong>date: ‘2022-07-21 09:00’</strong></h1><hr>
<p>– 기본집계함수</p>
<p>select count(*) from employees;</p>
<p>select count(employee_id)from employees;</p>
<p>–null은 카운트를 하지 않는다<br>select count(department_id)from employees;</p>
<p>–유일한 값만 조회<br>select count (distinct department_id)<br>from employees;</p>
<p>select distinct department_id<br>from employees<br>order by 1;</p>
<p>–기초통계량(p154)<br>–합계,평균,최소,최대,분산,표준편차<br>–SQL -&gt; 통계도구&amp;머신러닝, 데이터 과학도구로</p>
<p>select sum(salary)<br>from employees;</p>
<p>select sum(salary),sum(distinct salary)<br>from employees;</p>
<p>select avg(salary),avg(distinct salary)<br>from employees;</p>
<p>select min(salary),max(distinct salary)<br>from employees;</p>
<p>–분산, 표준편차</p>
<p>select variance(salary),stddev(salary)<br>from employees;</p>
<p>–GROUPBY HAVING<br>–그전까지는 전체 데이터를 기준으로 집계</p>
<p>SELECT department_id<br>        ,sum(salary)<br>from employees<br>group by department_id<br>order by department_id;</p>
<p>select *<br>from KOR_LOAN_STATUS;–가계대출 단위는 십억</p>
<p>select period<br>    ,region<br>    ,sum(loan_jan_amt)titl_jan–as 생략가능<br>from KOR_LOAN_STATUS<br>where period like ‘2013%’<br>group by period, REGION<br>order by period, region ;</p>
<p>–2013년 11월 총잔액만 구한다.</p>
<p>select<br>    period<br>    ,region<br>    ,sum(loan_jan_amt)as totl_jan<br>from KOR_LOAN_STATUS<br>where period &#x3D; ‘201311’<br>group by period,REGION –그룹바이에 계산식을 뺀 컬럼명이 다 들어가야 한다.<br>order by period,region;</p>
<p>–2013년 11월 총잔액에서 10만단위 이상만 구한다.</p>
<p>select<br>    period<br>    ,region<br>    ,sum(loan_jan_amt)as totl_jan<br>from KOR_LOAN_STATUS<br>where period &#x3D; ‘201311’<br>group by period,REGION<br>having sum(loan_jan_amt)&gt;100000<br>order by period,region;</p>
<p>–ROLLUP절과 CUBE절</p>
<p>select period, gubun,sum(loan_jan_amt)totl_jan<br>from KOR_LOAN_STATUS<br>where period like ‘2013%’<br>group by period,GUBUN<br>order by period;</p>
<p>–롤업<br>–소그룹간의 합계를 계산하는 함수</p>
<p>select period, gubun,sum(loan_jan_amt)totl_jan<br>from KOR_LOAN_STATUS<br>where period like ‘2013%’<br>group by rollup(period,GUBUN);</p>
<p>–위치에 따라 결과값이 다르다.</p>
<p>select period, gubun,sum(loan_jan_amt)totl_jan<br>from KOR_LOAN_STATUS<br>where period like ‘2013%’<br>group by rollup(period),GUBUN;</p>
<p>– 큐브</p>
<p>select period, gubun,sum(loan_jan_amt)totl_jan<br>from KOR_LOAN_STATUS<br>where period like ‘2013%’<br>group by cube(period,GUBUN);</p>
<p>–집합연산자</p>
<p>CREATE TABLE exp_goods_asia (<br>           country VARCHAR2(10),<br>           seq     NUMBER,<br>           goods   VARCHAR2(80));</p>
<pre><code>INSERT INTO exp_goods_asia VALUES (&#39;한국&#39;, 1, &#39;원유제외 석유류&#39;);
INSERT INTO exp_goods_asia VALUES (&#39;한국&#39;, 2, &#39;자동차&#39;);
INSERT INTO exp_goods_asia VALUES (&#39;한국&#39;, 3, &#39;전자집적회로&#39;);
INSERT INTO exp_goods_asia VALUES (&#39;한국&#39;, 4, &#39;선박&#39;);
INSERT INTO exp_goods_asia VALUES (&#39;한국&#39;, 5,  &#39;LCD&#39;);
INSERT INTO exp_goods_asia VALUES (&#39;한국&#39;, 6,  &#39;자동차부품&#39;);
INSERT INTO exp_goods_asia VALUES (&#39;한국&#39;, 7,  &#39;휴대전화&#39;);
INSERT INTO exp_goods_asia VALUES (&#39;한국&#39;, 8,  &#39;환식탄화수소&#39;);
INSERT INTO exp_goods_asia VALUES (&#39;한국&#39;, 9,  &#39;무선송신기 디스플레이 부속품&#39;);
INSERT INTO exp_goods_asia VALUES (&#39;한국&#39;, 10,  &#39;철 또는 비합금강&#39;);

INSERT INTO exp_goods_asia VALUES (&#39;일본&#39;, 1, &#39;자동차&#39;);
INSERT INTO exp_goods_asia VALUES (&#39;일본&#39;, 2, &#39;자동차부품&#39;);
INSERT INTO exp_goods_asia VALUES (&#39;일본&#39;, 3, &#39;전자집적회로&#39;);
INSERT INTO exp_goods_asia VALUES (&#39;일본&#39;, 4, &#39;선박&#39;);
INSERT INTO exp_goods_asia VALUES (&#39;일본&#39;, 5, &#39;반도체웨이퍼&#39;);
INSERT INTO exp_goods_asia VALUES (&#39;일본&#39;, 6, &#39;화물차&#39;);
INSERT INTO exp_goods_asia VALUES (&#39;일본&#39;, 7, &#39;원유제외 석유류&#39;);
INSERT INTO exp_goods_asia VALUES (&#39;일본&#39;, 8, &#39;건설기계&#39;);
INSERT INTO exp_goods_asia VALUES (&#39;일본&#39;, 9, &#39;다이오드, 트랜지스터&#39;);
INSERT INTO exp_goods_asia VALUES (&#39;일본&#39;, 10, &#39;기계류&#39;);
</code></pre>
<p>commit;</p>
<p>select * from exp_goods_asia;</p>
<p>select goods<br>from exp_goods_asia<br>where country &#x3D; ‘한국’<br>order by seq;</p>
<p>select goods<br>from exp_goods_asia<br>where country &#x3D; ‘일본’<br>order by seq;</p>
<p>–두 국가가 겹치는 수출품목은 한번만 조회가 됨</p>
<p>–union사용</p>
<p>select goods<br>from exp_goods_asia<br>where country &#x3D; ‘한국’<br>UNION<br>select goods<br>from exp_goods_asia<br>where country &#x3D; ‘일본’<br>;</p>
<p>–union all 사용</p>
<p>select goods<br>from exp_goods_asia<br>where country &#x3D; ‘한국’<br>UNION all – 중복된 것도 나오게 됨<br>select goods<br>from exp_goods_asia<br>where country &#x3D; ‘일본’<br>;</p>
<p>–intersect(교집합)</p>
<p>select goods<br>from exp_goods_asia<br>where country &#x3D; ‘한국’<br>intersect – 공통된 것만<br>select goods<br>from exp_goods_asia<br>where country &#x3D; ‘일본’<br>;</p>
<p>–차집합</p>
<p>select goods<br>from exp_goods_asia<br>where country &#x3D; ‘한국’<br>minus – 한국에는 있고 일본에는 없는 것만<br>select goods<br>from exp_goods_asia<br>where country &#x3D; ‘일본’<br>;</p>
<p>–GROUPING SETS절<br>– Select rows from a Table</p>
<p>SELECT<br> period, gubun, sum(loan_jan_amt)totl_jan<br>from kor_loan_status<br>where period like ‘2013%’<br>group by grouping sets(period,gubun);</p>
<p>SELECT<br> period, gubun, sum(loan_jan_amt)totl_jan<br>from kor_loan_status<br>where period like ‘2013%’<br> and region in(‘서울’,’경기’)<br>group by grouping sets(period,(gubun,region));</p>
<p>–조인의 종류p176<br>–동등 조인</p>
<p>select a.employee_id<br>        ,a.emp_name<br>        ,a.department_id<br>        ,b.department_name<br>from employees a, departments b<br>where a.department_id &#x3D;b.department_id;</p>
<p>–세미조인<br>–서브쿼리를 이용해 서브쿼리에 존재하는 데이터만 메인쿼리에서 추출<br>–EXISTS사용</p>
<p>select department_id ,department_NAME<br>from departments a<br>where exists(select *<br>               from employees b<br>               where a.department_id &#x3D; b.department_id<br>               AND b.SALARY&gt;3000)<br>ORDER BY a.department_name;</p>
<p>–in사용</p>
<p>select department_id ,DEPARTMENT_NAME<br>from departments a<br>where a.department_id IN (select b.department_id<br>               from employees b<br>               where b.SALARY&gt;3000)<br>ORDER BY a.department_name;</p>
<p>–안티조인<br>–세미조인의 반대개념</p>
<p>–not exists, not in을 사용함<br>– Select rows from a Table</p>
<p>SELECT<br> a.employee_id<br> ,a.emp_name<br> ,a.department_id<br> ,b.department_name<br>from employees A<br>   ,departments B<br>where a.department_id &#x3D; b.DEPARTMENT_ID<br> and a.department_id not in(select department_id<br>                            from DEPARTMENTS<br>                            where manager_id is null );  </p>
<p>–180p</p>
<p>select count(*)<br>from employees A<br>where not exists(select 1<br>                from departments c<br>                where a.department_id &#x3D; c.department_id<br>                and manager_id is null);</p>
<p>– 셀프조인<br>– 조인을 하려면 두개의 테이블<br>– 테이블을  자기자신과 연결<br>– 같은 부서번호를 가진 사원중 A사원번호가 B사원보다 작은 건 조회</p>
<p>select<br> a.employee_id<br> ,a.emp_name<br> ,b.employee_id<br> ,b.emp_name<br> ,a.department_id<br>from<br> employees A<br> ,employees B<br>where a.employee_id &lt; b.EMPLOYEE_Id<br> and a.department_id &#x3D; b.department_id<br> and a.department_id &#x3D; 20;</p>
<p> –p181<br> –일반조인</p>
<p>select<br> a.department_id<br> ,a.department_name<br> ,b.job_id<br> ,b.department_id<br>from departments a,<br>    job_history b<br>where a.department_id &#x3D; b.department_id ;</p>
<p>– 라이트 조인<br>– 외부조인은 결측치가 생길 가능성이 높다.</p>
<p>select<br> a.department_id<br> ,a.department_name<br> ,b.job_id<br> ,b.department_id<br>from departments a,<br>    job_history b<br>where a.department_id &#x3D; b.department_id(+) ;</p>
<p>– 조건식 추가</p>
<p>select<br> a.employee_id<br> ,a.emp_name<br> ,b.job_id<br> ,b.department_id<br>from employees a,<br>    job_history b<br>where a.employee_id &#x3D; b.employee_id(+)<br>     and a.department_id &#x3D; b.department_id;</p>
<p>–ANSI조인 </p>
<p>select<br> a.employee_id<br> ,a.emp_name<br> ,b.department_id<br> ,b.department_name<br>from employees a<br>INNER join departments B<br>         ON (a.department_id &#x3D; b.department_id)<br>    where a.HIRE_DATE&gt;&#x3D;TO_DATE(‘2003-01-01’,’YYYY-MM-DD’);</p>
<p>–레프트 조인(왼쪽 테이블 데이터가 다 나옴)</p>
<p>select<br> a.employee_id<br> ,a.emp_name<br> ,b.job_id<br> ,b.department_id<br>from employees a<br>LEFT OUTER JOIN job_history b<br>on(a.employee_id &#x3D; b.employee_id<br>     and a.department_id &#x3D; b.department_id);</p>
<p>–라이트 조인(오른쪽 테이블 데이터가 다 나옴)</p>
<p>select<br> a.employee_id<br> ,a.emp_name<br> ,b.job_id<br> ,b.department_id<br>from employees a<br>right OUTER JOIN job_history b<br>on(a.employee_id &#x3D; b.employee_id<br>     and a.department_id &#x3D; b.department_id);</p>
<p>–서브쿼리<br>–select, from, where에서 사용된다.<br>–&gt;배치 자동화로 연결됨</p>
<p>select avg(salary)from employees</p>
<p>select count(*)<br>from EMPLOYEES<br>where salary&gt;&#x3D;(select avg(salary)from employees);     </p>
<p>select count(*)<br>from EMPLOYEES<br>where salary&gt;&#x3D; –부등호가 나오면 서브쿼리에서 출력되는 값은 단일행이 된다.</p>
<p>–in(10,20,30) 복수형이 나올 수 있다.</p>
<p>select count(*)<br>from EMPLOYEES<br>where department_id in (select department_id<br>                        from EMPLOYEES<br>                        where parent_id is null);  </p>
<p>select employee_id,<br>       EMP_NAME<br>       ,JOB_ID<br>from EMPLOYEES<br>where(employee_id,job_id)in(select EMPLOYEE_ID<br>                                ,JOB_ID<br>                             from job_history);       </p>
<p>–서브쿼리는  updeate,delete문에서도 사용할 수 있다.</p>
<p>–전사원의 급여를 평균 금액으로 갱신</p>
<p>–메인쿼리와 서브쿼리를 분할해서 생각해야 한다.                       </p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-07-21T07:57:06.913Z" title="2022. 7. 21. 오후 4:57:06">2022-07-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-07-21T08:05:55.750Z" title="2022. 7. 21. 오후 5:05:55">2022-07-21</time></span><span class="level-item">8 minutes read (About 1189 words)</span></div></div><div class="content"><hr>
<h1 id="title-‘오라클SQL2’"><a href="#title-‘오라클SQL2’" class="headerlink" title="title: ‘오라클SQL2’"></a><strong>title: ‘오라클SQL2’</strong></h1><h1 id="date-‘2022-07-20-09-00’"><a href="#date-‘2022-07-20-09-00’" class="headerlink" title="date: ‘2022-07-20 09:00’"></a><strong>date: ‘2022-07-20 09:00’</strong></h1><hr>
<h2 id="–-SELECT-문"><a href="#–-SELECT-문" class="headerlink" title="– SELECT 문"></a>– SELECT 문</h2><p>SELECT*FROM employees ;</p>
<p>SELECT employee_id, emp_name<br>From employees<br>WHERE salary &gt; 5000;</p>
<p>SELECT employee_id, emp_name, salary<br>From employees<br>WHERE salary &lt; 3000<br>ORDER BY salary;– 순서대로</p>
<p>–급여가 5000이상이고 job_id,IT_PROG사원 조회</p>
<p>SELECT employee_id, emp_name<br>From employees<br>WHERE salary &gt; 5000<br>  AND job_id &#x3D; ‘IT_PROG’<br>ORDER BY employee_id;– 순서대로</p>
<p>–급여가 5000이상이거나 job_id,IT_PROG사원 조회</p>
<p>SELECT employee_id, emp_name<br>From employees<br>WHERE salary &gt; 5000<br>  OR job_id &#x3D; ‘IT_PROG’<br>ORDER BY employee_id;</p>
<p>–테이블에 별칭을 줄 수 있음</p>
<p>SELECT<br>      a.employee_id, a.emp_name, a.department_id,<br>      b.department_name<br>  FROM employees a,<br>       – a를 테이블 employees로<br>       departments b<br>       – b를 테이블 dapartment_name으로 정의<br> WHERE a.department_id &#x3D; b.department_id</p>
<p>–INSERT문</p>
<p>CREATE TABLE ex3_1(<br>    COL1 VARCHAR2(10)<br>    ,COL2 NUMBER<br>    ,COL3 DATE<br>);</p>
<p>INSERT INTO ex3_1(COL1,COL2,COL3)<br>    VALUES(‘ABC’,10,SYSDATE);</p>
<p>INSERT INTO ex3_1(COL3,COL1,COL2)<br>    VALUES(SYSDATE,’DEF’,20);</p>
<p>INSERT INTO ex3_1–(COL3,COL1,COL2)컬럼명 생략가능<br>    VALUES(‘CDF’,30,SYSDATE);</p>
<p>DESC EX3_1</p>
<p>SELECT*FROM EX3_1</p>
<p>–UPDATE문</p>
<p>–MERGE문</p>
<p>—데이터를 합치거나 추가함이란 뜻이지만<br>—조건을 비교해서 테이블에 해당조건에 맞는 데이터 없으면 추가<br>—있으면 UPDATE문을 수행한다</p>
<p>CREATE TABLE ex3_3(<br>    employee_id NUMBER<br>    ,bonus_amt NUMBER DEFAULT 0<br>);– 테이블 생성</p>
<p>INSERT INTO ex3_3(employee_id)<br>SELECT e.employee_id<br>FROM employees e, sales s<br>WHERE e.employee_id &#x3D; s.employee_id<br> AND s. SALES_MONTH BETWEEN ‘200010’ AND ‘200012’<br>GROUP BY e.employee_id –사원번호의 중복제거</p>
<p>SELECT*FROM ex3_3 ORDER BY EMPLOYEE_ID</p>
<p>–P103<br>– Select rows from a Table</p>
<p>SELECT employee_id,<br>  manager_id,<br>  salary,<br>  salary*0.01<br>FROM employees<br>WHERE employee_id IN(SELECT employee_id FROM ex3_3);</p>
<p>–IN이 조건문이 되는 것이다.</p>
<p>SELECT employee_id,<br>  manager_id,<br>  salary,<br>  salary*0.001<br>FROM employees<br>WHERE employee_id<br>IN(SELECT employee_id FROM ex3_3)<br>  AND manager_id&#x3D; 146;</p>
<p>–MERGE를 통해서 작성</p>
<p>–관리자 사번 146인 것 중에서 EX3_3 테이블에 없는<br>–사원의 사번, 관리자 사번, 급여, 급여*0,01조회<br>–EX3_3테이블의 160번 사원의 보너스 금액은 7.5로<br>–신규 입력 하시오</p>
<p>SELECT * FROM EX3_3</p>
<p>–서브쿼리 개념( 메인쿼리 안에 추가된 쿼리)<br>–UPDATE와 INSERT 구문<br>–두개의 테이블을 합침</p>
<p>MERGE INTO ex3_3 d<br>    USING (SELECT employee_id, salary, manager_id<br>                  FROM employees<br>                  WHERE manager_id &#x3D; 146) b<br>    ON (d.employee_id &#x3D; b.employee_id)<br>WHEN MATCHED THEN<br>    UPDATE SET d.bonus_amt &#x3D; d.bonus_amt + b.salary * 0.01<br>WHEN NOT MATCHED THEN<br>    INSERT (d.employee_id, d.bonus_amt) VALUES (b.employee_id, b.salary * .001)<br>    WHERE (b.salary &lt; 8000);</p>
<p>SELECT * FROM ex3_3 ORDER BY employee_id;<br>——-삭제하기<br>MERGE INTO ex3_3 d<br>    USING (SELECT employee_id, salary, manager_id<br>                  FROM employees<br>                  WHERE manager_id &#x3D; 146) b<br>    ON (d.employee_id &#x3D; b.employee_id)<br>WHEN MATCHED THEN<br>    UPDATE SET d.bonus_amt &#x3D; d.bonus_amt + b.salary * 0.01<br>    DELETE WHERE(B.employee_id &#x3D;161)– 삭제구문<br>WHEN NOT MATCHED THEN<br>    INSERT (d.employee_id, d.bonus_amt) VALUES (b.employee_id, b.salary * .001)<br>    WHERE (b.salary &lt; 8000);</p>
<p>–COMMIT &amp; ROLLBACK<br>–COMMIT은 변경한 데이터를 데이터베이스에 마지막으로 반영<br>–ROLLBACK은 그 반대로 변경한 데이터를 변경하기 이전 상태로 되돌리는 역활<br>CREATE TABLE ex3_4(<br>    employee_id NUMBER<br>);</p>
<p>INSERT INTO ex3_4 VALUES(100);</p>
<p>SELECT * FROM ex3_4;</p>
<p>–p109<br>TRUNCATE TABLE ex3_4;</p>
<p>–P110<br>SELECT<br>    ROWNUM, employee_id<br> FROM employees<br>WHERE ROWNUM&lt;5</p>
<p>–ROWID, 주소값<br>–DBA, DB 모델링(쿼리속도 측정–&gt; 특징)<br>SELECT<br>    ROWNUM, employee_id,</p>
<p> FROM employees</p>
<p>–연산자<br>–Operator연산 수행<br>–수식 연산자 와 문자 연산자<br>–||두 문자를 붙이는 연결 연산자</p>
<p>– Select rows from a Table</p>
<p>SELECT<br>  employee_id||’-‘||emp_name AS employee_info<br>FROM employees<br>WHERE rownum&lt;5</p>
<p>–표현식<br>–조건문, if조건문(PL&#x2F;SQL)<br>–CASE 표현식<br>– Select rows from a Table</p>
<p>SELECT<br>  employee_id<br>  ,SALARY<br>  ,CASE WHEN salary&lt;&#x3D;5000 THEN ‘시등급’<br>        WHEN salary&gt;5000 AND salary&lt;&#x3D;15000 THEN ‘b등급’<br>        ELSE ‘A등급’<br>   END AS salary_grade<br>FROM employees;</p>
<p>–조건식<br>–TRUE,FALSE,UNKNOWN<br>–비교조건식<br>–분석가, DB데이터를 추출할 시 , 서브쿼리와 연계<br>– Select rows from a Table<br>– ANY와 SOME은 같은 개념이다.<br>SELECT<br>  employee_id<br>  ,SALARY<br>FROM EMPLOYEES<br>WHERE SALARY &#x3D; ANY(2000,3000,4000)<br>ORDER BY EMPLOYEE_ID</p>
<p>–IN, NOT IN조건식<br>SELECT<br>  employee_id<br>  ,SALARY<br>FROM EMPLOYEES<br>WHERE SALARY NOT IN(2000,3000,4000)<br>ORDER BY EMPLOYEE_ID;</p>
<p>–EXIST조건식<br>–’서브쿼리’만 올 수 있음<br>–개발자들,코딩테스트(알코리즘)&#x2F;기술면접&#x2F;임원면접<br>–분석가들,SQL&#x2F;분석과제</p>
<p>–LIKE 조건식<br>–문자열의 패턴을 검색해서 사용하는 조건식<br>– Select rows from a Table</p>
<p>SELECT emp_name<br>FROM employees<br>WHERE emp_name LIKE ‘%<em>A</em>_%’<br>ORDER BY emp_name;</p>
<p>–4장 숫자함수<br>SELECT ABS(10),ABS(-10),ABS(-10.123)<br>FROM DUAL;</p>
<p>SELECT CEIL(10.123), CEIL(10.432), CEIL(11.001)<br>FROM DUAL;</p>
<p>SELECT ROUND(10.143,1),ROUND(10.143,2)<br>FROM DUAL;</p>
<p>SELECT TRUNC(11.44,1),TRUNC(11.12313,3)<br>FROM DUAL;</p>
<p>SELECT POWER(3,2),POWER(3,3)<br>FROM DUAL;</p>
<p>SELECT SQRT(2),SQRT(5)<br>FROM DUAL;</p>
<p>– 문자함수<br>– &gt;문자열 데이터 전처리.<br>– &gt;채팅-&gt;문자데이터로 텍스트 마이닝</p>
<p>SELECT SUBSTR(‘ABCDEFG’,1,4),SUBSTR(‘ABCDEFG’,-6,4)<br>FROM DUAL;</p>
<p>–NULL관련함수<br>SELECT manager_id, employee_id FROM employees;</p>
<p>–NVL:표현식 1이 NULL일 때 표현식2를 반환함<br>SELECT NVL(manager_id,employee_id)<br>FROM EMPLOYEES<br>WHERE MANAGER_ID IS NULL;</p>
<p>–NVL2:표현식 1이 NULL이 아니면 표현식2를 반환하고<br>–     표현식 2가 NULL이면 표현식3을 출력.<br>SELECT employee_id<br>                , salary<br>                , commission_pct<br>                , NVL2(commission_pct, salary + (salary * commission_pct), salary) AS salary2<br>FROM employees<br>WHERE employee_id IN (118, 179);</p>
<p>–COALESCE(expr1,expr2)<br>–매개변수로 들어오는 표현식에서 NULL이 아닌 첫번째 표현식 반환<br>SELECT employee_id<br>                , salary<br>                , commission_pct<br>                , COALESCE(salary*commission_pct,salary)AS salary2<br>FROM employees;</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-07-19T07:47:16.136Z" title="2022. 7. 19. 오후 4:47:16">2022-07-19</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-07-19T08:00:10.661Z" title="2022. 7. 19. 오후 5:00:10">2022-07-19</time></span><span class="level-item">6 minutes read (About 971 words)</span></div></div><div class="content"><hr>
<h1 id="title-‘오라클SQL’"><a href="#title-‘오라클SQL’" class="headerlink" title="title: ‘오라클SQL’"></a><strong>title: ‘오라클SQL’</strong></h1><h1 id="date-‘2022-07-19-13-00’"><a href="#date-‘2022-07-19-13-00’" class="headerlink" title="date: ‘2022-07-19 13:00’"></a><strong>date: ‘2022-07-19 13:00’</strong></h1><hr>
<p>SELECT table_name FROM user_tables;<br>– SQL vs PL&#x2F;SQL<br>– SQL(분석가90%+개발자30%)<br>—-프로그래밍 성격이 얕음<br>– PL&#x2F;SQL(분석가10%+개발자70%+DBA)<br>—-프로그래밍 필요<br>–<br>– 입문 : 테이블 , 뷰,–&gt;PL&#x2F;SQL(중급): 함수, 프로시저<br>&#x2F;*<br>CREATE TABLE 테이블 명(<br>         컬럼1 컬럼1_데이터타입 결측치 허용유무,<br>           )<br>*&#x2F;<br>–P50</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE ex2_1(</span><br><span class="line">    COLUMN1 CHAR(10),</span><br><span class="line">    COLUMN2 VARCHAR2(10),</span><br><span class="line">    COLUMN3 VARCHAR2(10),</span><br><span class="line">    COLUMN4 NUMBER</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>– 데이터 추가<br>INSERT INTO ex2_1 (column1,column2) VALUES (‘abc’,’abc’);<br>– 테이블 조회<br>SELECT column1, LENGTH(column1) as len1,<br>       column2, LENGTH(column2) as len2<br>FROM ex2_1;<br>– p.53<br>– 영어에서 한 문자는 1byte<br>– 한글에서 한 문자는 2byte<br>CREATE TABLE ex2_2(<br>    COLUMN1 VARCHAR2(3),– 디폴트 값이 byte 적용<br>    COLUMN2 VARCHAR2(3 byte),<br>    COLUMN3 VARCHAR2(3 char)<br>);<br>– 데이터 추가<br>INSERT INTO ex2_2 VALUES(‘abc’,’abc’,’abc’);</p>
<p>SELECT column1<br>      ,LENGTH(column1) AS len1<br>      ,column2,LENGTH(column2) AS len2<br>      ,column3,LENGTH(column3) AS len3<br>  FROM ex2_2;<br>– 한글추가<br>– 입력이 안됨<br>INSERT INTO ex2_2 VALUES(‘홍길동’,’홍길동’,’홍길동’);</p>
<p>–p54<br>INSERT INTO ex2_2 (column3) VALUES(‘홍길동’);</p>
<p>SELECT column3<br>    , LENGTH(column3) AS len3<br>    , LENGTHB(column3) AS bytelen<br> FROM ex2_2</p>
<p> –숫자 데이터 타입<br> CREATE TABLE ex2_3(<br>    COL_INT INTEGER,–정수형<br>    COL_DEC DECIMAL,–실수형<br>    COL_NUM NUMBER –가변숫자<br>    );<br>&#x2F;*<br>SELECT 컬럼명<br>FROM 테이블명<br>WHERE 조건식<br>ORDER BY 정렬(내림차순)<br>R dplyr패키지는 SQL을 모방해서 만듬<br>*&#x2F;<br>SELECT column_id<br>    , column_name<br>    , data_type<br>    , data_length<br>FROM user_tab_cols<br>WHERE table_name &#x3D; ‘EX2_3’<br>ORDER BY column_id ;<br>– 날짜 데이터 타입<br>CREATE TABLE ex2_5(<br>    COL_DATE  DATE,<br>    COL_TIMESTAMP TIMESTAMP<br>);</p>
<p>INSERT INTO ex2_5 VALUES(SYSDATE, SYSTIMESTAMP);</p>
<p>SELECT *<br> FROM ex2_5;</p>
<p>– Null 값이 없음을 의미<br>– 해당 컬럼은 NULL<br>– 결측치를 허용하지 않는다 :NOT NULL<br>– p60<br>CREATE TABLE ex2_6(<br>    COL_NULL     VARCHAR2(10),– 결측치 허용<br>    COL_NOT_NULL     VARCHAR2(10) NOT NULL– 결측치 허용<br>);<br>– 에러 발생 확인<br>INSERT INTO ex2_6 VALUES(‘AA’,’’);</p>
<p>– 정상적으로 삽입 됨<br>INSERT INTO ex2_6 VALUES(‘’,’BB’);</p>
<p>SELECT * FROM ex2_6</p>
<p>INSERT INTO ex2_6 VALUES(‘AA’,’BB’);</p>
<p>– p61<br>SELECT constraint_name<br>        ,constraint_type<br>        ,table_name<br>        ,search_condition<br>FROM user_constraints<br>WHERE table_name &#x3D; ‘EX2_6’</p>
<p>–UNIQUE<br>–중복값 허용안함<br>DROP TABLE ex2_7;</p>
<p>CREATE TABLE ex2_7(<br>    COL_UNIQUE_NULL     VARCHAR2(10)UNIQUE<br>    ,COL_UNIQUE_NNULL   VARCHAR2(10)UNIQUE NOT NULL<br>    ,COL_UNIQUE         VARCHAR2(10)<br>    ,CONSTRAINTS unique_nm1 UNIQUE (COL_UNIQUE)– 제약조건을 추가함<br>);    </p>
<p>SELECT constraint_name<br>        ,constraint_type<br>        ,table_name<br>        ,search_condition<br>FROM user_constraints<br>WHERE table_name &#x3D; ‘EX2_7’</p>
<p>INSERT INTO ex2_7 VALUES (‘AA’,’AA’,’AA’);– 주민번호나 아이디 중복을 막음<br>INSERT INTO ex2_7 VALUES (‘’,’BB’,’CC’);</p>
<p>– 기본키<br>– Primary Key<br>– UNIQUE(중복허용), NOT NULL(결측치 허용 안됨)]<br>– 테이블 당 1개의 기본키만 설정 가능</p>
<p>CREATE TABLE ex2_8(<br>    COL1 VARCHAR2(10) PRIMARY KEY<br>    ,COL2 VARCHAR2(10)<br>);</p>
<p>INSERT INTO ex2_8 VALUES(‘’,’AA’);– 결측치 허용 안함<br>INSERT INTO ex2_8 VALUES(‘AA’,’AA’);<br>INSERT INTO ex2_8 VALUES(‘AA’,’AA’);</p>
<p>SELECT constraint_name<br>        ,constraint_type<br>        ,table_name<br>        ,search_condition<br>FROM user_constraints<br>WHERE table_name &#x3D; ‘EX2_8’</p>
<p>SELECT * FROM USER_CONSTRAINTS;</p>
<p>SELECT constraint_name<br>        ,constraint_type<br>        ,table_name<br>        ,search_condition<br>FROM user_constraints<br>WHERE table_name &#x3D; ‘JOBS’;</p>
<p>–외래키 : 테이블 간의 참조 데이터 무결성을 위한 제약 조건<br>– &gt;참조 무결성을 보장한다.<br>– &gt;잘못된 정보가 입력되는 것을 방지함</p>
<p>– CHECK<br>– 컬럼에 입력되는 데이터를 체크해 특정조건에 맞는 데이터만 입력함.<br>CREATE TABLE ex2_9(<br>      num1            NUMBER<br>    , CONSTRAINTS check1 CHECK( num1 BETWEEN 1 AND 9)<br>    , gender        VARCHAR2(10)<br>    , CONSTRAINTS check2 CHECK ( gender  IN (‘MALE’,’FEMALE’))<br>);    </p>
<p>SELECT constraint_name<br>        ,constraint_type<br>        ,table_name<br>        ,search_condition<br>FROM user_constraints<br>WHERE table_name &#x3D; ‘EX2_9’;</p>
<p>INSERT INTO ex2_9 VAlUES(10,’MAN’);</p>
<p>–DeFault<br>alter session set nls_date_format&#x3D;’YYYY&#x2F;MM&#x2F;DD HH24:MI:SS’;<br>DROP TABLE ex2_10;<br>CREATE TABLE ex2_10(<br>    Col1   VARCHAR2(10) NOT NULL<br>    , Col2 VARCHAR2(10) NULL<br>    , Create_date DATE DEFAULT SYSDATE<br>    –, Create_timestamp TIMESTAMP DEFAULT SYSTIMESTAMP<br>);</p>
<p>INSERT INTO ex2_10 (col1, col2) VALUES(‘AA’, ‘BB’);<br>SELECT * FROM ex2_10;</p>
<p>– 테이블 변경<br>– ALTER TABLE</p>
<p>ALTER TABLE ex2_10 RENAME COLUMN col1 TO col11;<br>SELECT * FROM ex2_10;</p>
<p>DESC ex2_10;<br>–컬럼타입 변경<br>ALTER TABLE ex2_10 MODIFY col2 VARCHAR2(30);</p>
<p>–신규컬럼 추가<br>ALTER TABLE ex2_10 ADD COL3 NUMBER;</p>
<p>–컬럼 삭제<br>ALTER TABLE ex2_10 DROP COLUMN COL3;</p>
<p>–제약조건 추가<br>ALTER TABLE ex2_10 ADD CONSTRAINTS pk_ex2_10 PRIMARY KEY(COL11);</p>
<p>SELECT constraint_name<br>        ,constraint_type<br>        ,table_name<br>        ,search_condition<br>FROM user_constraints<br>WHERE table_name &#x3D; ‘EX2_10’;</p>
<p>–제약조건 삭제 :COLL11에서 기본키 삭제<br>ALTER TABLE ex2_10 DROP CONSTRAINTS pk_ex2_10;</p>
<p>DESC EX2_10</p>
<p>–테이블 복사<br>CREATE TABLE ex2_9_1 AS<br>SELECT * FROM ex2_9;</p>
<p>DESC ex2_9_1;</p>
<p>–뷰 생성<br>l</p>
<p>CREATE OR REPLACE VIEW emp_dept_v1 AS<br>SELECT a.employee_id<br>        ,a.emp_name<br>        ,a.department_id<br>        ,b.department_name<br>FROM employees a,<br>     departments b<br>WHERE a.department_id &#x3D; b.department_id;     </p>
<p>– 뷰 삭제<br>DROP VIEW emp_dept_v1;</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-07-18T06:33:34.000Z" title="2022. 7. 18. 오후 3:33:34">2022-07-18</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-07-18T06:39:31.991Z" title="2022. 7. 18. 오후 3:39:31">2022-07-18</time></span><span class="level-item">17 minutes read (About 2578 words)</span></div></div><div class="content"><hr>
<h2 id="title-‘Titanic’"><a href="#title-‘Titanic’" class="headerlink" title="title: ‘Titanic’"></a>title: ‘Titanic’</h2><h2 id="date-‘2022-07-18-09-00"><a href="#date-‘2022-07-18-09-00" class="headerlink" title="date: ‘2022-07-18 09:00"></a>date: ‘2022-07-18 09:00</h2><hr>
<p><img src="/images/day0718/titanic.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np </span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd </span><br><span class="line"><span class="keyword">import</span> matplotlib <span class="keyword">as</span> mpl</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt </span><br><span class="line"><span class="keyword">import</span> sklearn</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"><span class="keyword">import</span> mlflow </span><br><span class="line"><span class="keyword">import</span> mlflow.sklearn</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LogisticRegression</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split, KFold</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> roc_auc_score, plot_roc_curve, confusion_matrix </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;numpy version <span class="subst">&#123;np.__version__&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;pandas version <span class="subst">&#123;pd.__version__&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;matplotlib version <span class="subst">&#123;mpl.__version__&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;seaborn version <span class="subst">&#123;sns.__version__&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;sklearn version <span class="subst">&#123;sklearn.__version__&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;MLFlow version <span class="subst">&#123;mlflow.__version__&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<pre><code>numpy version 1.23.1
pandas version 1.4.3
matplotlib version 3.5.2
seaborn version 0.11.2
sklearn version 1.1.1
MLFlow version 1.27.0
</code></pre>
<h2 id="데이터-불러오기"><a href="#데이터-불러오기" class="headerlink" title="데이터 불러오기"></a>데이터 불러오기</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 데이터불러오기</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(os.getcwd())</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<pre><code>C:\Users\human\Desktop\mlops_sample\src
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DATA_PATH = <span class="string">&quot;C:\\Users\\human\\Desktop\\mlops_sample\\data\\&quot;</span> <span class="comment"># \\를 두번해준다.</span></span><br><span class="line"></span><br><span class="line">train_df = pd.read_csv(DATA_PATH + <span class="string">&quot;train.csv&quot;</span>)</span><br><span class="line">test = pd.read_csv(DATA_PATH + <span class="string">&quot;test.csv&quot;</span>)</span><br><span class="line">submission = pd.read_csv(DATA_PATH + <span class="string">&quot;gender_submission.csv&quot;</span>)</span><br><span class="line"></span><br><span class="line">train_df.shape, test.shape, submission.shape</span><br></pre></td></tr></table></figure>




<pre><code>((891, 12), (418, 11), (418, 2))
</code></pre>
<h3 id="데이터-탐색"><a href="#데이터-탐색" class="headerlink" title="데이터 탐색"></a>데이터 탐색</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_df.info()</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 891 entries, 0 to 890
Data columns (total 12 columns):
 #   Column       Non-Null Count  Dtype  
---  ------       --------------  -----  
 0   PassengerId  891 non-null    int64  
 1   Survived     891 non-null    int64  
 2   Pclass       891 non-null    int64  
 3   Name         891 non-null    object 
 4   Sex          891 non-null    object 
 5   Age          714 non-null    float64
 6   SibSp        891 non-null    int64  
 7   Parch        891 non-null    int64  
 8   Ticket       891 non-null    object 
 9   Fare         891 non-null    float64
 10  Cabin        204 non-null    object 
 11  Embarked     889 non-null    object 
dtypes: float64(2), int64(5), object(5)
memory usage: 83.7+ KB
</code></pre>
<ul>
<li>결측치 확인</li>
<li>Age , Cabin, Embarked</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_df.isnull().<span class="built_in">sum</span>()</span><br></pre></td></tr></table></figure>




<pre><code>PassengerId      0
Survived         0
Pclass           0
Name             0
Sex              0
Age            177
SibSp            0
Parch            0
Ticket           0
Fare             0
Cabin          687
Embarked         2
dtype: int64
</code></pre>
<h2 id="데이터-시각화"><a href="#데이터-시각화" class="headerlink" title="데이터 시각화"></a>데이터 시각화</h2><ul>
<li>종속변수는 Survived임</li>
<li>숫자1은 생존을 의미하고 0은 사망을 의미함.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">survived = train_df[train_df[<span class="string">&#x27;Survived&#x27;</span>] == <span class="number">1</span>]</span><br><span class="line">deceased = train_df[train_df[<span class="string">&#x27;Survived&#x27;</span>] == <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Survived : <span class="subst">&#123;survived.shape&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Deceased : <span class="subst">&#123;deceased.shape&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<pre><code>Survived : (342, 12)
Deceased : (549, 12)
</code></pre>
<ul>
<li>seaborn</li>
<li>maplotlib</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">class_df = train_df[<span class="string">&#x27;Survived&#x27;</span>].value_counts(sort =<span class="literal">True</span>)</span><br><span class="line">class_df</span><br></pre></td></tr></table></figure>




<pre><code>0    549
1    342
Name: Survived, dtype: int64
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class_df = train_df[<span class="string">&#x27;Survived&#x27;</span>].value_counts(sort=<span class="literal">True</span>)</span><br><span class="line">class_df</span><br><span class="line"></span><br><span class="line">fig, ax = plt.subplots()</span><br><span class="line">ax.bar(class_df.index, class_df.values, color = <span class="string">&quot;red&quot;</span>, width = <span class="number">0.4</span>)<span class="comment">#리스트형 데이터</span></span><br><span class="line">ax.set_xticks(<span class="built_in">range</span>(<span class="number">2</span>), [<span class="string">&quot;Deceased&quot;</span>, <span class="string">&quot;Survived&quot;</span>])</span><br><span class="line">ax.set_title(<span class="string">&quot;Class Distribution&quot;</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">&quot;Counts&quot;</span>)</span><br><span class="line">ax.set_xlabel(<span class="string">&quot;Class Label&quot;</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>


<p><img src="/images/day0718/output_13_0.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 연령별 분포를 확인함</span></span><br><span class="line">fig, ax = plt.subplots()</span><br><span class="line">ax.scatter(train_df[<span class="string">&#x27;Age&#x27;</span>], train_df[<span class="string">&#x27;Survived&#x27;</span>])</span><br><span class="line">ax.set_title(<span class="string">&quot;Age by Survived&quot;</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">&quot;Class&quot;</span>)</span><br><span class="line">ax.set_yticks(<span class="built_in">range</span>(<span class="number">2</span>), [<span class="string">&quot;Deceased&quot;</span>, <span class="string">&quot;Survived&quot;</span>])</span><br><span class="line">ax.set_xlabel(<span class="string">&quot;Survived By Age&quot;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>


<p><img src="/images/day0718/output_14_0.png" alt="png"></p>
<ul>
<li>사용자 정의 함수를 만들어서 활용</li>
<li>seaborn countplot()함수 활용</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">column = <span class="string">&quot;Sex&quot;</span></span><br><span class="line">train_df[[column,<span class="string">&quot;Survived&quot;</span>]].groupby([column]).mean()<span class="comment">#.plot.bar()</span></span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Survived</th>
    </tr>
    <tr>
      <th>Sex</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>female</th>
      <td>0.742038</td>
    </tr>
    <tr>
      <th>male</th>
      <td>0.188908</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">column = <span class="string">&quot;Sex&quot;</span></span><br><span class="line">train_df[[column,<span class="string">&quot;Survived&quot;</span>]].groupby([column]).mean().plot.bar()</span><br></pre></td></tr></table></figure>




<pre><code>&lt;AxesSubplot:xlabel=&#39;Sex&#39;&gt;
</code></pre>
<p><img src="/images/day0718/output_17_1.png" alt="png"></p>
<ul>
<li>여성이 남성보다 더 많이 생존했다.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">plot_bar</span>(<span class="params">data, column=<span class="literal">None</span></span>): <span class="comment">#plot_bar라는 함수를 정의</span></span><br><span class="line">    <span class="keyword">if</span> column <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="comment"># 시각화 코드 작성</span></span><br><span class="line">        fig, ax = plt.subplots(<span class="number">1</span>, <span class="number">2</span>, figsize=(<span class="number">18</span>, <span class="number">8</span>))</span><br><span class="line">        data[[column, <span class="string">&quot;Survived&quot;</span>]].groupby([column]).mean().plot.bar(ax=ax[<span class="number">0</span>])</span><br><span class="line">        sns.countplot(x = column, hue = <span class="string">&quot;Survived&quot;</span>, data = data, ax=ax[<span class="number">1</span>])</span><br><span class="line">        ax[<span class="number">1</span>].legend(labels = [<span class="string">&#x27;Dead&#x27;</span>, <span class="string">&#x27;Survived&#x27;</span>])</span><br><span class="line">        ax[<span class="number">1</span>].set_title(<span class="string">f&#x27;<span class="subst">&#123;column&#125;</span>:Survived vs Dead&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Please Enter Column&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># return No</span></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">column = <span class="string">&quot;Sex&quot;</span></span><br><span class="line">plot_bar(train_df, column)</span><br></pre></td></tr></table></figure>


<p><img src="/images/day0718/output_20_0.png" alt="png"></p>
<ul>
<li>Pclass별 막대그래프를 그려보자</li>
<li>1번 클래스에 속할 수록 생존확률이 높다.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">column = <span class="string">&quot;Pclass&quot;</span></span><br><span class="line">plot_bar(train_df, column)</span><br></pre></td></tr></table></figure>


<p><img src="/images/day0718/output_22_0.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">column = <span class="string">&quot;Embarked&quot;</span></span><br><span class="line">plot_bar(train_df, column)</span><br></pre></td></tr></table></figure>


<p><img src="/images/day0718/output_23_0.png" alt="png"></p>
<h2 id="결측치-대치"><a href="#결측치-대치" class="headerlink" title="결측치 대치"></a>결측치 대치</h2><ul>
<li>컬럼 3개 처리</li>
<li>무엇을 삭제할 것인가? <ul>
<li>Cabin 685개 부족 -&gt; 삭제</li>
<li>Embarked 2개 부족 -&gt; 최빈도로 채워넣기</li>
<li>Age 117개 부족 -&gt; 그룹화하여 대치</li>
</ul>
</li>
<li></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_df.info()</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 891 entries, 0 to 890
Data columns (total 12 columns):
 #   Column       Non-Null Count  Dtype  
---  ------       --------------  -----  
 0   PassengerId  891 non-null    int64  
 1   Survived     891 non-null    int64  
 2   Pclass       891 non-null    int64  
 3   Name         891 non-null    object 
 4   Sex          891 non-null    object 
 5   Age          714 non-null    float64
 6   SibSp        891 non-null    int64  
 7   Parch        891 non-null    int64  
 8   Ticket       891 non-null    object 
 9   Fare         891 non-null    float64
 10  Cabin        204 non-null    object 
 11  Embarked     889 non-null    object 
dtypes: float64(2), int64(5), object(5)
memory usage: 83.7+ KB
</code></pre>
<ul>
<li>Name 피쳐 확인</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_df[<span class="string">&#x27;Name&#x27;</span>][:<span class="number">5</span>]</span><br></pre></td></tr></table></figure>




<pre><code>0                              Braund, Mr. Owen Harris
1    Cumings, Mrs. John Bradley (Florence Briggs Th...
2                               Heikkinen, Miss. Laina
3         Futrelle, Mrs. Jacques Heath (Lily May Peel)
4                             Allen, Mr. William Henry
Name: Name, dtype: object
</code></pre>
<ul>
<li>호칭의 패턴을 보고 데이터를 추출</li>
<li>키워드 : 정규표현식</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">train_df[<span class="string">&#x27;Initial&#x27;</span>] = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> [train_df, test]:</span><br><span class="line">    train_df[<span class="string">&#x27;Initial&#x27;</span>] = train_df[<span class="string">&#x27;Name&#x27;</span>].<span class="built_in">str</span>.extract(<span class="string">&#x27;([A-Za-z]+)\.&#x27;</span>) <span class="comment"># []안의 a~z A~Z까지 잡아내라\.을 잡아내라</span></span><br><span class="line">    test[<span class="string">&#x27;Initial&#x27;</span>] = test[<span class="string">&#x27;Name&#x27;</span>].<span class="built_in">str</span>.extract(<span class="string">&#x27;([A-Za-z]+)\.&#x27;</span>) <span class="comment"># </span></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_df[[<span class="string">&quot;Name&quot;</span>,<span class="string">&quot;Initial&quot;</span>]].head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Initial</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Braund, Mr. Owen Harris</td>
      <td>Mr</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Cumings, Mrs. John Bradley (Florence Briggs Th...</td>
      <td>Mrs</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Heikkinen, Miss. Laina</td>
      <td>Miss</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Futrelle, Mrs. Jacques Heath (Lily May Peel)</td>
      <td>Mrs</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Allen, Mr. William Henry</td>
      <td>Mr</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test[[<span class="string">&quot;Name&quot;</span>,<span class="string">&quot;Initial&quot;</span>]].head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Initial</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Kelly, Mr. James</td>
      <td>Mr</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Wilkes, Mrs. James (Ellen Needs)</td>
      <td>Mrs</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Myles, Mr. Thomas Francis</td>
      <td>Mr</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Wirz, Mr. Albert</td>
      <td>Mr</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Hirvonen, Mrs. Alexander (Helga E Lindqvist)</td>
      <td>Mrs</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.crosstab(train_df[<span class="string">&#x27;Initial&#x27;</span>], train_df[<span class="string">&#x27;Sex&#x27;</span>]).T <span class="comment"># 빈도수 확인</span></span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Initial</th>
      <th>Capt</th>
      <th>Col</th>
      <th>Countess</th>
      <th>Don</th>
      <th>Dr</th>
      <th>Jonkheer</th>
      <th>Lady</th>
      <th>Major</th>
      <th>Master</th>
      <th>Miss</th>
      <th>Mlle</th>
      <th>Mme</th>
      <th>Mr</th>
      <th>Mrs</th>
      <th>Ms</th>
      <th>Rev</th>
      <th>Sir</th>
    </tr>
    <tr>
      <th>Sex</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>female</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>182</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>125</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>male</th>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>6</td>
      <td>1</td>
      <td>0</td>
      <td>2</td>
      <td>40</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>517</td>
      <td>0</td>
      <td>0</td>
      <td>6</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.crosstab(test[<span class="string">&#x27;Initial&#x27;</span>], test[<span class="string">&#x27;Sex&#x27;</span>]).T</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Initial</th>
      <th>Col</th>
      <th>Dona</th>
      <th>Dr</th>
      <th>Master</th>
      <th>Miss</th>
      <th>Mr</th>
      <th>Mrs</th>
      <th>Ms</th>
      <th>Rev</th>
    </tr>
    <tr>
      <th>Sex</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>female</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>78</td>
      <td>0</td>
      <td>72</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>male</th>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>21</td>
      <td>0</td>
      <td>240</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>



<ul>
<li>미성년자,  Miss, Mr , Mrs, Other</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">b4_title    = [<span class="string">&#x27;Mlle&#x27;</span>,<span class="string">&#x27;Mme&#x27;</span>,<span class="string">&#x27;Ms&#x27;</span>,<span class="string">&#x27;Dr&#x27;</span>,<span class="string">&#x27;Major&#x27;</span>,<span class="string">&#x27;Lady&#x27;</span>,<span class="string">&#x27;Countess&#x27;</span>,<span class="string">&#x27;Jonkheer&#x27;</span>,<span class="string">&#x27;Col&#x27;</span>,<span class="string">&#x27;Rev&#x27;</span>,<span class="string">&#x27;Capt&#x27;</span>,<span class="string">&#x27;Sir&#x27;</span>,<span class="string">&#x27;Don&#x27;</span>, <span class="string">&#x27;Dona&#x27;</span>]</span><br><span class="line">after_title = [<span class="string">&#x27;Miss&#x27;</span>,<span class="string">&#x27;Miss&#x27;</span>,<span class="string">&#x27;Miss&#x27;</span>,<span class="string">&#x27;Mr&#x27;</span>,<span class="string">&#x27;Mr&#x27;</span>,<span class="string">&#x27;Mrs&#x27;</span>,<span class="string">&#x27;Mrs&#x27;</span>,<span class="string">&#x27;Other&#x27;</span>,<span class="string">&#x27;Other&#x27;</span>,<span class="string">&#x27;Other&#x27;</span>,<span class="string">&#x27;Mr&#x27;</span>,<span class="string">&#x27;Mr&#x27;</span>,<span class="string">&#x27;Mr&#x27;</span>, <span class="string">&#x27;Miss&#x27;</span>]</span><br><span class="line"></span><br><span class="line">train_df[<span class="string">&#x27;Initial&#x27;</span>] = train_df[<span class="string">&#x27;Initial&#x27;</span>].replace(b4_title, after_title)</span><br><span class="line">train_df.shape</span><br></pre></td></tr></table></figure>




<pre><code>(891, 13)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">test[<span class="string">&#x27;Initial&#x27;</span>] = test[<span class="string">&#x27;Initial&#x27;</span>].replace(b4_title,after_title)</span><br><span class="line">test.shape</span><br></pre></td></tr></table></figure>




<pre><code>(418, 12)
</code></pre>
<ul>
<li>Initial그룹으로 평균연령을 구할 수 있음</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ini_age_df = train_df.groupby(<span class="string">&#x27;Initial&#x27;</span>)[<span class="string">&#x27;Age&#x27;</span>].mean()</span><br><span class="line">ini_age_df</span><br></pre></td></tr></table></figure>




<pre><code>Initial
Master     4.574167
Miss      21.860000
Mr        32.739609
Mrs       35.981818
Other     45.888889
Name: Age, dtype: float64
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ini_age_df[<span class="string">&#x27;Master&#x27;</span>]</span><br></pre></td></tr></table></figure>




<pre><code>4.574166666666667
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># train_df.loc[조건식,&#x27;age&#x27;]=33</span></span><br><span class="line">train_df.loc[(train_df[<span class="string">&#x27;Age&#x27;</span>].isnull())&amp;(train_df[<span class="string">&#x27;Initial&#x27;</span>]==<span class="string">&#x27;Mr&#x27;</span>),<span class="string">&#x27;Age&#x27;</span>]=<span class="number">33</span></span><br><span class="line">train_df.loc[(train_df[<span class="string">&#x27;Age&#x27;</span>].isnull())&amp;(train_df[<span class="string">&#x27;Initial&#x27;</span>]==<span class="string">&#x27;Mrs&#x27;</span>),<span class="string">&#x27;Age&#x27;</span>]=<span class="number">36</span></span><br><span class="line">train_df.loc[(train_df[<span class="string">&#x27;Age&#x27;</span>].isnull())&amp;(train_df[<span class="string">&#x27;Initial&#x27;</span>]==<span class="string">&#x27;Master&#x27;</span>),<span class="string">&#x27;Age&#x27;</span>]=<span class="number">5</span></span><br><span class="line">train_df.loc[(train_df[<span class="string">&#x27;Age&#x27;</span>].isnull())&amp;(train_df[<span class="string">&#x27;Initial&#x27;</span>]==<span class="string">&#x27;Miss&#x27;</span>),<span class="string">&#x27;Age&#x27;</span>]=<span class="number">22</span></span><br><span class="line">train_df.loc[(train_df[<span class="string">&#x27;Age&#x27;</span>].isnull())&amp;(train_df[<span class="string">&#x27;Initial&#x27;</span>]==<span class="string">&#x27;Other&#x27;</span>),<span class="string">&#x27;Age&#x27;</span>]=<span class="number">46</span></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ini_age_df_t=test.groupby(<span class="string">&#x27;Initial&#x27;</span>)[<span class="string">&#x27;Age&#x27;</span>].mean()</span><br><span class="line">ini_age_df_t</span><br></pre></td></tr></table></figure>




<pre><code>Initial
Master     7.406471
Miss      22.039846
Mr        32.114130
Mrs       38.903226
Other     42.750000
Name: Age, dtype: float64
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test.loc[조건식,&#x27;age&#x27;]=33</span></span><br><span class="line"><span class="comment">#test.loc[(train_df[&#x27;Age&#x27;].isnull())&amp;(train_df[&#x27;Initial&#x27;]==&#x27;Mr&#x27;),&#x27;Age&#x27;]=ini_age_df_t[&#x27;Mr&#x27;]</span></span><br><span class="line"><span class="comment">#test.loc[(train_df[&#x27;Age&#x27;].isnull())&amp;(train_df[&#x27;Initial&#x27;]==&#x27;Mrs&#x27;),&#x27;Age&#x27;]=ini_age_df_t[&#x27;Mrs&#x27;]</span></span><br><span class="line"><span class="comment">#test.loc[(train_df[&#x27;Age&#x27;].isnull())&amp;(train_df[&#x27;Initial&#x27;]==&#x27;Master&#x27;),&#x27;Age&#x27;]=ini_age_df_t[&#x27;Master&#x27;]</span></span><br><span class="line"><span class="comment">#test.loc[(train_df[&#x27;Age&#x27;].isnull())&amp;(train_df[&#x27;Initial&#x27;]==&#x27;Miss&#x27;),&#x27;Age&#x27;]=ini_age_df_t[&#x27;Miss&#x27;]</span></span><br><span class="line"><span class="comment">#test.loc[(train_df[&#x27;Age&#x27;].isnull())&amp;(train_df[&#x27;Initial&#x27;]==&#x27;Other&#x27;),&#x27;Age&#x27;]=ini_age_df_t[&#x27;Other&#x27;]</span></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">test.loc[(test[<span class="string">&#x27;Age&#x27;</span>].isnull())&amp;(test[<span class="string">&#x27;Initial&#x27;</span>]==<span class="string">&#x27;Mr&#x27;</span>),<span class="string">&#x27;Age&#x27;</span>]=<span class="number">33</span></span><br><span class="line">test.loc[(test[<span class="string">&#x27;Age&#x27;</span>].isnull())&amp;(test[<span class="string">&#x27;Initial&#x27;</span>]==<span class="string">&#x27;Mrs&#x27;</span>),<span class="string">&#x27;Age&#x27;</span>]=<span class="number">39</span></span><br><span class="line">test.loc[(test[<span class="string">&#x27;Age&#x27;</span>].isnull())&amp;(test[<span class="string">&#x27;Initial&#x27;</span>]==<span class="string">&#x27;Master&#x27;</span>),<span class="string">&#x27;Age&#x27;</span>]=<span class="number">8</span></span><br><span class="line">test.loc[(test[<span class="string">&#x27;Age&#x27;</span>].isnull())&amp;(test[<span class="string">&#x27;Initial&#x27;</span>]==<span class="string">&#x27;Miss&#x27;</span>),<span class="string">&#x27;Age&#x27;</span>]=<span class="number">22</span></span><br><span class="line">test.loc[(test[<span class="string">&#x27;Age&#x27;</span>].isnull())&amp;(test[<span class="string">&#x27;Initial&#x27;</span>]==<span class="string">&#x27;Other&#x27;</span>),<span class="string">&#x27;Age&#x27;</span>]=<span class="number">43</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Fare Median</span></span><br><span class="line">test[<span class="string">&#x27;Fare&#x27;</span>] = test[<span class="string">&#x27;Fare&#x27;</span>].fillna(np.mean(test[<span class="string">&#x27;Fare&#x27;</span>]))</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_df.info()</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 891 entries, 0 to 890
Data columns (total 13 columns):
 #   Column       Non-Null Count  Dtype  
---  ------       --------------  -----  
 0   PassengerId  891 non-null    int64  
 1   Survived     891 non-null    int64  
 2   Pclass       891 non-null    int64  
 3   Name         891 non-null    object 
 4   Sex          891 non-null    object 
 5   Age          891 non-null    float64
 6   SibSp        891 non-null    int64  
 7   Parch        891 non-null    int64  
 8   Ticket       891 non-null    object 
 9   Fare         891 non-null    float64
 10  Cabin        204 non-null    object 
 11  Embarked     889 non-null    object 
 12  Initial      891 non-null    object 
dtypes: float64(2), int64(5), object(6)
memory usage: 90.6+ KB
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test.info()</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 418 entries, 0 to 417
Data columns (total 12 columns):
 #   Column       Non-Null Count  Dtype  
---  ------       --------------  -----  
 0   PassengerId  418 non-null    int64  
 1   Pclass       418 non-null    int64  
 2   Name         418 non-null    object 
 3   Sex          418 non-null    object 
 4   Age          418 non-null    float64
 5   SibSp        418 non-null    int64  
 6   Parch        418 non-null    int64  
 7   Ticket       418 non-null    object 
 8   Fare         418 non-null    float64
 9   Cabin        91 non-null     object 
 10  Embarked     418 non-null    object 
 11  Initial      418 non-null    object 
dtypes: float64(2), int64(4), object(6)
memory usage: 39.3+ KB
</code></pre>
<ul>
<li>Embarked 결측치 채우기</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_df[<span class="string">&#x27;Embarked&#x27;</span>].value_counts()</span><br></pre></td></tr></table></figure>




<pre><code>S    644
C    168
Q     77
Name: Embarked, dtype: int64
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">train_df[<span class="string">&#x27;Embarked&#x27;</span>] = train_df[<span class="string">&#x27;Embarked&#x27;</span>].fillna(<span class="string">&#x27;S&#x27;</span>)</span><br><span class="line">train_df[<span class="string">&#x27;Embarked&#x27;</span>].isnull().<span class="built_in">sum</span>()</span><br></pre></td></tr></table></figure>




<pre><code>0
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">column = <span class="string">&quot;Initial&quot;</span></span><br><span class="line">plot_bar(train_df, column)</span><br></pre></td></tr></table></figure>


<p><img src="/images/day0718/output_49_0.png" alt="png"></p>
<h2 id="Feature-제거"><a href="#Feature-제거" class="headerlink" title="Feature 제거"></a>Feature 제거</h2><ul>
<li>불필요한 컬럼을 제거한다.<ul>
<li>Name피처 제거</li>
<li>Ticket 피처 제거(무작위 문자열)</li>
<li>Cabin은 결측치가 매우 많음</li>
<li>PassengerID 제거(학습내용이 없음)</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_df.shape, test.shape</span><br></pre></td></tr></table></figure>




<pre><code>((891, 13), (418, 12))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cols = [<span class="string">&#x27;Name&#x27;</span>,<span class="string">&#x27;Ticket&#x27;</span>,<span class="string">&#x27;Cabin&#x27;</span>,<span class="string">&#x27;PassengerId&#x27;</span>]</span><br><span class="line">train_df = train_df.drop(cols,axis =<span class="number">1</span>)</span><br><span class="line">test = test.drop(cols,axis =<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">train_df.shape, test.shape</span><br></pre></td></tr></table></figure>




<pre><code>((891, 9), (418, 8))
</code></pre>
<h2 id="인코딩-변환"><a href="#인코딩-변환" class="headerlink" title="인코딩 변환"></a>인코딩 변환</h2><ul>
<li>Ordinal Encoding, Label Encoding, One-Hot Encoding</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">train_df = pd.get_dummies(train_df)<span class="comment">#원핫인코딩</span></span><br><span class="line">test = pd.get_dummies(test)</span><br><span class="line"></span><br><span class="line">train_df.shape, test.shape</span><br></pre></td></tr></table></figure>




<pre><code>((891, 16), (418, 15))
</code></pre>
<h2 id="데이터-셋-분리"><a href="#데이터-셋-분리" class="headerlink" title="데이터 셋 분리"></a>데이터 셋 분리</h2><ul>
<li>분류학습 진행 시, 불균형데이터셋을 분리할 때 사용하는 코드</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">deceased = train_df[train_df[<span class="string">&#x27;Survived&#x27;</span>] == <span class="number">0</span>].sample(frac=<span class="number">0.5</span>, random_state=<span class="number">42</span>).reset_index(drop=<span class="literal">True</span>)</span><br><span class="line">survived = train_df[train_df[<span class="string">&#x27;Survived&#x27;</span>] == <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">deceased_train, deceased_test = train_test_split(deceased, test_size = <span class="number">0.2</span>, random_state=<span class="number">42</span>)</span><br><span class="line">survived_train, survived_test = train_test_split(survived, test_size = <span class="number">0.2</span>, random_state=<span class="number">42</span>)</span><br><span class="line"></span><br><span class="line">deceased_train, deceased_validate = train_test_split(deceased_train, test_size = <span class="number">0.25</span>, random_state=<span class="number">42</span>)</span><br><span class="line">survived_train, survived_validate = train_test_split(survived_train, test_size = <span class="number">0.25</span>, random_state=<span class="number">42</span>)</span><br><span class="line"></span><br><span class="line">deceased_train.shape, deceased_validate.shape, survived_train.shape, survived_validate.shape </span><br></pre></td></tr></table></figure>




<pre><code>((164, 16), (55, 16), (204, 16), (69, 16))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">X_train = pd.concat((deceased_train, survived_train))</span><br><span class="line">X_test = pd.concat((deceased_test, survived_test))</span><br><span class="line">X_validate = pd.concat((deceased_validate, survived_validate))</span><br><span class="line"></span><br><span class="line">y_train = np.array(X_train[<span class="string">&quot;Survived&quot;</span>])</span><br><span class="line">y_test = np.array(X_test[<span class="string">&quot;Survived&quot;</span>])</span><br><span class="line">y_validate = np.array(X_validate[<span class="string">&quot;Survived&quot;</span>])</span><br><span class="line"></span><br><span class="line">X_train = X_train.drop(<span class="string">&quot;Survived&quot;</span>, axis = <span class="number">1</span>)</span><br><span class="line">X_test = X_test.drop(<span class="string">&quot;Survived&quot;</span>, axis = <span class="number">1</span>)</span><br><span class="line">X_validate = X_validate.drop(<span class="string">&quot;Survived&quot;</span>, axis = <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">X_train.shape, X_validate.shape, X_test.shape, y_train.shape, y_validate.shape, y_test.shape</span><br></pre></td></tr></table></figure>




<pre><code>((368, 15), (124, 15), (124, 15), (368,), (124,), (124,))
</code></pre>
<h2 id="MLFlow-학습-및-평가"><a href="#MLFlow-학습-및-평가" class="headerlink" title="MLFlow 학습 및 평가"></a>MLFlow 학습 및 평가</h2><ul>
<li>모형 만들고 예측&#x2F;평가하고 제출하면 끝남.</li>
<li>과거에는 model.save(‘lr_model.pkl’)로 로컬에 저장</li>
<li>현재는 온라인에 저장<ul>
<li>각 MLOps 모델로 저장</li>
<li>각 모형마다 파라미터, 평가지표 각각 일일이 산출 –&gt; 기록</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">train</span>(<span class="params">ml_model, X_train, y_train</span>):</span><br><span class="line">    ml_model = ml_model.fit(X_train, y_train)</span><br><span class="line">    train_acc = ml_model.score(X_train, y_train)</span><br><span class="line">    mlflow.log_metric(<span class="string">&quot;train_acc&quot;</span>, train_acc) <span class="comment"># 이내용을 인터넷 상에 올린다</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Train Accuracy: (train_acc:.3%)&quot;</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">evaluate</span>(<span class="params">ml_model, X_test, y_test</span>):</span><br><span class="line">    eval_acc = ml_model.score(X_test, y_test)</span><br><span class="line">    preds = ml_model.predict(X_test)</span><br><span class="line">    auc_score = roc_auc_score(y_test, preds)</span><br><span class="line">    mlflow.log_metric(<span class="string">&quot;eval_acc&quot;</span>, eval_acc)</span><br><span class="line">    mlflow.log_metric(<span class="string">&quot;auc_score&quot;</span>, auc_score)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Auc Score : <span class="subst">&#123;auc_score:<span class="number">.3</span>%&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Eval Score : <span class="subst">&#123;eval_acc:<span class="number">.3</span>%&#125;</span>&quot;</span>)</span><br><span class="line">    roc_plot = plot_roc_curve(ml_model, X_test, y_test, name=<span class="string">&quot;Scikit-Learn ROC Curve&quot;</span>)</span><br><span class="line">    plt.savefig(<span class="string">&quot;sklearn_roc_plot.png&quot;</span>)</span><br><span class="line">    plt.show()</span><br><span class="line">    plt.clf()</span><br><span class="line">    conf_matrix = confusion_matrix(y_test, preds)<span class="comment"># 데이터 시각화</span></span><br><span class="line">    ax = sns.heatmap(conf_matrix, annot=<span class="literal">True</span>, fmt=<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">    ax.invert_xaxis()</span><br><span class="line">    ax.invert_yaxis()</span><br><span class="line">    plt.ylabel(<span class="string">&quot;Actual&quot;</span>)</span><br><span class="line">    plt.xlabel(<span class="string">&quot;Predicted&quot;</span>)</span><br><span class="line">    plt.title(<span class="string">&quot;Confusion Matrix&quot;</span>)</span><br><span class="line">    plt.savefig(<span class="string">&quot;sklearn_conf_matrix.png&quot;</span>)</span><br><span class="line">    mlflow.log_artifact(<span class="string">&quot;sklearn_roc_plot.png&quot;</span>)</span><br><span class="line">    mlflow.log_artifact(<span class="string">&quot;sklearn_conf_matrix.png&quot;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>테스트</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 모델 설정</span></span><br><span class="line">ml_model = LogisticRegression(random_state=<span class="literal">None</span>, max_iter=<span class="number">400</span>, solver=<span class="string">&#x27;newton-cg&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 실험 이름 설정</span></span><br><span class="line">mlflow.set_experiment(<span class="string">&quot;sklearn_experiment&quot;</span>) <span class="comment"># &quot;klearn_experiment&quot;속에 내용을 저장하겠다</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 해당 이름으로 실행 배치</span></span><br><span class="line"><span class="keyword">with</span> mlflow.start_run(): <span class="comment"># 시작</span></span><br><span class="line">    train(ml_model, X_train, y_train)</span><br><span class="line">    evaluate(ml_model, X_test, y_test)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 하나의 MLFlow 실행 컨텍스트에서 모든 코드를 묶을 수 있음. </span></span><br><span class="line">    <span class="comment"># 참조 : https://mlflow.org/docs/latest/models.html#model-customization</span></span><br><span class="line">    mlflow.sklearn.log_model(ml_model, <span class="string">&#x27;log_reg_model&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 본질적으로 모델과 지표가 로깅되는 현재 실행을 가져오고 출력함. </span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Model run: &quot;</span>, mlflow.active_run().info.run_uuid)</span><br><span class="line">mlflow.end_run() <span class="comment"># 종료</span></span><br></pre></td></tr></table></figure>

<pre><code>Train Accuracy: (train_acc:.3%)
Auc Score : 78.748%
Eval Score : 79.839%


C:\Users\human\Desktop\mlops_sample\venv\lib\site-packages\sklearn\utils\deprecation.py:87: FutureWarning: Function plot_roc_curve is deprecated; Function :func:`plot_roc_curve` is deprecated in 1.0 and will be removed in 1.2. Use one of the class methods: :meth:`sklearn.metric.RocCurveDisplay.from_predictions` or :meth:`sklearn.metric.RocCurveDisplay.from_estimator`.
  warnings.warn(msg, category=FutureWarning)
</code></pre>
<p><img src="/images/day0718/output_61_2.png" alt="png"></p>
<pre><code>Model run:  d8f27c06364c4d1191cd269b1948de72
</code></pre>
<p><img src="/images/day0718/output_61_4.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 인터넷 상의 주소를 가져온다</span></span><br><span class="line">ml_run_id = <span class="string">&#x27;runs:/d8f27c06364c4d1191cd269b1948de72/log_reg_model&#x27;</span></span><br><span class="line">loaded_model = mlflow.sklearn.load_model(ml_run_id)</span><br><span class="line"></span><br><span class="line">final_preds = loaded_model.predict(test)</span><br><span class="line">submission[<span class="string">&#x27;Survived&#x27;</span>]=final_preds</span><br><span class="line">submission.to_csv(DATA_PATH + <span class="string">&quot;submission.csv&quot;</span>, index=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>


</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-07-14T01:42:44.000Z" title="2022. 7. 14. 오전 10:42:44">2022-07-14</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-07-14T01:50:53.698Z" title="2022. 7. 14. 오전 10:50:53">2022-07-14</time></span><span class="level-item">28 minutes read (About 4268 words)</span></div></div><div class="content"><p><img src="/images/house-0713/image.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This Python 3 environment comes with many helpful analytics libraries installed</span></span><br><span class="line"><span class="comment"># It is defined by the kaggle/python Docker image: https://github.com/kaggle/docker-python</span></span><br><span class="line"><span class="comment"># For example, here&#x27;s several helpful packages to load</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np <span class="comment"># linear algebra</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd <span class="comment"># data processing, CSV file I/O (e.g. pd.read_csv)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Input data files are available in the read-only &quot;../input/&quot; directory</span></span><br><span class="line"><span class="comment"># For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">for</span> dirname, _, filenames <span class="keyword">in</span> os.walk(<span class="string">&#x27;/kaggle/input&#x27;</span>):</span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> filenames:</span><br><span class="line">        <span class="built_in">print</span>(os.path.join(dirname, filename))</span><br><span class="line"></span><br><span class="line"><span class="comment"># You can write up to 20GB to the current directory (/kaggle/working/) that gets preserved as output when you create a version using &quot;Save &amp; Run All&quot; </span></span><br><span class="line"><span class="comment"># You can also write temporary files to /kaggle/temp/, but they won&#x27;t be saved outside of the current session</span></span><br></pre></td></tr></table></figure>

<pre><code>/kaggle/input/house-prices-advanced-regression-techniques/sample_submission.csv
/kaggle/input/house-prices-advanced-regression-techniques/data_description.txt
/kaggle/input/house-prices-advanced-regression-techniques/train.csv
/kaggle/input/house-prices-advanced-regression-techniques/test.csv
</code></pre>
<h2 id="STEP1-필수라이브러리-불러오기"><a href="#STEP1-필수라이브러리-불러오기" class="headerlink" title="STEP1. 필수라이브러리 불러오기"></a>STEP1. 필수라이브러리 불러오기</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd </span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np </span><br><span class="line"><span class="keyword">import</span> matplotlib <span class="keyword">as</span> mpl </span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns </span><br><span class="line"><span class="keyword">import</span> sklearn</span><br><span class="line"><span class="keyword">import</span> xgboost <span class="keyword">as</span> xgb </span><br><span class="line"><span class="keyword">import</span> lightgbm <span class="keyword">as</span> lgb</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;pandas version :&quot;</span>, pd.__version__)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;numpy version :&quot;</span>, np.__version__)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;matplotlib version :&quot;</span>, mpl.__version__)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;seaborn version :&quot;</span>, sns.__version__)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;scikit-learn version :&quot;</span>, sklearn.__version__)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;xgboost version :&quot;</span>, xgb.__version__)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;lightgbm version :&quot;</span>, lgb.__version__)</span><br></pre></td></tr></table></figure>


<style type='text/css'>
.datatable table.frame { margin-bottom: 0; }
.datatable table.frame thead { border-bottom: none; }
.datatable table.frame tr.coltypes td {  color: #FFFFFF;  line-height: 6px;  padding: 0 0.5em;}
.datatable .bool    { background: #DDDD99; }
.datatable .object  { background: #565656; }
.datatable .int     { background: #5D9E5D; }
.datatable .float   { background: #4040CC; }
.datatable .str     { background: #CC4040; }
.datatable .time    { background: #40CC40; }
.datatable .row_index {  background: var(--jp-border-color3);  border-right: 1px solid var(--jp-border-color0);  color: var(--jp-ui-font-color3);  font-size: 9px;}
.datatable .frame tbody td { text-align: left; }
.datatable .frame tr.coltypes .row_index {  background: var(--jp-border-color0);}
.datatable th:nth-child(2) { padding-left: 12px; }
.datatable .hellipsis {  color: var(--jp-cell-editor-border-color);}
.datatable .vellipsis {  background: var(--jp-layout-color0);  color: var(--jp-cell-editor-border-color);}
.datatable .na {  color: var(--jp-cell-editor-border-color);  font-size: 80%;}
.datatable .sp {  opacity: 0.25;}
.datatable .footer { font-size: 9px; }
.datatable .frame_dimensions {  background: var(--jp-border-color3);  border-top: 1px solid var(--jp-border-color0);  color: var(--jp-ui-font-color3);  display: inline-block;  opacity: 0.6;  padding: 1px 10px 1px 5px;}
</style>



<pre><code>pandas version : 1.3.5
numpy version : 1.21.6
matplotlib version : 3.5.2
seaborn version : 0.11.2
scikit-learn version : 1.0.2
xgboost version : 1.6.1
lightgbm version : 3.3.2
</code></pre>
<h2 id="STEP2-데이터-불러오기"><a href="#STEP2-데이터-불러오기" class="headerlink" title="STEP2.데이터 불러오기"></a>STEP2.데이터 불러오기</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DATA_PATH = <span class="string">&#x27;/kaggle/input/house-prices-advanced-regression-techniques/&#x27;</span></span><br><span class="line">train = pd.read_csv(DATA_PATH + <span class="string">&quot;train.csv&quot;</span>)</span><br><span class="line">test = pd.read_csv(DATA_PATH + <span class="string">&quot;test.csv&quot;</span>)</span><br><span class="line">submission = pd.read_csv(DATA_PATH + <span class="string">&#x27;sample_submission.csv&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;데이터 불러오기 완료!&quot;</span>)</span><br></pre></td></tr></table></figure>

<pre><code>데이터 불러오기 완료!
</code></pre>
<h2 id="STEP3-데이터-둘러보기"><a href="#STEP3-데이터-둘러보기" class="headerlink" title="STEP3.데이터 둘러보기"></a>STEP3.데이터 둘러보기</h2><ul>
<li>데이터 변수 파악</li>
<li>데이터 전처리</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(train.shape, test.shape, submission.shape)</span><br></pre></td></tr></table></figure>

<pre><code>(1460, 81) (1459, 80) (1459, 2)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(train.info())</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 1460 entries, 0 to 1459
Data columns (total 81 columns):
 #   Column         Non-Null Count  Dtype  
---  ------         --------------  -----  
 0   Id             1460 non-null   int64  
 1   MSSubClass     1460 non-null   int64  
 2   MSZoning       1460 non-null   object 
 3   LotFrontage    1201 non-null   float64
 4   LotArea        1460 non-null   int64  
 5   Street         1460 non-null   object 
 6   Alley          91 non-null     object 
 7   LotShape       1460 non-null   object 
 8   LandContour    1460 non-null   object 
 9   Utilities      1460 non-null   object 
 10  LotConfig      1460 non-null   object 
 11  LandSlope      1460 non-null   object 
 12  Neighborhood   1460 non-null   object 
 13  Condition1     1460 non-null   object 
 14  Condition2     1460 non-null   object 
 15  BldgType       1460 non-null   object 
 16  HouseStyle     1460 non-null   object 
 17  OverallQual    1460 non-null   int64  
 18  OverallCond    1460 non-null   int64  
 19  YearBuilt      1460 non-null   int64  
 20  YearRemodAdd   1460 non-null   int64  
 21  RoofStyle      1460 non-null   object 
 22  RoofMatl       1460 non-null   object 
 23  Exterior1st    1460 non-null   object 
 24  Exterior2nd    1460 non-null   object 
 25  MasVnrType     1452 non-null   object 
 26  MasVnrArea     1452 non-null   float64
 27  ExterQual      1460 non-null   object 
 28  ExterCond      1460 non-null   object 
 29  Foundation     1460 non-null   object 
 30  BsmtQual       1423 non-null   object 
 31  BsmtCond       1423 non-null   object 
 32  BsmtExposure   1422 non-null   object 
 33  BsmtFinType1   1423 non-null   object 
 34  BsmtFinSF1     1460 non-null   int64  
 35  BsmtFinType2   1422 non-null   object 
 36  BsmtFinSF2     1460 non-null   int64  
 37  BsmtUnfSF      1460 non-null   int64  
 38  TotalBsmtSF    1460 non-null   int64  
 39  Heating        1460 non-null   object 
 40  HeatingQC      1460 non-null   object 
 41  CentralAir     1460 non-null   object 
 42  Electrical     1459 non-null   object 
 43  1stFlrSF       1460 non-null   int64  
 44  2ndFlrSF       1460 non-null   int64  
 45  LowQualFinSF   1460 non-null   int64  
 46  GrLivArea      1460 non-null   int64  
 47  BsmtFullBath   1460 non-null   int64  
 48  BsmtHalfBath   1460 non-null   int64  
 49  FullBath       1460 non-null   int64  
 50  HalfBath       1460 non-null   int64  
 51  BedroomAbvGr   1460 non-null   int64  
 52  KitchenAbvGr   1460 non-null   int64  
 53  KitchenQual    1460 non-null   object 
 54  TotRmsAbvGrd   1460 non-null   int64  
 55  Functional     1460 non-null   object 
 56  Fireplaces     1460 non-null   int64  
 57  FireplaceQu    770 non-null    object 
 58  GarageType     1379 non-null   object 
 59  GarageYrBlt    1379 non-null   float64
 60  GarageFinish   1379 non-null   object 
 61  GarageCars     1460 non-null   int64  
 62  GarageArea     1460 non-null   int64  
 63  GarageQual     1379 non-null   object 
 64  GarageCond     1379 non-null   object 
 65  PavedDrive     1460 non-null   object 
 66  WoodDeckSF     1460 non-null   int64  
 67  OpenPorchSF    1460 non-null   int64  
 68  EnclosedPorch  1460 non-null   int64  
 69  3SsnPorch      1460 non-null   int64  
 70  ScreenPorch    1460 non-null   int64  
 71  PoolArea       1460 non-null   int64  
 72  PoolQC         7 non-null      object 
 73  Fence          281 non-null    object 
 74  MiscFeature    54 non-null     object 
 75  MiscVal        1460 non-null   int64  
 76  MoSold         1460 non-null   int64  
 77  YrSold         1460 non-null   int64  
 78  SaleType       1460 non-null   object 
 79  SaleCondition  1460 non-null   object 
 80  SalePrice      1460 non-null   int64  
dtypes: float64(3), int64(35), object(43)
memory usage: 924.0+ KB
None
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(test.info())</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 1459 entries, 0 to 1458
Data columns (total 80 columns):
 #   Column         Non-Null Count  Dtype  
---  ------         --------------  -----  
 0   Id             1459 non-null   int64  
 1   MSSubClass     1459 non-null   int64  
 2   MSZoning       1455 non-null   object 
 3   LotFrontage    1232 non-null   float64
 4   LotArea        1459 non-null   int64  
 5   Street         1459 non-null   object 
 6   Alley          107 non-null    object 
 7   LotShape       1459 non-null   object 
 8   LandContour    1459 non-null   object 
 9   Utilities      1457 non-null   object 
 10  LotConfig      1459 non-null   object 
 11  LandSlope      1459 non-null   object 
 12  Neighborhood   1459 non-null   object 
 13  Condition1     1459 non-null   object 
 14  Condition2     1459 non-null   object 
 15  BldgType       1459 non-null   object 
 16  HouseStyle     1459 non-null   object 
 17  OverallQual    1459 non-null   int64  
 18  OverallCond    1459 non-null   int64  
 19  YearBuilt      1459 non-null   int64  
 20  YearRemodAdd   1459 non-null   int64  
 21  RoofStyle      1459 non-null   object 
 22  RoofMatl       1459 non-null   object 
 23  Exterior1st    1458 non-null   object 
 24  Exterior2nd    1458 non-null   object 
 25  MasVnrType     1443 non-null   object 
 26  MasVnrArea     1444 non-null   float64
 27  ExterQual      1459 non-null   object 
 28  ExterCond      1459 non-null   object 
 29  Foundation     1459 non-null   object 
 30  BsmtQual       1415 non-null   object 
 31  BsmtCond       1414 non-null   object 
 32  BsmtExposure   1415 non-null   object 
 33  BsmtFinType1   1417 non-null   object 
 34  BsmtFinSF1     1458 non-null   float64
 35  BsmtFinType2   1417 non-null   object 
 36  BsmtFinSF2     1458 non-null   float64
 37  BsmtUnfSF      1458 non-null   float64
 38  TotalBsmtSF    1458 non-null   float64
 39  Heating        1459 non-null   object 
 40  HeatingQC      1459 non-null   object 
 41  CentralAir     1459 non-null   object 
 42  Electrical     1459 non-null   object 
 43  1stFlrSF       1459 non-null   int64  
 44  2ndFlrSF       1459 non-null   int64  
 45  LowQualFinSF   1459 non-null   int64  
 46  GrLivArea      1459 non-null   int64  
 47  BsmtFullBath   1457 non-null   float64
 48  BsmtHalfBath   1457 non-null   float64
 49  FullBath       1459 non-null   int64  
 50  HalfBath       1459 non-null   int64  
 51  BedroomAbvGr   1459 non-null   int64  
 52  KitchenAbvGr   1459 non-null   int64  
 53  KitchenQual    1458 non-null   object 
 54  TotRmsAbvGrd   1459 non-null   int64  
 55  Functional     1457 non-null   object 
 56  Fireplaces     1459 non-null   int64  
 57  FireplaceQu    729 non-null    object 
 58  GarageType     1383 non-null   object 
 59  GarageYrBlt    1381 non-null   float64
 60  GarageFinish   1381 non-null   object 
 61  GarageCars     1458 non-null   float64
 62  GarageArea     1458 non-null   float64
 63  GarageQual     1381 non-null   object 
 64  GarageCond     1381 non-null   object 
 65  PavedDrive     1459 non-null   object 
 66  WoodDeckSF     1459 non-null   int64  
 67  OpenPorchSF    1459 non-null   int64  
 68  EnclosedPorch  1459 non-null   int64  
 69  3SsnPorch      1459 non-null   int64  
 70  ScreenPorch    1459 non-null   int64  
 71  PoolArea       1459 non-null   int64  
 72  PoolQC         3 non-null      object 
 73  Fence          290 non-null    object 
 74  MiscFeature    51 non-null     object 
 75  MiscVal        1459 non-null   int64  
 76  MoSold         1459 non-null   int64  
 77  YrSold         1459 non-null   int64  
 78  SaleType       1458 non-null   object 
 79  SaleCondition  1459 non-null   object 
dtypes: float64(11), int64(26), object(43)
memory usage: 912.0+ KB
None
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(submission.info())</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 1459 entries, 0 to 1458
Data columns (total 2 columns):
 #   Column     Non-Null Count  Dtype  
---  ------     --------------  -----  
 0   Id         1459 non-null   int64  
 1   SalePrice  1459 non-null   float64
dtypes: float64(1), int64(1)
memory usage: 22.9 KB
None
</code></pre>
<h3 id="데이터-변수-칼럼-살펴보기"><a href="#데이터-변수-칼럼-살펴보기" class="headerlink" title="데이터 변수(칼럼) 살펴보기"></a>데이터 변수(칼럼) 살펴보기</h3><ol>
<li>SalePrice 집가격</li>
<li>OverallQual 집재료 및 마감평가</li>
<li>GrLivArea 지상 거실 면적</li>
<li>GarageArea 차고 크기</li>
<li>TotalBsmtSF 지하 총 면적</li>
<li>1stFlrSF 1층 면적</li>
<li>FullBath 전체 욕실</li>
<li>TotRmsAbvGrd 총 실수(욕실 미포함)</li>
<li>YearBuilt 건축년도</li>
<li>YearRemodAdd 리모델링년도</li>
<li>Fireplaces 벽난로 수</li>
<li>BsmtFinSF1 </li>
<li>LotFrontage</li>
<li>2ndFlrSF</li>
<li>HalfBath</li>
<li>LotArea</li>
<li>BsmtFullBath</li>
<li>BedroomAbvG</li>
<li>BsmtFinBath</li>
<li>BsmtHalfBath</li>
<li>LowQualfinSF</li>
<li>OverallCond</li>
<li>MSSubClass</li>
<li>KitchenAbvGr</li>
</ol>
<ul>
<li>-&gt;데이터 변수가 79개나 된다. 제거해도 될만한 컬럼을 제거해보자.</li>
</ul>
<h3 id="데이터-변수-칼럼-살펴보기-1"><a href="#데이터-변수-칼럼-살펴보기-1" class="headerlink" title="데이터 변수(칼럼) 살펴보기"></a>데이터 변수(칼럼) 살펴보기</h3><ol>
<li>SalePrice 집가격</li>
<li>OverallQual 집재료 및 마감평가</li>
<li>GrLivArea 지상 거실 면적</li>
<li>GarageArea 차고 크기</li>
<li>GarageCars 차고 대수</li>
<li>TotalBsmtSF 1층(기본층) 총 면적</li>
<li>1stFlrSF 2층 면적</li>
<li>FullBath 전체 욕실들(욕조,샤워,변기,세면대) </li>
<li>TotRmsAbvGrd 총 실수(욕실 미포함)</li>
<li>YearBuilt 건축년도</li>
<li>YearRemodAdd 리모델링 년도</li>
<li>GarageYrBlt 차고만든 년도</li>
<li>MasVnrArea 석조표면마무리 면적</li>
<li>Fireplaces 벽난로 수</li>
<li>BsmtFinSF1 지층 1차마감 면의 질 </li>
<li>LotFrontage 집과 연결된 길까지의 거리</li>
<li>2ndFlrSF 3층 면적</li>
<li>HalfBath 반쪽 욕실들(양변기,세면대)</li>
<li>OpenPorchSF 열린 현관 면적</li>
<li>LotArea 대지면적</li>
<li>BsmtFullBath 지층 풀 욕실</li>
<li>BedroomAbvG 지층포함 위쪽 침실</li>
<li>ScreenPorch 그물 현관 면적</li>
<li>PoolArea 수영장면적</li>
<li>MoSold 팔린 달</li>
<li>BsmtFinsF2 지층 2차마감 면의 질</li>
<li>BsmtHalfBath 지층의 반쪽 면적</li>
<li>LowQualfinSF 전층에서 낮은 마감의 면</li>
<li>OverallCond 전체적인 조건 평가</li>
<li>MSSubClass 건물특성별 점수</li>
<li>EnclosedPorch 막힌 현관 면적</li>
<li>KitchenAbvGr 부엌 수</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 상관분석</span></span><br><span class="line">train.corrwith(train[<span class="string">&#x27;SalePrice&#x27;</span>]).sort_values(ascending=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>




<pre><code>SalePrice        1.000000
OverallQual      0.790982
GrLivArea        0.708624
GarageCars       0.640409
GarageArea       0.623431
TotalBsmtSF      0.613581
1stFlrSF         0.605852
FullBath         0.560664
TotRmsAbvGrd     0.533723
YearBuilt        0.522897
YearRemodAdd     0.507101
GarageYrBlt      0.486362
MasVnrArea       0.477493
Fireplaces       0.466929
BsmtFinSF1       0.386420
LotFrontage      0.351799
WoodDeckSF       0.324413
2ndFlrSF         0.319334
OpenPorchSF      0.315856
HalfBath         0.284108
LotArea          0.263843
BsmtFullBath     0.227122
BsmtUnfSF        0.214479
BedroomAbvGr     0.168213
ScreenPorch      0.111447
PoolArea         0.092404
MoSold           0.046432
3SsnPorch        0.044584
BsmtFinSF2      -0.011378
BsmtHalfBath    -0.016844
MiscVal         -0.021190
Id              -0.021917
LowQualFinSF    -0.025606
YrSold          -0.028923
OverallCond     -0.077856
MSSubClass      -0.084284
EnclosedPorch   -0.128578
KitchenAbvGr    -0.135907
dtype: float64
</code></pre>
<ul>
<li>강한 상관치가 보이는 데이터는 OverallQual, GarageCars, GarageArea, TotalBsmtSF, 1stFlrSF, FullBath, TotRmsAbvGrd,  YearBuilt, YearRemodAdd를 우선적으로 선택한다.     </li>
<li>결측치가 보이는 데이터는 보완  생략을 한다.</li>
</ul>
<h2 id="STEP4-탐색적-자료분석"><a href="#STEP4-탐색적-자료분석" class="headerlink" title="STEP4. 탐색적 자료분석"></a>STEP4. 탐색적 자료분석</h2><ul>
<li>시각화<ul>
<li>타겟변수의 상태 확인</li>
<li>변수와 종속변수(SalePrice)의 시각화</li>
</ul>
</li>
</ul>
<h3 id="1-타겟변수-SalePricce-를-확인하여-시각화-해본다"><a href="#1-타겟변수-SalePricce-를-확인하여-시각화-해본다" class="headerlink" title="1.타겟변수(SalePricce)를 확인하여 시각화 해본다."></a>1.타겟변수(SalePricce)를 확인하여 시각화 해본다.</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt </span><br><span class="line"><span class="keyword">from</span> scipy.stats <span class="keyword">import</span> norm </span><br><span class="line">(mu, sigma) = norm.fit(train[<span class="string">&#x27;SalePrice&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;평균:&quot;</span>, mu)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;표준편차:&quot;</span>, sigma)</span><br><span class="line"></span><br><span class="line">fig, ax = plt.subplots(figsize=(<span class="number">10</span>, <span class="number">6</span>))</span><br><span class="line">sns.histplot(train[<span class="string">&#x27;SalePrice&#x27;</span>])</span><br><span class="line">ax.<span class="built_in">set</span>(title=<span class="string">&quot;SalePrice Distribution&quot;</span>)</span><br><span class="line">ax.axvline(mu, color = <span class="string">&#x27;r&#x27;</span>, linestyle = <span class="string">&#x27;--&#x27;</span>)</span><br><span class="line">ax.text(mu + <span class="number">10000</span>, <span class="number">160</span>, <span class="string">&#x27;Mean of SalePrice&#x27;</span>, color = <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<pre><code>평균: 180921.19589041095
표준편차: 79415.29188606751
</code></pre>
<p><img src="/images/house-0713/output_17_1.png" alt="png"></p>
<h3 id="2-변수와-종속변수-SalePrice-의-시각화"><a href="#2-변수와-종속변수-SalePrice-의-시각화" class="headerlink" title="2. 변수와 종속변수(SalePrice)의 시각화"></a>2. 변수와 종속변수(SalePrice)의 시각화</h3><ul>
<li>상관계수가 0.4이상의 히트맵 그래프를 그려본다.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">corrmat = train.corr()</span><br><span class="line">top_corr_features = corrmat.index[<span class="built_in">abs</span>(corrmat[<span class="string">&quot;SalePrice&quot;</span>])&gt;=<span class="number">0.4</span>]</span><br><span class="line"><span class="comment">#히트맵</span></span><br><span class="line">plt.figure(figsize=(<span class="number">13</span>,<span class="number">10</span>))</span><br><span class="line">sns.heatmap(train[top_corr_features].corr(),annot=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>




<pre><code>&lt;AxesSubplot:&gt;
</code></pre>
<p><img src="/images/house-0713/output_19_1.png" alt="png"></p>
<ul>
<li><p>OverallQual, GarageCars와 GarageArea(0.88), GrLiveArea와 TotRmsAbvGrd(0.82), TotalBsmtSF와 1stFlrSF(0.82), GarageYtBuilk와 YearBuilt(0.83),FullBath, YearRemodAdd인 것을 보았을 때 </p>
</li>
<li><p>OverallQual(0.79)&gt;GrLiveArea(0.71)&gt;GarageCars(0.64)&gt; TotalBsmtSF(0.61)&gt;YearBulit(0.52)&gt;FullBath(0.56)&gt;YearRemodAdd(0.51)만을 사용한다.</p>
</li>
<li><p>이중 TotalBsmtSF,GarageCars는 결측치가 있기에 채우도록 하자.</p>
</li>
<li><p>집재료 및 마감평가&gt;지상 거실 면적&gt; 차고대수 &gt; 지층 총면적 &gt; 건축연도 &gt; 전체욕실들 &gt; 리모델링 연도</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">fig, ((ax1, ax2), (ax3, ax4),(ax5,ax6)) = plt.subplots(nrows=<span class="number">3</span>, ncols=<span class="number">2</span>, figsize=(<span class="number">16</span>,<span class="number">13</span>)) </span><br><span class="line"><span class="comment"># SP - OverallQual</span></span><br><span class="line">OverallQual_scatter_plot = pd.concat([train[<span class="string">&#x27;SalePrice&#x27;</span>],train[<span class="string">&#x27;OverallQual&#x27;</span>]],axis = <span class="number">1</span>) </span><br><span class="line">sns.regplot(x=<span class="string">&#x27;OverallQual&#x27;</span>,y = <span class="string">&#x27;SalePrice&#x27;</span>,data = OverallQual_scatter_plot,scatter= <span class="literal">True</span>, fit_reg=<span class="literal">True</span>, ax=ax1) </span><br><span class="line"></span><br><span class="line"><span class="comment"># SP - TotalBsmtSF</span></span><br><span class="line">TotalBsmtSF_scatter_plot = pd.concat([train[<span class="string">&#x27;SalePrice&#x27;</span>],train[<span class="string">&#x27;TotalBsmtSF&#x27;</span>]],axis = <span class="number">1</span>) </span><br><span class="line">sns.regplot(x=<span class="string">&#x27;TotalBsmtSF&#x27;</span>,y = <span class="string">&#x27;SalePrice&#x27;</span>,data = TotalBsmtSF_scatter_plot,scatter= <span class="literal">True</span>, fit_reg=<span class="literal">True</span>, ax=ax2) </span><br><span class="line"></span><br><span class="line"><span class="comment"># SP - GrLivArea</span></span><br><span class="line">GrLivArea_scatter_plot = pd.concat([train[<span class="string">&#x27;SalePrice&#x27;</span>],train[<span class="string">&#x27;GrLivArea&#x27;</span>]],axis = <span class="number">1</span>) </span><br><span class="line">sns.regplot(x=<span class="string">&#x27;GrLivArea&#x27;</span>,y = <span class="string">&#x27;SalePrice&#x27;</span>,data = GrLivArea_scatter_plot,scatter= <span class="literal">True</span>, fit_reg=<span class="literal">True</span>, ax=ax3) </span><br><span class="line"></span><br><span class="line"><span class="comment"># SP - GarageCars</span></span><br><span class="line">GarageCars_scatter_plot = pd.concat([train[<span class="string">&#x27;SalePrice&#x27;</span>],train[<span class="string">&#x27;GarageCars&#x27;</span>]],axis = <span class="number">1</span>) </span><br><span class="line">sns.regplot(x=<span class="string">&#x27;GarageCars&#x27;</span>,y = <span class="string">&#x27;SalePrice&#x27;</span>,data = GarageCars_scatter_plot,scatter= <span class="literal">True</span>, fit_reg=<span class="literal">True</span>, ax=ax4) </span><br><span class="line"></span><br><span class="line"><span class="comment"># SP - FullBath</span></span><br><span class="line">FullBath_scatter_plot = pd.concat([train[<span class="string">&#x27;SalePrice&#x27;</span>],train[<span class="string">&#x27;FullBath&#x27;</span>]],axis = <span class="number">1</span>) </span><br><span class="line">sns.regplot(x=<span class="string">&#x27;FullBath&#x27;</span>,y = <span class="string">&#x27;SalePrice&#x27;</span>,data = FullBath_scatter_plot,scatter= <span class="literal">True</span>, fit_reg=<span class="literal">True</span>, ax=ax5) </span><br><span class="line"></span><br><span class="line"><span class="comment"># SP - YearBuilt</span></span><br><span class="line">YearBuilt_scatter_plot = pd.concat([train[<span class="string">&#x27;SalePrice&#x27;</span>],train[<span class="string">&#x27;YearBuilt&#x27;</span>]],axis = <span class="number">1</span>) </span><br><span class="line">sns.regplot(x=<span class="string">&#x27;YearBuilt&#x27;</span>,y = <span class="string">&#x27;SalePrice&#x27;</span>,data = YearBuilt_scatter_plot,scatter= <span class="literal">True</span>, fit_reg=<span class="literal">True</span>, ax=ax6) </span><br><span class="line"></span><br><span class="line"><span class="comment"># SP - YearRemodAdd</span></span><br><span class="line">YearRemodAdd_scatter_plot = pd.concat([train[<span class="string">&#x27;SalePrice&#x27;</span>],train[<span class="string">&#x27;YearRemodAdd&#x27;</span>]],axis = <span class="number">1</span>) </span><br><span class="line">YearRemodAdd_scatter_plot.plot.scatter(<span class="string">&#x27;YearRemodAdd&#x27;</span>,<span class="string">&#x27;SalePrice&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>




<pre><code>&lt;AxesSubplot:xlabel=&#39;YearRemodAdd&#39;, ylabel=&#39;SalePrice&#39;&gt;
</code></pre>
<p><img src="/images/house-0713/output_21_1.png" alt="png"></p>
<p><img src="/images/house-0713/output_21_2.png" alt="png"></p>
<ul>
<li>OverallQual, GarageCars, FullBath는 범주형의 형태</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">fig, ax = plt.subplots(nrows = <span class="number">1</span>, ncols = <span class="number">3</span>)</span><br><span class="line">fig.tight_layout()</span><br><span class="line">fig.set_size_inches(<span class="number">15</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">sns.boxplot(x = <span class="string">&#x27;OverallQual&#x27;</span>, y = <span class="string">&#x27;SalePrice&#x27;</span>, data = train, ax=ax[<span class="number">0</span>])</span><br><span class="line">sns.boxplot(x = <span class="string">&#x27;GarageCars&#x27;</span>,y = <span class="string">&#x27;SalePrice&#x27;</span>, data = train, ax=ax[<span class="number">1</span>])</span><br><span class="line">sns.boxplot(x = <span class="string">&#x27;FullBath&#x27;</span>, y = <span class="string">&#x27;SalePrice&#x27;</span>, data = train, ax=ax[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">ax[<span class="number">0</span>].set_title(<span class="string">&quot;OverallQualr&quot;</span>)</span><br><span class="line">ax[<span class="number">1</span>].set_title(<span class="string">&quot;GarageCars&quot;</span>)</span><br><span class="line">ax[<span class="number">2</span>].set_title(<span class="string">&quot;FullBath&quot;</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>


<p><img src="/images/house-0713/output_23_0.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##### 범주형 변수와 가격사이의 비교</span></span><br><span class="line">figure, ((ax1,ax2,ax3,ax4), (ax5,ax6,ax7,ax8)) = plt.subplots(nrows=<span class="number">2</span>, ncols=<span class="number">4</span>)</span><br><span class="line">figure.set_size_inches(<span class="number">18</span>,<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">sns.barplot(data=train, x=<span class="string">&quot;MSSubClass&quot;</span>, y=<span class="string">&quot;SalePrice&quot;</span>, ax=ax1)</span><br><span class="line">sns.barplot(data=train, x=<span class="string">&quot;LotShape&quot;</span>, y=<span class="string">&quot;SalePrice&quot;</span>, ax=ax2)</span><br><span class="line">sns.barplot(data=train, x=<span class="string">&quot;BldgType&quot;</span>, y=<span class="string">&quot;SalePrice&quot;</span>, ax=ax3)</span><br><span class="line">sns.barplot(data=train, x=<span class="string">&quot;HouseStyle&quot;</span>, y=<span class="string">&quot;SalePrice&quot;</span>, ax=ax4)</span><br><span class="line">sns.barplot(data=train, x=<span class="string">&quot;KitchenAbvGr&quot;</span>, y=<span class="string">&quot;SalePrice&quot;</span>, ax=ax5)</span><br><span class="line">sns.barplot(data=train, x=<span class="string">&quot;Functional&quot;</span>, y=<span class="string">&quot;SalePrice&quot;</span>, ax=ax6)</span><br><span class="line">sns.barplot(data=train, x=<span class="string">&quot;SaleType&quot;</span>, y=<span class="string">&quot;SalePrice&quot;</span>, ax=ax7)</span><br><span class="line">sns.barplot(data=train, x=<span class="string">&quot;SaleCondition&quot;</span>, y=<span class="string">&quot;SalePrice&quot;</span>, ax=ax8)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ax1.set(ylabel=&#x27;주거타입&#x27;,title=&quot;연도별 가격&quot;)</span></span><br><span class="line"><span class="comment"># ax2.set(xlabel=&#x27;부지모양&#x27;,title=&quot;월별 가격&quot;)</span></span><br><span class="line"><span class="comment"># ax3.set(xlabel=&#x27;주거 타입&#x27;, title=&quot;일별 가격&quot;)</span></span><br><span class="line"><span class="comment"># ax4.set(xlabel=&#x27;주거 스타일&#x27;, title=&quot;시간별 가격&quot;)</span></span><br><span class="line"><span class="comment"># ax4.set(xlabel=&#x27;최초공사년도&#x27;, title=&quot;시간별 가격&quot;)</span></span><br><span class="line"><span class="comment"># ax4.set(xlabel=&#x27;리모델링년도&#x27;, title=&quot;시간별 가격&quot;)</span></span><br></pre></td></tr></table></figure>




<pre><code>&lt;AxesSubplot:xlabel=&#39;SaleCondition&#39;, ylabel=&#39;SalePrice&#39;&gt;
</code></pre>
<p><img src="/images/house-0713/output_24_1.png" alt="png"></p>
<h2 id="STEP5-데이터-전처리"><a href="#STEP5-데이터-전처리" class="headerlink" title="STEP5. 데이터 전처리"></a>STEP5. 데이터 전처리</h2><ul>
<li></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 데이터 ID값 제거</span></span><br><span class="line">train_ID = train[<span class="string">&#x27;Id&#x27;</span>]</span><br><span class="line">test_ID = test[<span class="string">&#x27;Id&#x27;</span>]</span><br><span class="line"></span><br><span class="line">train_t = train.drop([<span class="string">&#x27;Id&#x27;</span>], axis = <span class="number">1</span>)</span><br><span class="line">test_t = test.drop([<span class="string">&#x27;Id&#x27;</span>], axis = <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(train_t.shape,test_t.shape)</span><br></pre></td></tr></table></figure>

<pre><code>(1460, 80) (1459, 79)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#로그 안된 세일가격포함 데이터 합치기</span></span><br><span class="line">all_ds = pd.concat([train_t, test_t]).reset_index(drop=<span class="literal">True</span>)</span><br><span class="line">all_ds.shape</span><br></pre></td></tr></table></figure>




<pre><code>(2919, 80)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GrLivArea_scatter_plot = pd.concat([train[<span class="string">&#x27;SalePrice&#x27;</span>],train[<span class="string">&#x27;GrLivArea&#x27;</span>]],axis = <span class="number">1</span>) </span><br><span class="line">sns.regplot(x=<span class="string">&#x27;GrLivArea&#x27;</span>,y = <span class="string">&#x27;SalePrice&#x27;</span>,data = GrLivArea_scatter_plot,scatter= <span class="literal">True</span>, fit_reg=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>




<pre><code>&lt;AxesSubplot:xlabel=&#39;GrLivArea&#39;, ylabel=&#39;SalePrice&#39;&gt;
</code></pre>
<p><img src="/images/house-0713/output_28_1.png" alt="png"></p>
<ul>
<li>왼쪽 2개는 이상치인데 제거해야하나 말아야 하나….</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 로그변환을 함. </span></span><br><span class="line">train[<span class="string">&#x27;SalePrice&#x27;</span>] = np.log1p(train[<span class="string">&#x27;SalePrice&#x27;</span>])</span><br><span class="line"></span><br><span class="line">(mu, sigma) = norm.fit(train[<span class="string">&#x27;SalePrice&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;평균:&quot;</span>, mu)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;표준편차:&quot;</span>, sigma)</span><br><span class="line"></span><br><span class="line">fig, ax = plt.subplots(figsize=(<span class="number">10</span>, <span class="number">6</span>))</span><br><span class="line">sns.histplot(train[<span class="string">&#x27;SalePrice&#x27;</span>])</span><br><span class="line">ax.<span class="built_in">set</span>(title=<span class="string">&quot;SalePrice Distribution&quot;</span>)</span><br><span class="line">ax.axvline(mu, color = <span class="string">&#x27;r&#x27;</span>, linestyle = <span class="string">&#x27;--&#x27;</span>)</span><br><span class="line">ax.text(mu + <span class="number">0.0001</span>, <span class="number">160</span>, <span class="string">&#x27;Mean of SalePrice&#x27;</span>, color = <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">ax.set_ylim(<span class="number">0</span>, <span class="number">170</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<pre><code>평균: 12.024057394918406
표준편차: 0.39931245219387496
</code></pre>
<p><img src="/images/house-0713/output_30_1.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># y값 추출 -&gt; train 데이터에서 saleprice만 따로 저장</span></span><br><span class="line">y = train[<span class="string">&#x27;SalePrice&#x27;</span>]</span><br><span class="line">train_t = train_t.drop(<span class="string">&#x27;SalePrice&#x27;</span>, axis = <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(train_t.shape)</span><br></pre></td></tr></table></figure>

<pre><code>(1460, 79)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 데이터 합치기</span></span><br><span class="line">all_df = pd.concat([train_t, test_t]).reset_index(drop=<span class="literal">True</span>)</span><br><span class="line">all_df.shape</span><br></pre></td></tr></table></figure>




<pre><code>(2919, 79)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 결측치 확인</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_na</span>(<span class="params">data, head_num = <span class="number">6</span></span>):</span><br><span class="line">  isnull_na = (data.isnull().<span class="built_in">sum</span>() / <span class="built_in">len</span>(data)) * <span class="number">100</span></span><br><span class="line">  data_na = isnull_na.drop(isnull_na[isnull_na == <span class="number">0</span>].index).sort_values(ascending=<span class="literal">False</span>)</span><br><span class="line">  missing_data = pd.DataFrame(&#123;<span class="string">&#x27;Missing Ratio&#x27;</span> :data_na, </span><br><span class="line">                               <span class="string">&#x27;Data Type&#x27;</span>: data.dtypes[data_na.index]&#125;)</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;결측치 데이터 컬럼과 건수:\n&quot;</span>, missing_data.head(head_num))</span><br><span class="line"></span><br><span class="line">check_na(all_df, <span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<pre><code>결측치 데이터 컬럼과 건수:
               Missing Ratio Data Type
PoolQC            99.657417    object
MiscFeature       96.402878    object
Alley             93.216855    object
Fence             80.438506    object
FireplaceQu       48.646797    object
LotFrontage       16.649538   float64
GarageFinish       5.447071    object
GarageQual         5.447071    object
GarageCond         5.447071    object
GarageYrBlt        5.447071   float64
GarageType         5.378554    object
BsmtExposure       2.809181    object
BsmtCond           2.809181    object
BsmtQual           2.774923    object
BsmtFinType2       2.740665    object
BsmtFinType1       2.706406    object
MasVnrType         0.822199    object
MasVnrArea         0.787941   float64
MSZoning           0.137033    object
BsmtFullBath       0.068517   float64
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 필요한 데이터 컬럼만 모음</span></span><br><span class="line">all_df1 = all_df[[<span class="string">&#x27;OverallQual&#x27;</span>,<span class="string">&#x27;GrLivArea&#x27;</span>,<span class="string">&#x27;GarageCars&#x27;</span>,</span><br><span class="line">                  <span class="string">&#x27;TotalBsmtSF&#x27;</span>,<span class="string">&#x27;YearBuilt&#x27;</span>,<span class="string">&#x27;FullBath&#x27;</span>,<span class="string">&#x27;YearRemodAdd&#x27;</span>]]</span><br><span class="line"><span class="built_in">print</span>(all_df1.shape)</span><br><span class="line">check_na(all_df1, <span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<pre><code>(2919, 7)
결측치 데이터 컬럼과 건수:
              Missing Ratio Data Type
GarageCars        0.034258   float64
TotalBsmtSF       0.034258   float64
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#import numpy as np</span></span><br><span class="line"><span class="comment"># 이번에는 수치형 데이터만 추출한다. </span></span><br><span class="line">num_all_vars = <span class="built_in">list</span>(all_df1.select_dtypes(include=[np.number]))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;The whole number of all_vars&quot;</span>, <span class="built_in">len</span>(num_all_vars))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 이번에는 수치형 데이터의 평균이 아닌 중간값을 지정했다. </span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> num_all_vars:</span><br><span class="line">  <span class="comment"># all_df1[i].fillna(value=all_df1[i].median(), inplace=True)</span></span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    all_df1[i] = all_df1[i].fillna(value=all_df1[i].median())  </span><br><span class="line">check_na(all_df1, <span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<pre><code>The whole number of all_vars 7
OverallQual
GrLivArea
GarageCars
TotalBsmtSF
YearBuilt
FullBath
YearRemodAdd
결측치 데이터 컬럼과 건수:
 Empty DataFrame
Columns: [Missing Ratio, Data Type]
Index: []


/opt/conda/lib/python3.7/site-packages/ipykernel_launcher.py:10: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  # Remove the CWD from sys.path while we load stuff.
/opt/conda/lib/python3.7/site-packages/ipykernel_launcher.py:10: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  # Remove the CWD from sys.path while we load stuff.
/opt/conda/lib/python3.7/site-packages/ipykernel_launcher.py:10: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  # Remove the CWD from sys.path while we load stuff.
/opt/conda/lib/python3.7/site-packages/ipykernel_launcher.py:10: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  # Remove the CWD from sys.path while we load stuff.
/opt/conda/lib/python3.7/site-packages/ipykernel_launcher.py:10: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  # Remove the CWD from sys.path while we load stuff.
/opt/conda/lib/python3.7/site-packages/ipykernel_launcher.py:10: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  # Remove the CWD from sys.path while we load stuff.
/opt/conda/lib/python3.7/site-packages/ipykernel_launcher.py:10: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  # Remove the CWD from sys.path while we load stuff.
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_df1.info()</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 2919 entries, 0 to 2918
Data columns (total 7 columns):
 #   Column        Non-Null Count  Dtype  
---  ------        --------------  -----  
 0   OverallQual   2919 non-null   int64  
 1   GrLivArea     2919 non-null   int64  
 2   GarageCars    2919 non-null   float64
 3   TotalBsmtSF   2919 non-null   float64
 4   YearBuilt     2919 non-null   int64  
 5   FullBath      2919 non-null   int64  
 6   YearRemodAdd  2919 non-null   int64  
dtypes: float64(2), int64(5)
memory usage: 159.8 KB
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cate_name = [<span class="string">&#x27;OverallQual&#x27;</span>,<span class="string">&#x27;GrLivArea&#x27;</span>,<span class="string">&#x27;YearBuilt&#x27;</span>,<span class="string">&#x27;FullBath&#x27;</span>,<span class="string">&#x27;YearRemodAdd&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> cate_name:</span><br><span class="line">    all_df1[c] =all_df[c].astype(<span class="string">&#x27;category&#x27;</span>)</span><br><span class="line"></span><br><span class="line">all_df1.dtypes</span><br></pre></td></tr></table></figure>

<pre><code>/opt/conda/lib/python3.7/site-packages/ipykernel_launcher.py:3: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  This is separate from the ipykernel package so we can avoid doing imports until





OverallQual     category
GrLivArea       category
GarageCars       float64
TotalBsmtSF      float64
YearBuilt       category
FullBath        category
YearRemodAdd    category
dtype: object
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#One-hot Encoding</span></span><br><span class="line"><span class="comment">#all_df1 = pd.get_dummies(all_df).reset_index(drop=True)</span></span><br><span class="line"><span class="comment">#all_df1.shape</span></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#train,test데이터 재분리</span></span><br><span class="line">X = all_df1.iloc[:<span class="built_in">len</span>(y),:]</span><br><span class="line">test1 = all_df1.iloc[<span class="built_in">len</span>(y):,:] </span><br><span class="line"></span><br><span class="line">X.shape, y.shape, test1.shape</span><br><span class="line"></span><br></pre></td></tr></table></figure>




<pre><code>((1460, 7), (1460,), (1459, 7))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(y)<span class="comment">#-&gt;로그변환 확인</span></span><br></pre></td></tr></table></figure>

<pre><code>0       12.247699
1       12.109016
2       12.317171
3       11.849405
4       12.429220
          ...    
1455    12.072547
1456    12.254868
1457    12.493133
1458    11.864469
1459    11.901590
Name: SalePrice, Length: 1460, dtype: float64
</code></pre>
<h2 id="STEP-6-모델링"><a href="#STEP-6-모델링" class="headerlink" title="STEP 6.모델링"></a>STEP 6.모델링</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split, GridSearchCV</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LinearRegression, Ridge</span><br><span class="line"><span class="keyword">from</span> xgboost <span class="keyword">import</span> XGBRegressor</span><br><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestRegressor</span><br><span class="line"><span class="keyword">from</span> lightgbm <span class="keyword">import</span> LGBMRegressor</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> mean_squared_error</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> cross_validate</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> GridSearchCV</span><br><span class="line"><span class="keyword">from</span> sklearn.pipeline <span class="keyword">import</span> Pipeline, make_pipeline</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line">ss=StandardScaler()</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 선형회귀모델</span></span><br><span class="line">lr_reg = LinearRegression()</span><br><span class="line"><span class="comment"># 피처에 대한 표준화 진행과 K-fold를 함께 진행</span></span><br><span class="line">pipe = make_pipeline(MinMaxScaler(),lr_reg)</span><br><span class="line">scores = cross_validate(pipe,X,y,cv=<span class="number">5</span>,</span><br><span class="line">                        scoring=<span class="string">&#x27;neg_mean_squared_error&#x27;</span>,return_train_score =<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;MSLE: &#123;0:.3f&#125;&quot;</span>.<span class="built_in">format</span>(np.mean(-scores[<span class="string">&#x27;test_score&#x27;</span>])))</span><br></pre></td></tr></table></figure>

<pre><code>MSLE: 0.030
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#rf랜덤포레스트</span></span><br><span class="line">np.random.seed(<span class="number">0</span>)</span><br><span class="line">rf = RandomForestRegressor(n_estimators = <span class="number">300</span>)</span><br><span class="line"><span class="comment"># 피처에 대한 표준화 진행과 K-fold를 함께 진행</span></span><br><span class="line">pipe = make_pipeline(MinMaxScaler(),rf)</span><br><span class="line">scores = cross_validate(pipe,X,y,cv=<span class="number">5</span>,</span><br><span class="line">                        scoring=<span class="string">&#x27;neg_mean_squared_error&#x27;</span>,return_train_score =<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;MSLE: &#123;0:.3f&#125;&quot;</span>.<span class="built_in">format</span>(np.mean(-scores[<span class="string">&#x27;test_score&#x27;</span>])))</span><br></pre></td></tr></table></figure>

<pre><code>MSLE: 0.026
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#LGBM</span></span><br><span class="line">lgbm = LGBMRegressor(n_estimators = <span class="number">500</span>, objective = <span class="string">&#x27;regression&#x27;</span>)</span><br><span class="line"><span class="comment"># 피처에 대한 표준화 진행과 K-fold를 함께 진행</span></span><br><span class="line">pipe = make_pipeline(MinMaxScaler(),lgbm)</span><br><span class="line">scores = cross_validate(pipe,X,y,cv=<span class="number">5</span>,</span><br><span class="line">                        scoring=<span class="string">&#x27;neg_mean_squared_error&#x27;</span>,return_train_score =<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;MSLE: &#123;0:.3f&#125;&quot;</span>.<span class="built_in">format</span>(np.mean(-scores[<span class="string">&#x27;test_score&#x27;</span>])))</span><br></pre></td></tr></table></figure>

<pre><code>MSLE: 0.031
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 하이퍼 파라미터 튜닝</span></span><br><span class="line"><span class="comment">#pipeline = Pipeline([(&#x27;scaler&#x27;,MinMaxScaler()),(&#x27;lgbm&#x27;,LGBMRegressor(objective=&#x27;regression&#x27;))])</span></span><br><span class="line"><span class="comment">#params=&#123;&#x27;lgbm__learnin_rate&#x27;:[0.001,0.01,0.1],</span></span><br><span class="line"><span class="comment">#       &#x27;lgbm__max_depth&#x27;:[5,10],</span></span><br><span class="line"><span class="comment">#       &#x27;lgbm__reg_lambda&#x27;:[0.1,1],</span></span><br><span class="line"><span class="comment">#       &#x27;lgbm__subsample&#x27;:[0.5,1],</span></span><br><span class="line"><span class="comment">#       &#x27;lgbm__n_estimators&#x27;:[500,1000]&#125;</span></span><br><span class="line"><span class="comment">#grid_model = GridSearchCV(pipeline,param_grid=params,scoring=&#x27;neg_mean_squared_error&#x27;,</span></span><br><span class="line"><span class="comment">#                         cv=5, n_jobs=5,verbose=True)</span></span><br><span class="line"><span class="comment">#grid_model.fit(X,y)</span></span><br><span class="line"><span class="comment">#print(&quot;MSLE:&#123;0:.3f&#125;&quot;.format(-1*grid_model.best_score_))</span></span><br><span class="line"><span class="comment">#print(&#x27;optimal hyperparameter:&#x27;,grid_model.best_params_)</span></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 피쳐 표준화</span></span><br><span class="line">minmax = MinMaxScaler()</span><br><span class="line">minmax.fit(X) <span class="comment"># 훈련셋 모수 분포 저장</span></span><br><span class="line">X_scaled = minmax.transform(X)</span><br><span class="line">X_test_scaled = minmax.transform(test1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 최종파라미터 튜닝된 모델로 학습</span></span><br><span class="line">lgbm = LGBMRegressor(n_estimators = <span class="number">500</span>, objective = <span class="string">&#x27;regression&#x27;</span>,</span><br><span class="line">                     learning_rate = <span class="number">0.06</span>, max_depth = <span class="number">3</span>, reg_lambda =<span class="number">1</span> ,subsample = <span class="number">0.52</span>, </span><br><span class="line">                     random_state = <span class="number">7</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 학습</span></span><br><span class="line">lgbm.fit(X_scaled, y)</span><br></pre></td></tr></table></figure>




<pre><code>LGBMRegressor(learning_rate=0.06, max_depth=3, n_estimators=500,
              objective=&#39;regression&#39;, random_state=7, reg_lambda=1,
              subsample=0.52)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test1에 대한 예측</span></span><br><span class="line">pred = lgbm.predict(X_test_scaled)</span><br><span class="line">fpred = np.expm1(pred)<span class="comment"># 로그변환을 풀어줌</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#lgbm 모델의 feature importance</span></span><br><span class="line">imp = pd.DataFrame(&#123;<span class="string">&#x27;feature&#x27;</span>: test1.columns,</span><br><span class="line">                   <span class="string">&#x27;coefficient&#x27;</span>:lgbm.feature_importances_&#125;)</span><br><span class="line">imp = imp.sort_values(by = <span class="string">&#x27;coefficient&#x27;</span>, ascending = <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">plt.barh(imp[<span class="string">&#x27;feature&#x27;</span>],imp[<span class="string">&#x27;coefficient&#x27;</span>])</span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><img src="/images/house-0713/output_49_0.png" alt="png"></p>
<h2 id="STEP7-제출"><a href="#STEP7-제출" class="headerlink" title="STEP7. 제출"></a>STEP7. 제출</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">del</span> submission[<span class="string">&#x27;SalePrice&#x27;</span>]</span><br><span class="line">submission[<span class="string">&#x27;SalePrice&#x27;</span>] =fpred</span><br><span class="line"></span><br><span class="line">submission.to_csv(<span class="string">&#x27;submission.csv&#x27;</span>,index=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">submission.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Id</th>
      <th>SalePrice</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1461</td>
      <td>118146.965100</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1462</td>
      <td>144152.058709</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1463</td>
      <td>169665.837534</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1464</td>
      <td>178099.773825</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1465</td>
      <td>191088.830605</td>
    </tr>
  </tbody>
</table>
</div>


</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-07-12T07:06:22.000Z" title="2022. 7. 12. 오후 4:06:22">2022-07-12</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-07-12T07:19:00.618Z" title="2022. 7. 12. 오후 4:19:00">2022-07-12</time></span><span class="level-item">39 minutes read (About 5910 words)</span></div></div><div class="content"><h2 id="프로젝트-개요"><a href="#프로젝트-개요" class="headerlink" title="프로젝트 개요"></a>프로젝트 개요</h2><ul>
<li>강의명 : 2022년 K-디지털 직업훈련(Training) 사업 - AI데이터플랫폼을 활용한 빅데이터 분석전문가 과정</li>
<li>교과목명 : 빅데이터 분석 및 시각화, AI개발 기초, 인공지능 프로그래밍</li>
<li>프로젝트 주제 : 캐글 대회 Bike Sharing Demand 데이터를 활용한 수요 예측 대회</li>
<li>프로젝트 마감일 : 2022년 7월 19일 화요일</li>
<li>수강생명 : 채제형</li>
</ul>
<p><img src="/images/bikesd_220711/image.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> google.colab <span class="keyword">import</span> drive </span><br><span class="line">drive.mount(<span class="string">&quot;/content/drive&quot;</span>)</span><br></pre></td></tr></table></figure>

<pre><code>Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount(&quot;/content/drive&quot;, force_remount=True).
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This Python 3 environment comes with many helpful analytics libraries installed</span></span><br><span class="line"><span class="comment"># It is defined by the kaggle/python Docker image: https://github.com/kaggle/docker-python</span></span><br><span class="line"><span class="comment"># For example, here&#x27;s several helpful packages to load</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np <span class="comment"># linear algebra</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd <span class="comment"># data processing, CSV file I/O (e.g. pd.read_csv)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Input data files are available in the read-only &quot;../input/&quot; directory</span></span><br><span class="line"><span class="comment"># For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">for</span> dirname, _, filenames <span class="keyword">in</span> os.walk(<span class="string">&#x27;/kaggle/input&#x27;</span>):</span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> filenames:</span><br><span class="line">        <span class="built_in">print</span>(os.path.join(dirname, filename))</span><br><span class="line"></span><br><span class="line"><span class="comment"># You can write up to 20GB to the current directory (/kaggle/working/) that gets preserved as output when you create a version using &quot;Save &amp; Run All&quot; </span></span><br><span class="line"><span class="comment"># You can also write temporary files to /kaggle/temp/, but they won&#x27;t be saved outside of the current session</span></span><br></pre></td></tr></table></figure>

<h2 id="STEP-1-필수-라이브러리-불러오기"><a href="#STEP-1-필수-라이브러리-불러오기" class="headerlink" title="STEP 1. 필수 라이브러리 불러오기"></a>STEP 1. 필수 라이브러리 불러오기</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd <span class="comment"># 데이터 가공</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np <span class="comment"># 수치 연산</span></span><br><span class="line"><span class="keyword">import</span> matplotlib <span class="keyword">as</span> mpl <span class="comment"># 시각화 </span></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt </span><br><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns <span class="comment"># 시각화 </span></span><br><span class="line"><span class="keyword">import</span> sklearn <span class="comment"># 머신러닝</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 버전 확인</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;pandas version :&quot;</span>, pd.__version__)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;numpy version :&quot;</span>, np.__version__)</span><br></pre></td></tr></table></figure>

<pre><code>pandas version : 1.3.5
numpy version : 1.21.6
</code></pre>
<h2 id="STEP-2-데이터-불러오기"><a href="#STEP-2-데이터-불러오기" class="headerlink" title="STEP 2. 데이터 불러오기"></a>STEP 2. 데이터 불러오기</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DATA_PATH = <span class="string">&#x27;/content/drive/MyDrive/Colab Notebooks/Human_ai/lecture/bike/&#x27;</span></span><br><span class="line">train = pd.read_csv(DATA_PATH +<span class="string">&#x27;train.csv&#x27;</span>)</span><br><span class="line">test = pd.read_csv(DATA_PATH + <span class="string">&#x27;test.csv&#x27;</span>)</span><br><span class="line">submission = pd.read_csv(DATA_PATH + <span class="string">&#x27;sampleSubmission.csv&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;데이터 불러오기 완료!~&quot;</span>)</span><br></pre></td></tr></table></figure>

<pre><code>데이터 불러오기 완료!~
</code></pre>
<h2 id="STEP-3-데이터-둘러보기"><a href="#STEP-3-데이터-둘러보기" class="headerlink" title="STEP 3.데이터 둘러보기"></a>STEP 3.데이터 둘러보기</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train.shape, test.shape</span><br></pre></td></tr></table></figure>




<pre><code>((10886, 12), (6493, 9))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train.info() <span class="comment"># 12개의 변수</span></span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 10886 entries, 0 to 10885
Data columns (total 12 columns):
 #   Column      Non-Null Count  Dtype  
---  ------      --------------  -----  
 0   datetime    10886 non-null  object 
 1   season      10886 non-null  int64  
 2   holiday     10886 non-null  int64  
 3   workingday  10886 non-null  int64  
 4   weather     10886 non-null  int64  
 5   temp        10886 non-null  float64
 6   atemp       10886 non-null  float64
 7   humidity    10886 non-null  int64  
 8   windspeed   10886 non-null  float64
 9   casual      10886 non-null  int64  
 10  registered  10886 non-null  int64  
 11  count       10886 non-null  int64  
dtypes: float64(3), int64(8), object(1)
memory usage: 1020.7+ KB
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test.info()</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 6493 entries, 0 to 6492
Data columns (total 9 columns):
 #   Column      Non-Null Count  Dtype  
---  ------      --------------  -----  
 0   datetime    6493 non-null   object 
 1   season      6493 non-null   int64  
 2   holiday     6493 non-null   int64  
 3   workingday  6493 non-null   int64  
 4   weather     6493 non-null   int64  
 5   temp        6493 non-null   float64
 6   atemp       6493 non-null   float64
 7   humidity    6493 non-null   int64  
 8   windspeed   6493 non-null   float64
dtypes: float64(3), int64(5), object(1)
memory usage: 456.7+ KB
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target = train[<span class="string">&#x27;count&#x27;</span>] <span class="comment"># 타겟변수 확인</span></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sum</span>(train.duplicated())<span class="comment"># 데이터 중복은 없어보인다.</span></span><br></pre></td></tr></table></figure>




<pre><code>0
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train.isnull().<span class="built_in">sum</span>()<span class="comment"># 결측치는 없어 보인다.</span></span><br></pre></td></tr></table></figure>




<pre><code>datetime      0
season        0
holiday       0
workingday    0
weather       0
temp          0
atemp         0
humidity      0
windspeed     0
casual        0
registered    0
count         0
dtype: int64
</code></pre>
<h1 id="변수의-내용을-파악해-보면"><a href="#변수의-내용을-파악해-보면" class="headerlink" title="변수의 내용을 파악해 보면"></a>변수의 내용을 파악해 보면</h1><ul>
<li>datetime     시간별 날자(-&gt;수치화 시킬 필요가 있다)</li>
<li>season       계절 :봄(1)여름(2)가을(3)겨울(4)</li>
<li>holiday       휴일</li>
<li>workingday    평일 -&gt; 평일도 휴일도 아닌 날이 존재하게 된다.이를 주말로 정의하자. </li>
<li>weather       날씨 : 맑음(1),흐림(2),작은비(3),폭우(4)</li>
<li>temp          (섭씨)온도</li>
<li>atemp         체감온도</li>
<li>humidity      (상대)습도</li>
<li>windspeed     풍속</li>
<li>casual        미등록 사용자 대여수</li>
<li>registered    등록된 사용자 대여수</li>
<li>count         총대여수(미등록자+등록자)</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 비회원(casual)과 회원(registered)의 대여량의 비율을 확인해본다.</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;미등록자수의 비율:&#x27;</span>,<span class="built_in">round</span>((train[<span class="string">&#x27;casual&#x27;</span>].<span class="built_in">sum</span>()/train[<span class="string">&#x27;count&#x27;</span>].<span class="built_in">sum</span>())*<span class="number">100</span>,<span class="number">2</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;등록자수의 비율:&#x27;</span>,<span class="built_in">round</span>((train[<span class="string">&#x27;registered&#x27;</span>].<span class="built_in">sum</span>()/train[<span class="string">&#x27;count&#x27;</span>].<span class="built_in">sum</span>())*<span class="number">100</span>,<span class="number">2</span>))</span><br></pre></td></tr></table></figure>

<pre><code>미등록자수의 비율: 18.8
등록자수의 비율: 81.2
</code></pre>
<h2 id="STEP-4-탐색적-자료-분석"><a href="#STEP-4-탐색적-자료-분석" class="headerlink" title="STEP 4. 탐색적 자료 분석"></a>STEP 4. 탐색적 자료 분석</h2><ul>
<li><p>복제본 사용</p>
<ul>
<li>시간변수를 수치형 변수로 변환</li>
</ul>
</li>
<li><p>시각화</p>
<ul>
<li>타겟 변수의 상태 확인</li>
<li>수치형 변수와 대여량 간의 관계(온도,체감온도,습도,풍속)</li>
<li>범주형 변수와 대여량 간의 관계(시간,날씨,계절,일하는날,휴일)</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">temp_train = train.copy()</span><br><span class="line">temp_test = test.copy()</span><br><span class="line">temp_target = target.copy()<span class="comment"># 복제본 완료</span></span><br><span class="line">temp_train.shape, temp_test.shape, temp_target.shape</span><br></pre></td></tr></table></figure>




<pre><code>((10886, 12), (6493, 9), (10886,))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 시간관련 변수를 수치형 변수로 바꿔준다.</span></span><br><span class="line">temp_train[<span class="string">&#x27;date&#x27;</span>] = pd.to_datetime(temp_train[<span class="string">&#x27;datetime&#x27;</span>])</span><br><span class="line">temp_train[<span class="string">&#x27;year&#x27;</span>] = temp_train[<span class="string">&#x27;date&#x27;</span>].dt.year</span><br><span class="line">temp_train[<span class="string">&#x27;month&#x27;</span>] = temp_train[<span class="string">&#x27;date&#x27;</span>].dt.month</span><br><span class="line">temp_train[<span class="string">&#x27;day&#x27;</span>] = temp_train[<span class="string">&#x27;date&#x27;</span>].dt.day</span><br><span class="line">temp_train[<span class="string">&#x27;hour&#x27;</span>] = temp_train[<span class="string">&#x27;date&#x27;</span>].dt.hour</span><br><span class="line"><span class="comment">#분과 초는 0값이기에 필요가 없어서 생략함</span></span><br><span class="line">temp_train.head()</span><br></pre></td></tr></table></figure>





  <div id="df-5f3c05a7-4906-4dd1-8371-266fd67341a3">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>datetime</th>
      <th>season</th>
      <th>holiday</th>
      <th>workingday</th>
      <th>weather</th>
      <th>temp</th>
      <th>atemp</th>
      <th>humidity</th>
      <th>windspeed</th>
      <th>casual</th>
      <th>registered</th>
      <th>count</th>
      <th>date</th>
      <th>year</th>
      <th>month</th>
      <th>day</th>
      <th>hour</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2011-01-01 00:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>81</td>
      <td>0.0</td>
      <td>3</td>
      <td>13</td>
      <td>16</td>
      <td>2011-01-01 00:00:00</td>
      <td>2011</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2011-01-01 01:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.02</td>
      <td>13.635</td>
      <td>80</td>
      <td>0.0</td>
      <td>8</td>
      <td>32</td>
      <td>40</td>
      <td>2011-01-01 01:00:00</td>
      <td>2011</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2011-01-01 02:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.02</td>
      <td>13.635</td>
      <td>80</td>
      <td>0.0</td>
      <td>5</td>
      <td>27</td>
      <td>32</td>
      <td>2011-01-01 02:00:00</td>
      <td>2011</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2011-01-01 03:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>75</td>
      <td>0.0</td>
      <td>3</td>
      <td>10</td>
      <td>13</td>
      <td>2011-01-01 03:00:00</td>
      <td>2011</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2011-01-01 04:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>75</td>
      <td>0.0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>2011-01-01 04:00:00</td>
      <td>2011</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-5f3c05a7-4906-4dd1-8371-266fd67341a3')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

<p>  &lt;svg xmlns&#x3D;”<a target="_blank" rel="noopener" href="http://www.w3.org/2000/svg&quot;">http://www.w3.org/2000/svg&quot;</a> height&#x3D;”24px”viewBox&#x3D;”0 0 24 24”<br>       width&#x3D;”24px”&gt;<br>    <path d="M0 0h24v24H0V0z" fill="none"/><br>    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/><br>  </svg><br>      </button></p>
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

<pre><code>  &lt;script&gt;
    const buttonEl =
      document.querySelector(&#39;#df-5f3c05a7-4906-4dd1-8371-266fd67341a3 button.colab-df-convert&#39;);
    buttonEl.style.display =
      google.colab.kernel.accessAllowed ? &#39;block&#39; : &#39;none&#39;;

    async function convertToInteractive(key) &#123;
      const element = document.querySelector(&#39;#df-5f3c05a7-4906-4dd1-8371-266fd67341a3&#39;);
      const dataTable =
        await google.colab.kernel.invokeFunction(&#39;convertToInteractive&#39;,
                                                 [key], &#123;&#125;);
      if (!dataTable) return;

      const docLinkHtml = &#39;Like what you see? Visit the &#39; +
        &#39;&lt;a target=&quot;_blank&quot; href=https://colab.research.google.com/notebooks/data_table.ipynb&gt;data table notebook&lt;/a&gt;&#39;
        + &#39; to learn more about interactive tables.&#39;;
      element.innerHTML = &#39;&#39;;
      dataTable[&#39;output_type&#39;] = &#39;display_data&#39;;
      await google.colab.output.renderOutput(dataTable, element);
      const docLink = document.createElement(&#39;div&#39;);
      docLink.innerHTML = docLinkHtml;
      element.appendChild(docLink);
    &#125;
  &lt;/script&gt;
&lt;/div&gt;
</code></pre>
  </div>





<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 타겟변수(총대여수)를 확인하여 시각화를 해봤다</span></span><br><span class="line">fig, ax = plt.subplots(nrows = <span class="number">1</span>, ncols =<span class="number">2</span>, figsize = (<span class="number">10</span>,<span class="number">6</span>))</span><br><span class="line">sns.histplot(temp_train[<span class="string">&#x27;count&#x27;</span>],ax = ax[<span class="number">0</span>])</span><br><span class="line">sns.histplot(np.log(temp_train[<span class="string">&#x27;count&#x27;</span>]),ax = ax[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">ax[<span class="number">0</span>].set_title(<span class="string">&#x27;Normal Graph&#x27;</span>)</span><br><span class="line">ax[<span class="number">1</span>].set_title(<span class="string">&#x27;Log Graph&#x27;</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>


<p><img src="/images/bikesd_220711/output_19_0.png" alt="png"></p>
<p>-&gt; 시각화 결과 왼쪽으로 치우쳐졌기에 로그함수를 이용 정규분포와 비슷하게 만들었다.</p>
<h3 id="1-수치형-변수와-대여량-간의-관계"><a href="#1-수치형-변수와-대여량-간의-관계" class="headerlink" title="1.수치형 변수와 대여량 간의 관계"></a>1.수치형 변수와 대여량 간의 관계</h3><ul>
<li>온도,체감온도,습도,풍속은 연속형 변수로 총대여수와의 관계를 살펴보기 위해 상관계수 히트맵 그래프를 그려본다.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">10</span>))</span><br><span class="line">plt.title(<span class="string">&quot;Weather Correlation of Features&quot;</span>,y= <span class="number">1</span>, size = <span class="number">15</span>)</span><br><span class="line">coorMat = temp_train[[<span class="string">&#x27;temp&#x27;</span>,<span class="string">&#x27;atemp&#x27;</span>,<span class="string">&#x27;humidity&#x27;</span>,<span class="string">&#x27;windspeed&#x27;</span>,<span class="string">&#x27;casual&#x27;</span>,<span class="string">&#x27;registered&#x27;</span>,<span class="string">&#x27;count&#x27;</span>]].corr()</span><br><span class="line">sns.heatmap(coorMat, annot = <span class="literal">True</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>


<p><img src="/images/bikesd_220711/output_22_0.png" alt="png"></p>
<ul>
<li>총대여수(count)와 상관성을 갖는 값을 나열해보면 온도 및 체감온도(0.39)&gt;습도(-0.32)&gt;풍속(0.1)이였다. 이는 온도 및 체감온도는 총대여수와 정비례하고 습도는 반비례 풍속은 미미한 정비례 관계이다.<ul>
<li>온도와 체감온도는 중복이 된다고 할 수 있다.둘 중 하나는 생략하자.</li>
</ul>
</li>
<li>casual과 registered가 온도,습도에서 차이가 나는 것은 아마도 casual(비회원)이 날씨에 더 민감함을 알 수 있다.</li>
<li>온도, 체감온도, 습도, 풍속의 산점도와 회귀선을 그려 더 구체화 시켜보자.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 산점도 플렛</span></span><br><span class="line">plt. rc(<span class="string">&#x27;font&#x27;</span>,size =<span class="number">8</span>)</span><br><span class="line">fig, ax = plt.subplots(nrows = <span class="number">2</span>, ncols = <span class="number">2</span>, figsize= (<span class="number">10</span>,<span class="number">9</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2단계 : 각 개별 그래프 입력</span></span><br><span class="line">sns.regplot(x = <span class="string">&#x27;temp&#x27;</span>, y = <span class="string">&#x27;count&#x27;</span>, data = temp_train, scatter_kws = &#123;<span class="string">&#x27;alpha&#x27;</span>:<span class="number">0.2</span>&#125;, line_kws = &#123;<span class="string">&#x27;color&#x27;</span>:<span class="string">&#x27;red&#x27;</span>&#125;,ax=ax[<span class="number">0</span>,<span class="number">0</span>])</span><br><span class="line">sns.regplot(x = <span class="string">&#x27;atemp&#x27;</span>,y = <span class="string">&#x27;count&#x27;</span>, data = temp_train,scatter_kws = &#123;<span class="string">&#x27;alpha&#x27;</span>:<span class="number">0.2</span>&#125;, line_kws = &#123;<span class="string">&#x27;color&#x27;</span>:<span class="string">&#x27;red&#x27;</span>&#125;, ax=ax[<span class="number">0</span>,<span class="number">1</span>])</span><br><span class="line">sns.regplot(x = <span class="string">&#x27;humidity&#x27;</span>, y = <span class="string">&#x27;count&#x27;</span>, data = temp_train,scatter_kws = &#123;<span class="string">&#x27;alpha&#x27;</span>:<span class="number">0.2</span>&#125;, line_kws = &#123;<span class="string">&#x27;color&#x27;</span>:<span class="string">&#x27;red&#x27;</span>&#125;, ax=ax[<span class="number">1</span>,<span class="number">0</span>])</span><br><span class="line">sns.regplot(x = <span class="string">&#x27;windspeed&#x27;</span>, y = <span class="string">&#x27;count&#x27;</span>, data = temp_train, scatter_kws = &#123;<span class="string">&#x27;alpha&#x27;</span>:<span class="number">0.2</span>&#125;, line_kws = &#123;<span class="string">&#x27;color&#x27;</span>:<span class="string">&#x27;red&#x27;</span>&#125;,ax=ax[<span class="number">1</span>,<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3단계 : 디테일 옵션</span></span><br><span class="line">ax[<span class="number">0</span>, <span class="number">0</span>].set_title(<span class="string">&quot;Temp&quot;</span>)</span><br><span class="line">ax[<span class="number">0</span>, <span class="number">1</span>].set_title(<span class="string">&quot;Atemp&quot;</span>)</span><br><span class="line">ax[<span class="number">1</span>, <span class="number">0</span>].set_title(<span class="string">&quot;Humidity&quot;</span>)</span><br><span class="line">ax[<span class="number">1</span>, <span class="number">1</span>].set_title(<span class="string">&quot;Windspeed&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>


<p><img src="/images/bikesd_220711/output_24_0.png" alt="png"></p>
<ul>
<li>windspeed에서 풍속이 0인 수치가 많고 약 6까지 수치가 없는 것으로 봐서 6이하를 0으로 표시한 것 같다.</li>
</ul>
<ul>
<li>풍속이 0인 수치를 평균값으로 대체하도록 하자.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plt.figure(figsize=(<span class="number">14</span>,<span class="number">3</span>))</span><br><span class="line">sns.countplot(data = temp_train, x = <span class="string">&quot;windspeed&quot;</span>) <span class="comment"># 윈드스피드의 수치 확인</span></span><br></pre></td></tr></table></figure>




<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f5ba4f7a850&gt;
</code></pre>
<p><img src="/images/bikesd_220711/output_26_1.png" alt="png"></p>
<h3 id="2-범주형-변수와-총대여수와의-관계"><a href="#2-범주형-변수와-총대여수와의-관계" class="headerlink" title="2.범주형 변수와 총대여수와의 관계"></a>2.범주형 변수와 총대여수와의 관계</h3><ul>
<li>시간(year,month,day,hour)</li>
<li>날씨(weather)</li>
<li>계절(season)</li>
<li>평일(workingday), 휴일(holiday)<br> 를 시각화하자(그래프로 그려보자).</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 시간과 관련 그래프를 그려보자.</span></span><br><span class="line">fig, ax = plt.subplots(nrows = <span class="number">2</span>, ncols = <span class="number">2</span>)</span><br><span class="line">fig.tight_layout()</span><br><span class="line">fig.set_size_inches(<span class="number">10</span>, <span class="number">9</span>)</span><br><span class="line">sns.barplot(x = <span class="string">&#x27;year&#x27;</span>, y = <span class="string">&#x27;count&#x27;</span>, data = temp_train, ax=ax[<span class="number">0</span>,<span class="number">0</span>])</span><br><span class="line">sns.barplot(x = <span class="string">&#x27;month&#x27;</span>,y = <span class="string">&#x27;count&#x27;</span>, data = temp_train, ax=ax[<span class="number">0</span>,<span class="number">1</span>])</span><br><span class="line">sns.barplot(x = <span class="string">&#x27;day&#x27;</span>, y = <span class="string">&#x27;count&#x27;</span>, data = temp_train, ax=ax[<span class="number">1</span>,<span class="number">0</span>])</span><br><span class="line">sns.barplot(x = <span class="string">&#x27;hour&#x27;</span>, y = <span class="string">&#x27;count&#x27;</span>, data = temp_train, ax=ax[<span class="number">1</span>,<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">ax[<span class="number">0</span>, <span class="number">0</span>].set_title(<span class="string">&quot;Rental Amounts by Year&quot;</span>)</span><br><span class="line">ax[<span class="number">0</span>, <span class="number">1</span>].set_title(<span class="string">&quot;Rental Amounts by month&quot;</span>)</span><br><span class="line">ax[<span class="number">1</span>, <span class="number">0</span>].set_title(<span class="string">&quot;Rental Amounts by day&quot;</span>)</span><br><span class="line">ax[<span class="number">1</span>, <span class="number">1</span>].set_title(<span class="string">&quot;Rental Amounts by hour&quot;</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>


<p><img src="/images/bikesd_220711/output_28_0.png" alt="png"></p>
<ul>
<li>그래프를 해석해보면 2012년도가 전년에 비해 대여량이 늘었다</li>
<li>겨울보다는 여름에 더 대여량이 높다.</li>
<li>날짜별로는 특별한 차이가 없기에 데이터로서 가치가 없다(제거)</li>
<li>출퇴근 시간으로 보이는 오전 8시와 오후 5-6시에 대여량이 높다.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 날씨 관련 그래프를 그려보자.</span></span><br><span class="line">fig, ax = plt.subplots(nrows = <span class="number">1</span>, ncols = <span class="number">3</span>,figsize=(<span class="number">10</span>,<span class="number">3</span>))</span><br><span class="line">fig.tight_layout()</span><br><span class="line">sns.barplot(x = <span class="string">&#x27;weather&#x27;</span>, y = <span class="string">&#x27;casual&#x27;</span>, data = temp_train, ax=ax[<span class="number">0</span>])</span><br><span class="line">sns.barplot(x = <span class="string">&#x27;weather&#x27;</span>,y = <span class="string">&#x27;registered&#x27;</span>, data = temp_train, ax=ax[<span class="number">1</span>])</span><br><span class="line">sns.barplot(x = <span class="string">&#x27;weather&#x27;</span>, y = <span class="string">&#x27;count&#x27;</span>, data = temp_train, ax=ax[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">ax[<span class="number">0</span>].set_title(<span class="string">&quot;Causal&quot;</span>)</span><br><span class="line">ax[<span class="number">1</span>].set_title(<span class="string">&quot;Registered&quot;</span>)</span><br><span class="line">ax[<span class="number">2</span>].set_title(<span class="string">&quot;Count=C+R&quot;</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>


<p><img src="/images/bikesd_220711/output_30_0.png" alt="png"></p>
<p>그래프가 이상하다. 안좋은 날씨 데이터(4)는 적은데 높게 나와있다. 평균치로 나타냈기 때문일 것이다.<br>이를 해결하기 위해 y축을 합계로 계산해보자.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(temp_train.groupby(<span class="string">&#x27;weather&#x27;</span>)[[<span class="string">&#x27;datetime&#x27;</span>]].count()/<span class="built_in">len</span>(temp_train))*<span class="number">100</span></span><br></pre></td></tr></table></figure>





  <div id="df-343e42f8-4a2f-4ca7-b2b0-ab2b95d24e1f">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>datetime</th>
    </tr>
    <tr>
      <th>weather</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>66.066507</td>
    </tr>
    <tr>
      <th>2</th>
      <td>26.033437</td>
    </tr>
    <tr>
      <th>3</th>
      <td>7.890869</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.009186</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-343e42f8-4a2f-4ca7-b2b0-ab2b95d24e1f')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

<p>  &lt;svg xmlns&#x3D;”<a target="_blank" rel="noopener" href="http://www.w3.org/2000/svg&quot;">http://www.w3.org/2000/svg&quot;</a> height&#x3D;”24px”viewBox&#x3D;”0 0 24 24”<br>       width&#x3D;”24px”&gt;<br>    <path d="M0 0h24v24H0V0z" fill="none"/><br>    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/><br>  </svg><br>      </button></p>
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

<pre><code>  &lt;script&gt;
    const buttonEl =
      document.querySelector(&#39;#df-343e42f8-4a2f-4ca7-b2b0-ab2b95d24e1f button.colab-df-convert&#39;);
    buttonEl.style.display =
      google.colab.kernel.accessAllowed ? &#39;block&#39; : &#39;none&#39;;

    async function convertToInteractive(key) &#123;
      const element = document.querySelector(&#39;#df-343e42f8-4a2f-4ca7-b2b0-ab2b95d24e1f&#39;);
      const dataTable =
        await google.colab.kernel.invokeFunction(&#39;convertToInteractive&#39;,
                                                 [key], &#123;&#125;);
      if (!dataTable) return;

      const docLinkHtml = &#39;Like what you see? Visit the &#39; +
        &#39;&lt;a target=&quot;_blank&quot; href=https://colab.research.google.com/notebooks/data_table.ipynb&gt;data table notebook&lt;/a&gt;&#39;
        + &#39; to learn more about interactive tables.&#39;;
      element.innerHTML = &#39;&#39;;
      dataTable[&#39;output_type&#39;] = &#39;display_data&#39;;
      await google.colab.output.renderOutput(dataTable, element);
      const docLink = document.createElement(&#39;div&#39;);
      docLink.innerHTML = docLinkHtml;
      element.appendChild(docLink);
    &#125;
  &lt;/script&gt;
&lt;/div&gt;
</code></pre>
  </div>





<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">W_train = temp_train.groupby(<span class="string">&#x27;weather&#x27;</span>)[[<span class="string">&#x27;count&#x27;</span>]].<span class="built_in">sum</span>().reset_index()</span><br><span class="line">Wc_train = temp_train.groupby(<span class="string">&#x27;weather&#x27;</span>)[[<span class="string">&#x27;casual&#x27;</span>]].<span class="built_in">sum</span>().reset_index()</span><br><span class="line">Wr_train = temp_train.groupby(<span class="string">&#x27;weather&#x27;</span>)[[<span class="string">&#x27;registered&#x27;</span>]].<span class="built_in">sum</span>().reset_index()</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fig, ax = plt.subplots(nrows = <span class="number">1</span>, ncols = <span class="number">3</span>,figsize=(<span class="number">12</span>,<span class="number">3</span>))</span><br><span class="line"><span class="comment"># fig.tight_layout()</span></span><br><span class="line">sns.barplot(x = <span class="string">&#x27;weather&#x27;</span>, y = <span class="string">&#x27;casual&#x27;</span>, data = Wc_train, ax=ax[<span class="number">0</span>])</span><br><span class="line">sns.barplot(x = <span class="string">&#x27;weather&#x27;</span>,y = <span class="string">&#x27;registered&#x27;</span>, data = Wr_train, ax=ax[<span class="number">1</span>])</span><br><span class="line">sns.barplot(x = <span class="string">&#x27;weather&#x27;</span>, y = <span class="string">&#x27;count&#x27;</span>, data = W_train, ax=ax[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">ax[<span class="number">0</span>].set_title(<span class="string">&quot;Causal&quot;</span>)</span><br><span class="line">ax[<span class="number">1</span>].set_title(<span class="string">&quot;Registered&quot;</span>)</span><br><span class="line">ax[<span class="number">2</span>].set_title(<span class="string">&quot;Count=C+R&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>




<pre><code>Text(0.5, 1.0, &#39;Count=C+R&#39;)
</code></pre>
<p><img src="/images/bikesd_220711/output_34_1.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 계절 관련 그래프를 그려보자</span></span><br><span class="line">fig, ax = plt.subplots(nrows = <span class="number">1</span>, ncols = <span class="number">3</span>,figsize=(<span class="number">12</span>,<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">sns.barplot(x = <span class="string">&#x27;season&#x27;</span>, y = <span class="string">&#x27;casual&#x27;</span>, data = temp_train, ax=ax[<span class="number">0</span>])</span><br><span class="line">sns.barplot(x = <span class="string">&#x27;season&#x27;</span>,y = <span class="string">&#x27;registered&#x27;</span>, data = temp_train, ax=ax[<span class="number">1</span>])</span><br><span class="line">sns.barplot(x = <span class="string">&#x27;season&#x27;</span>, y = <span class="string">&#x27;count&#x27;</span>, data = temp_train, ax=ax[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">ax[<span class="number">0</span>].set_title(<span class="string">&quot;Causal&quot;</span>)</span><br><span class="line">ax[<span class="number">1</span>].set_title(<span class="string">&quot;Registered&quot;</span>)</span><br><span class="line">ax[<span class="number">2</span>].set_title(<span class="string">&quot;Count=C+R&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>




<pre><code>Text(0.5, 1.0, &#39;Count=C+R&#39;)
</code></pre>
<p><img src="/images/bikesd_220711/output_35_1.png" alt="png"></p>
<ul>
<li>season과 month는 비슷한 양상의 그래프이다. 실제로 month를 3개월 단위로 자른 것이기에 비슷한 변수가 머신러닝 모델에 중복해서 들어가면 예측 성는이 안 좋아지므로 변수 season은 생략하는 것이 좋겠다.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># workingday와 holyday를 그래프로 그려보자</span></span><br><span class="line"><span class="comment"># 여기서 workingday는 평일 holyday는 공휴일로 봤을 때 둘다 아닌 날은 주말(weekend)로 정의한다.</span></span><br><span class="line">temp_train[<span class="string">&#x27;day_type&#x27;</span>] = <span class="string">&#x27;weekend&#x27;</span></span><br><span class="line">is_holi = (train[<span class="string">&#x27;holiday&#x27;</span>] == <span class="number">1</span>)</span><br><span class="line">is_week = (train[<span class="string">&#x27;workingday&#x27;</span>] == <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">temp_train.loc[(is_holi),<span class="string">&#x27;day_type&#x27;</span>] = <span class="string">&#x27;holiday&#x27;</span></span><br><span class="line">temp_train.loc[(is_week),<span class="string">&#x27;day_type&#x27;</span>] = <span class="string">&#x27;workingday&#x27;</span></span><br><span class="line">work_holi = (temp_train.groupby(<span class="string">&#x27;day_type&#x27;</span>)[[<span class="string">&#x27;casual&#x27;</span>,<span class="string">&#x27;registered&#x27;</span>,<span class="string">&#x27;count&#x27;</span>]].<span class="built_in">sum</span>()/</span><br><span class="line">             temp_train.groupby(<span class="string">&#x27;day_type&#x27;</span>)[[<span class="string">&#x27;casual&#x27;</span>,<span class="string">&#x27;registered&#x27;</span>,<span class="string">&#x27;count&#x27;</span>]].count())</span><br><span class="line">temp_train.head()</span><br></pre></td></tr></table></figure>





  <div id="df-c3150710-c4d4-4b72-8754-d26e6f327bc3">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>datetime</th>
      <th>season</th>
      <th>holiday</th>
      <th>workingday</th>
      <th>weather</th>
      <th>temp</th>
      <th>atemp</th>
      <th>humidity</th>
      <th>windspeed</th>
      <th>casual</th>
      <th>registered</th>
      <th>count</th>
      <th>date</th>
      <th>year</th>
      <th>month</th>
      <th>day</th>
      <th>hour</th>
      <th>day_type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2011-01-01 00:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>81</td>
      <td>0.0</td>
      <td>3</td>
      <td>13</td>
      <td>16</td>
      <td>2011-01-01 00:00:00</td>
      <td>2011</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>weekend</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2011-01-01 01:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.02</td>
      <td>13.635</td>
      <td>80</td>
      <td>0.0</td>
      <td>8</td>
      <td>32</td>
      <td>40</td>
      <td>2011-01-01 01:00:00</td>
      <td>2011</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>weekend</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2011-01-01 02:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.02</td>
      <td>13.635</td>
      <td>80</td>
      <td>0.0</td>
      <td>5</td>
      <td>27</td>
      <td>32</td>
      <td>2011-01-01 02:00:00</td>
      <td>2011</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>weekend</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2011-01-01 03:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>75</td>
      <td>0.0</td>
      <td>3</td>
      <td>10</td>
      <td>13</td>
      <td>2011-01-01 03:00:00</td>
      <td>2011</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>weekend</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2011-01-01 04:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>75</td>
      <td>0.0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>2011-01-01 04:00:00</td>
      <td>2011</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>weekend</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-c3150710-c4d4-4b72-8754-d26e6f327bc3')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

<p>  &lt;svg xmlns&#x3D;”<a target="_blank" rel="noopener" href="http://www.w3.org/2000/svg&quot;">http://www.w3.org/2000/svg&quot;</a> height&#x3D;”24px”viewBox&#x3D;”0 0 24 24”<br>       width&#x3D;”24px”&gt;<br>    <path d="M0 0h24v24H0V0z" fill="none"/><br>    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/><br>  </svg><br>      </button></p>
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

<pre><code>  &lt;script&gt;
    const buttonEl =
      document.querySelector(&#39;#df-c3150710-c4d4-4b72-8754-d26e6f327bc3 button.colab-df-convert&#39;);
    buttonEl.style.display =
      google.colab.kernel.accessAllowed ? &#39;block&#39; : &#39;none&#39;;

    async function convertToInteractive(key) &#123;
      const element = document.querySelector(&#39;#df-c3150710-c4d4-4b72-8754-d26e6f327bc3&#39;);
      const dataTable =
        await google.colab.kernel.invokeFunction(&#39;convertToInteractive&#39;,
                                                 [key], &#123;&#125;);
      if (!dataTable) return;

      const docLinkHtml = &#39;Like what you see? Visit the &#39; +
        &#39;&lt;a target=&quot;_blank&quot; href=https://colab.research.google.com/notebooks/data_table.ipynb&gt;data table notebook&lt;/a&gt;&#39;
        + &#39; to learn more about interactive tables.&#39;;
      element.innerHTML = &#39;&#39;;
      dataTable[&#39;output_type&#39;] = &#39;display_data&#39;;
      await google.colab.output.renderOutput(dataTable, element);
      const docLink = document.createElement(&#39;div&#39;);
      docLink.innerHTML = docLinkHtml;
      element.appendChild(docLink);
    &#125;
  &lt;/script&gt;
&lt;/div&gt;
</code></pre>
  </div>





<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#시각화</span></span><br><span class="line">plt.plot(work_holi)</span><br><span class="line">plt.legend(work_holi.columns)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>


<p><img src="/images/bikesd_220711/output_38_0.png" alt="png"></p>
<ul>
<li>사용량은 등록자 대여수(registered)가 비등록자 대여수(casual)보다 많다. 평일(workingday)에 등록자 대여수가 가장 높고 비등록자 대여수가 적은 것을 볼 수 있다.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 데이터 나누기</span></span><br><span class="line">h1 = temp_train.loc[temp_train[<span class="string">&#x27;day_type&#x27;</span>] == <span class="string">&#x27;workingday&#x27;</span>]</span><br><span class="line">h2 = temp_train.loc[temp_train[<span class="string">&#x27;day_type&#x27;</span>] == <span class="string">&#x27;weekend&#x27;</span>]</span><br><span class="line">h3 = temp_train.loc[temp_train[<span class="string">&#x27;day_type&#x27;</span>] == <span class="string">&#x27;holiday&#x27;</span>]</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 평일에 대해 -시간대별 평균대여량</span></span><br><span class="line">h1_df = h1.groupby(<span class="string">&#x27;hour&#x27;</span>)[[<span class="string">&#x27;casual&#x27;</span>,<span class="string">&#x27;registered&#x27;</span>,<span class="string">&#x27;count&#x27;</span>]].mean()</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>,<span class="number">4</span>))</span><br><span class="line">plt.plot(h1_df)</span><br><span class="line">plt.xticks(np.arange(<span class="number">0</span>,<span class="number">25</span>))</span><br><span class="line">plt.legend(h1_df.columns)</span><br><span class="line">plt.title(<span class="string">&#x27;workingday&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>


<p><img src="/images/bikesd_220711/output_41_0.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 주말에 대해 -시간대별 평균대여량</span></span><br><span class="line">h2_df = h2.groupby(<span class="string">&#x27;hour&#x27;</span>)[[<span class="string">&#x27;casual&#x27;</span>,<span class="string">&#x27;registered&#x27;</span>,<span class="string">&#x27;count&#x27;</span>]].mean()</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>,<span class="number">4</span>))</span><br><span class="line">plt.plot(h2_df)</span><br><span class="line">plt.xticks(np.arange(<span class="number">0</span>,<span class="number">25</span>))</span><br><span class="line">plt.legend(h2_df.columns)</span><br><span class="line">plt.title(<span class="string">&#x27;Weekend&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>


<p><img src="/images/bikesd_220711/output_42_0.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 공휴일에 대해 -시간대별 평균대여량</span></span><br><span class="line">h3_df = h3.groupby(<span class="string">&#x27;hour&#x27;</span>)[[<span class="string">&#x27;casual&#x27;</span>,<span class="string">&#x27;registered&#x27;</span>,<span class="string">&#x27;count&#x27;</span>]].mean()</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>,<span class="number">4</span>))</span><br><span class="line">plt.plot(h3_df)</span><br><span class="line">plt.xticks(np.arange(<span class="number">0</span>,<span class="number">25</span>))</span><br><span class="line">plt.legend(h3_df.columns)</span><br><span class="line">plt.title(<span class="string">&#x27;Holiday&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>


<p><img src="/images/bikesd_220711/output_43_0.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 모든 그래프를 한번에 보면</span></span><br><span class="line">h_all = temp_train.pivot_table(index =<span class="string">&#x27;hour&#x27;</span>,columns = <span class="string">&#x27;day_type&#x27;</span>, values = <span class="string">&#x27;count&#x27;</span>, aggfunc=<span class="string">&#x27;mean&#x27;</span>)</span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>,<span class="number">4</span>))</span><br><span class="line">plt.plot(h_all)</span><br><span class="line">plt.xticks(np.arange(<span class="number">0</span>,<span class="number">25</span>))</span><br><span class="line">plt.legend(h_all.columns)</span><br><span class="line">plt.title(<span class="string">&#x27;All&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>


<p><img src="/images/bikesd_220711/output_44_0.png" alt="png"></p>
<ul>
<li>평일에는 출퇴근 시간인 오전 8시와 오후 5-6시에 많이 이용되고 주말과 공휴일에는 낮시간에 대다수 이용된다. 공휴일에는 놀러가는 사람이 많은지 출퇴근 시간만큼은 아니지만 많이 이용되는 시간대가 있다.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">fig, ax = plt.subplots(nrows = <span class="number">2</span>, ncols = <span class="number">2</span>)</span><br><span class="line">fig.tight_layout()</span><br><span class="line">fig.set_size_inches(<span class="number">10</span>, <span class="number">9</span>)</span><br><span class="line"></span><br><span class="line">sns.boxplot(x = <span class="string">&#x27;weather&#x27;</span>, y = <span class="string">&#x27;count&#x27;</span>, data = temp_train, ax=ax[<span class="number">0</span>,<span class="number">0</span>])</span><br><span class="line">sns.boxplot(x = <span class="string">&#x27;season&#x27;</span>,y = <span class="string">&#x27;count&#x27;</span>, data = temp_train, ax=ax[<span class="number">0</span>,<span class="number">1</span>])</span><br><span class="line">sns.boxplot(x = <span class="string">&#x27;holiday&#x27;</span>, y = <span class="string">&#x27;count&#x27;</span>, data = temp_train, ax=ax[<span class="number">1</span>,<span class="number">0</span>])</span><br><span class="line">sns.boxplot(x = <span class="string">&#x27;workingday&#x27;</span>, y = <span class="string">&#x27;count&#x27;</span>, data = temp_train, ax=ax[<span class="number">1</span>,<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">ax[<span class="number">0</span>, <span class="number">0</span>].set_title(<span class="string">&quot;Box Plot On Count weather&quot;</span>)</span><br><span class="line">ax[<span class="number">0</span>, <span class="number">1</span>].set_title(<span class="string">&quot;Box Plot On Count Across Season&quot;</span>)</span><br><span class="line">ax[<span class="number">1</span>, <span class="number">0</span>].set_title(<span class="string">&quot;Rental Amounts by Holiday&quot;</span>)</span><br><span class="line">ax[<span class="number">1</span>, <span class="number">1</span>].set_title(<span class="string">&quot;Rental Amounts by Workingday&quot;</span>)</span><br><span class="line"></span><br><span class="line">ax[<span class="number">0</span>, <span class="number">1</span>].tick_params(axis = <span class="string">&#x27;x&#x27;</span>, labelrotation=<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>


<p><img src="/images/bikesd_220711/output_46_0.png" alt="png"></p>
<ul>
<li>weather 데이터에서 4번은 반드시 처리해야 한다.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">temp_train[<span class="string">&#x27;weekday&#x27;</span>] = temp_train[<span class="string">&#x27;date&#x27;</span>].dt.day_name() <span class="comment"># 요일 추출하기</span></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fig, ax = plt.subplots(nrows = <span class="number">5</span>)</span><br><span class="line">fig.set_size_inches(<span class="number">12</span>, <span class="number">18</span>)</span><br><span class="line"></span><br><span class="line">sns.pointplot(x = <span class="string">&#x27;hour&#x27;</span>, y = <span class="string">&#x27;count&#x27;</span>, hue = <span class="string">&#x27;workingday&#x27;</span>, data = temp_train, ax = ax[<span class="number">0</span>])</span><br><span class="line">sns.pointplot(x = <span class="string">&#x27;hour&#x27;</span>, y = <span class="string">&#x27;count&#x27;</span>, hue = <span class="string">&#x27;holiday&#x27;</span>, data = temp_train, ax = ax[<span class="number">1</span>])</span><br><span class="line">sns.pointplot(x = <span class="string">&#x27;hour&#x27;</span>, y = <span class="string">&#x27;count&#x27;</span>, hue = <span class="string">&#x27;weekday&#x27;</span>, data = temp_train, ax = ax[<span class="number">2</span>])</span><br><span class="line">sns.pointplot(x = <span class="string">&#x27;hour&#x27;</span>, y = <span class="string">&#x27;count&#x27;</span>, hue = <span class="string">&#x27;season&#x27;</span>, data = temp_train, ax = ax[<span class="number">3</span>])</span><br><span class="line">sns.pointplot(x = <span class="string">&#x27;hour&#x27;</span>, y = <span class="string">&#x27;count&#x27;</span>, hue = <span class="string">&#x27;weather&#x27;</span>, data = temp_train, ax = ax[<span class="number">4</span>])</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>


<p><img src="/images/bikesd_220711/output_49_0.png" alt="png"></p>
<h3 id="3-시각화의-결론"><a href="#3-시각화의-결론" class="headerlink" title="3.시각화의 결론"></a>3.시각화의 결론</h3><ul>
<li>causal과 registered의 합계가 target값(count)이므로 비례관계가 성립하기에 제거한다. </li>
<li>수치형 변수</li>
</ul>
<ul>
<li>온도(temp,atemp)는 정비례 관계가 습도(humidity)는 반비례 관계가 나타나며 풍향(windspeed)는 정비례관계가 너무 작기에 제거(또는 0의 값 보완)한다.</li>
</ul>
<ul>
<li>범주형 변수</li>
</ul>
<ul>
<li>시간 변수는 다른 변수들과의 대여량 간 관계를 설명해주는 강력한 변수이다</li>
<li>날씨(weather)는 값이 4인 것은 이상치 이므로 제거한다.</li>
<li>계절(season)은 달(month)와 같은 변수에서 나왔기에 단순한 계절(season)만 남긴다.</li>
</ul>
<ul>
<li>타깃(target)</li>
</ul>
<ul>
<li>count</li>
</ul>
<h2 id="STEP5-데이터-전처리"><a href="#STEP5-데이터-전처리" class="headerlink" title="STEP5. 데이터 전처리"></a>STEP5. 데이터 전처리</h2><ul>
<li>datetime으로부터 필요한 열 생성 : hour, dayofweek(month나 day는 의미없다)</li>
<li>causal과 registered 컬럼 제거</li>
<li>weather의 4인 값 제거</li>
<li>windspeed의 변수 보완</li>
<li>count의 아웃라이어 제거(3시그마를 초과하는 값을 이상치로 간주하고 제거)</li>
<li>atemp제거(temp와 별차이가 없다)</li>
<li>target인 count의 열 로그변환</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># datetime으로부터 필요한 열 생성 : hour, dayofweek(month나 day는 의미없다)</span></span><br><span class="line">train[<span class="string">&#x27;date&#x27;</span>] = pd.to_datetime(train[<span class="string">&#x27;datetime&#x27;</span>])</span><br><span class="line">train[<span class="string">&#x27;year&#x27;</span>] = train[<span class="string">&#x27;date&#x27;</span>].dt.year</span><br><span class="line">train[<span class="string">&#x27;hour&#x27;</span>] = train[<span class="string">&#x27;date&#x27;</span>].dt.hour</span><br><span class="line">train[<span class="string">&#x27;dayofweek&#x27;</span>] = train[<span class="string">&#x27;date&#x27;</span>].dt.dayofweek</span><br><span class="line"><span class="comment"># 불필요한 열 삭제</span></span><br><span class="line"><span class="keyword">del</span> train [<span class="string">&#x27;datetime&#x27;</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">del</span> train [<span class="string">&#x27;date&#x27;</span>]</span><br><span class="line">display(train.head())</span><br></pre></td></tr></table></figure>



  <div id="df-1bbf8d85-9f45-45d1-9c2c-f20d16cf8b0a">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>holiday</th>
      <th>workingday</th>
      <th>weather</th>
      <th>temp</th>
      <th>atemp</th>
      <th>humidity</th>
      <th>windspeed</th>
      <th>casual</th>
      <th>registered</th>
      <th>count</th>
      <th>year</th>
      <th>hour</th>
      <th>dayofweek</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>81</td>
      <td>0.0</td>
      <td>3</td>
      <td>13</td>
      <td>16</td>
      <td>2011</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.02</td>
      <td>13.635</td>
      <td>80</td>
      <td>0.0</td>
      <td>8</td>
      <td>32</td>
      <td>40</td>
      <td>2011</td>
      <td>1</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.02</td>
      <td>13.635</td>
      <td>80</td>
      <td>0.0</td>
      <td>5</td>
      <td>27</td>
      <td>32</td>
      <td>2011</td>
      <td>2</td>
      <td>5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>75</td>
      <td>0.0</td>
      <td>3</td>
      <td>10</td>
      <td>13</td>
      <td>2011</td>
      <td>3</td>
      <td>5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>75</td>
      <td>0.0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>2011</td>
      <td>4</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-1bbf8d85-9f45-45d1-9c2c-f20d16cf8b0a')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

<p>  &lt;svg xmlns&#x3D;”<a target="_blank" rel="noopener" href="http://www.w3.org/2000/svg&quot;">http://www.w3.org/2000/svg&quot;</a> height&#x3D;”24px”viewBox&#x3D;”0 0 24 24”<br>       width&#x3D;”24px”&gt;<br>    <path d="M0 0h24v24H0V0z" fill="none"/><br>    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/><br>  </svg><br>      </button></p>
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

<pre><code>  &lt;script&gt;
    const buttonEl =
      document.querySelector(&#39;#df-1bbf8d85-9f45-45d1-9c2c-f20d16cf8b0a button.colab-df-convert&#39;);
    buttonEl.style.display =
      google.colab.kernel.accessAllowed ? &#39;block&#39; : &#39;none&#39;;

    async function convertToInteractive(key) &#123;
      const element = document.querySelector(&#39;#df-1bbf8d85-9f45-45d1-9c2c-f20d16cf8b0a&#39;);
      const dataTable =
        await google.colab.kernel.invokeFunction(&#39;convertToInteractive&#39;,
                                                 [key], &#123;&#125;);
      if (!dataTable) return;

      const docLinkHtml = &#39;Like what you see? Visit the &#39; +
        &#39;&lt;a target=&quot;_blank&quot; href=https://colab.research.google.com/notebooks/data_table.ipynb&gt;data table notebook&lt;/a&gt;&#39;
        + &#39; to learn more about interactive tables.&#39;;
      element.innerHTML = &#39;&#39;;
      dataTable[&#39;output_type&#39;] = &#39;display_data&#39;;
      await google.colab.output.renderOutput(dataTable, element);
      const docLink = document.createElement(&#39;div&#39;);
      docLink.innerHTML = docLinkHtml;
      element.appendChild(docLink);
    &#125;
  &lt;/script&gt;
&lt;/div&gt;
</code></pre>
  </div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># causal과 registered 컬럼 제거</span></span><br><span class="line">train = train.drop([<span class="string">&#x27;casual&#x27;</span>,<span class="string">&#x27;registered&#x27;</span>],axis = <span class="number">1</span>)</span><br><span class="line">train.shape, test.shape</span><br></pre></td></tr></table></figure>




<pre><code>((10886, 12), (6493, 9))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1 weather 4값 제거</span></span><br><span class="line">train = train[train[<span class="string">&#x27;weather&#x27;</span>]!=<span class="number">4</span>].reset_index(drop = <span class="literal">True</span>)</span><br><span class="line">train.shape, test.shape<span class="comment"># test값을 건딜면 제출이 안되니 그냥 보존</span></span><br></pre></td></tr></table></figure>




<pre><code>((10885, 12), (6493, 9))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># count의 아웃라이어 제거(3시그마를 초과하는 값을 이상치로 간주하고 제거)</span></span><br><span class="line">train = train[train[<span class="string">&#x27;count&#x27;</span>] - train[<span class="string">&#x27;count&#x27;</span>].mean()&lt; <span class="number">3</span>*train[<span class="string">&#x27;count&#x27;</span>].std()]</span><br><span class="line">train.reset_index(inplace = <span class="literal">True</span>, drop = <span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(train.shape)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<pre><code>(10738, 12)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># target인 count열의 로그변환</span></span><br><span class="line">train[<span class="string">&#x27;count&#x27;</span>] = np.log1p(train[<span class="string">&#x27;count&#x27;</span>])</span><br><span class="line">display(train.head())</span><br></pre></td></tr></table></figure>



  <div id="df-444f55fc-3233-4b24-a1ec-30d643fd547c">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>holiday</th>
      <th>workingday</th>
      <th>weather</th>
      <th>temp</th>
      <th>atemp</th>
      <th>humidity</th>
      <th>windspeed</th>
      <th>count</th>
      <th>year</th>
      <th>hour</th>
      <th>dayofweek</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>81</td>
      <td>0.0</td>
      <td>2.833213</td>
      <td>2011</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.02</td>
      <td>13.635</td>
      <td>80</td>
      <td>0.0</td>
      <td>3.713572</td>
      <td>2011</td>
      <td>1</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.02</td>
      <td>13.635</td>
      <td>80</td>
      <td>0.0</td>
      <td>3.496508</td>
      <td>2011</td>
      <td>2</td>
      <td>5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>75</td>
      <td>0.0</td>
      <td>2.639057</td>
      <td>2011</td>
      <td>3</td>
      <td>5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>75</td>
      <td>0.0</td>
      <td>0.693147</td>
      <td>2011</td>
      <td>4</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-444f55fc-3233-4b24-a1ec-30d643fd547c')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

<p>  &lt;svg xmlns&#x3D;”<a target="_blank" rel="noopener" href="http://www.w3.org/2000/svg&quot;">http://www.w3.org/2000/svg&quot;</a> height&#x3D;”24px”viewBox&#x3D;”0 0 24 24”<br>       width&#x3D;”24px”&gt;<br>    <path d="M0 0h24v24H0V0z" fill="none"/><br>    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/><br>  </svg><br>      </button></p>
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

<pre><code>  &lt;script&gt;
    const buttonEl =
      document.querySelector(&#39;#df-444f55fc-3233-4b24-a1ec-30d643fd547c button.colab-df-convert&#39;);
    buttonEl.style.display =
      google.colab.kernel.accessAllowed ? &#39;block&#39; : &#39;none&#39;;

    async function convertToInteractive(key) &#123;
      const element = document.querySelector(&#39;#df-444f55fc-3233-4b24-a1ec-30d643fd547c&#39;);
      const dataTable =
        await google.colab.kernel.invokeFunction(&#39;convertToInteractive&#39;,
                                                 [key], &#123;&#125;);
      if (!dataTable) return;

      const docLinkHtml = &#39;Like what you see? Visit the &#39; +
        &#39;&lt;a target=&quot;_blank&quot; href=https://colab.research.google.com/notebooks/data_table.ipynb&gt;data table notebook&lt;/a&gt;&#39;
        + &#39; to learn more about interactive tables.&#39;;
      element.innerHTML = &#39;&#39;;
      dataTable[&#39;output_type&#39;] = &#39;display_data&#39;;
      await google.colab.output.renderOutput(dataTable, element);
      const docLink = document.createElement(&#39;div&#39;);
      docLink.innerHTML = docLinkHtml;
      element.appendChild(docLink);
    &#125;
  &lt;/script&gt;
&lt;/div&gt;
</code></pre>
  </div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 왜도확인 -&gt; +-2범위에 들어가므로 치우침이 없다.</span></span><br><span class="line"><span class="built_in">print</span>(train[<span class="string">&#x27;count&#x27;</span>].skew())</span><br></pre></td></tr></table></figure>

<pre><code>-0.8704448527723871
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 범주형 변수의 타입변환</span></span><br><span class="line">cate_name = [<span class="string">&#x27;weather&#x27;</span>,<span class="string">&#x27;season&#x27;</span>,<span class="string">&#x27;year&#x27;</span>,<span class="string">&#x27;hour&#x27;</span>,<span class="string">&#x27;dayofweek&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> cate_name:</span><br><span class="line">    train[c] = train[c].astype(<span class="string">&#x27;category&#x27;</span>)</span><br><span class="line">train.dtypes</span><br></pre></td></tr></table></figure>




<pre><code>season        category
holiday          int64
workingday       int64
weather       category
temp           float64
atemp          float64
humidity         int64
windspeed      float64
count          float64
year          category
hour          category
dayofweek     category
dtype: object
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(train.info())</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 10738 entries, 0 to 10737
Data columns (total 12 columns):
 #   Column      Non-Null Count  Dtype   
---  ------      --------------  -----   
 0   season      10738 non-null  category
 1   holiday     10738 non-null  int64   
 2   workingday  10738 non-null  int64   
 3   weather     10738 non-null  category
 4   temp        10738 non-null  float64 
 5   atemp       10738 non-null  float64 
 6   humidity    10738 non-null  int64   
 7   windspeed   10738 non-null  float64 
 8   count       10738 non-null  float64 
 9   year        10738 non-null  category
 10  hour        10738 non-null  category
 11  dayofweek   10738 non-null  category
dtypes: category(5), float64(4), int64(3)
memory usage: 641.3 KB
None
</code></pre>
<ul>
<li>test 데이터도 train 데이터와 동일한 작업을 해준다</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># datetime으로부터 필요한 열 생성 : hour, dayofweek(month나 day는 의미없다)</span></span><br><span class="line">test[<span class="string">&#x27;date&#x27;</span>] = pd.to_datetime(test[<span class="string">&#x27;datetime&#x27;</span>])</span><br><span class="line">test[<span class="string">&#x27;year&#x27;</span>] = test[<span class="string">&#x27;date&#x27;</span>].dt.year</span><br><span class="line">test[<span class="string">&#x27;hour&#x27;</span>] = test[<span class="string">&#x27;date&#x27;</span>].dt.hour</span><br><span class="line">test[<span class="string">&#x27;dayofweek&#x27;</span>] = test[<span class="string">&#x27;date&#x27;</span>].dt.dayofweek</span><br><span class="line"><span class="comment">#불필요한 열 삭제</span></span><br><span class="line"><span class="keyword">del</span> test [<span class="string">&#x27;datetime&#x27;</span>]</span><br><span class="line"><span class="keyword">del</span> test [<span class="string">&#x27;date&#x27;</span>]</span><br><span class="line">display(test.head())</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



  <div id="df-7f495a76-ee75-4609-b1cb-6f33686b3e83">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>holiday</th>
      <th>workingday</th>
      <th>weather</th>
      <th>temp</th>
      <th>atemp</th>
      <th>humidity</th>
      <th>windspeed</th>
      <th>year</th>
      <th>hour</th>
      <th>dayofweek</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>10.66</td>
      <td>11.365</td>
      <td>56</td>
      <td>26.0027</td>
      <td>2011</td>
      <td>0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>10.66</td>
      <td>13.635</td>
      <td>56</td>
      <td>0.0000</td>
      <td>2011</td>
      <td>1</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>10.66</td>
      <td>13.635</td>
      <td>56</td>
      <td>0.0000</td>
      <td>2011</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>10.66</td>
      <td>12.880</td>
      <td>56</td>
      <td>11.0014</td>
      <td>2011</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>10.66</td>
      <td>12.880</td>
      <td>56</td>
      <td>11.0014</td>
      <td>2011</td>
      <td>4</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-7f495a76-ee75-4609-b1cb-6f33686b3e83')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

<p>  &lt;svg xmlns&#x3D;”<a target="_blank" rel="noopener" href="http://www.w3.org/2000/svg&quot;">http://www.w3.org/2000/svg&quot;</a> height&#x3D;”24px”viewBox&#x3D;”0 0 24 24”<br>       width&#x3D;”24px”&gt;<br>    <path d="M0 0h24v24H0V0z" fill="none"/><br>    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/><br>  </svg><br>      </button></p>
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

<pre><code>  &lt;script&gt;
    const buttonEl =
      document.querySelector(&#39;#df-7f495a76-ee75-4609-b1cb-6f33686b3e83 button.colab-df-convert&#39;);
    buttonEl.style.display =
      google.colab.kernel.accessAllowed ? &#39;block&#39; : &#39;none&#39;;

    async function convertToInteractive(key) &#123;
      const element = document.querySelector(&#39;#df-7f495a76-ee75-4609-b1cb-6f33686b3e83&#39;);
      const dataTable =
        await google.colab.kernel.invokeFunction(&#39;convertToInteractive&#39;,
                                                 [key], &#123;&#125;);
      if (!dataTable) return;

      const docLinkHtml = &#39;Like what you see? Visit the &#39; +
        &#39;&lt;a target=&quot;_blank&quot; href=https://colab.research.google.com/notebooks/data_table.ipynb&gt;data table notebook&lt;/a&gt;&#39;
        + &#39; to learn more about interactive tables.&#39;;
      element.innerHTML = &#39;&#39;;
      dataTable[&#39;output_type&#39;] = &#39;display_data&#39;;
      await google.colab.output.renderOutput(dataTable, element);
      const docLink = document.createElement(&#39;div&#39;);
      docLink.innerHTML = docLinkHtml;
      element.appendChild(docLink);
    &#125;
  &lt;/script&gt;
&lt;/div&gt;
</code></pre>
  </div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test.info()</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 6493 entries, 0 to 6492
Data columns (total 11 columns):
 #   Column      Non-Null Count  Dtype  
---  ------      --------------  -----  
 0   season      6493 non-null   int64  
 1   holiday     6493 non-null   int64  
 2   workingday  6493 non-null   int64  
 3   weather     6493 non-null   int64  
 4   temp        6493 non-null   float64
 5   atemp       6493 non-null   float64
 6   humidity    6493 non-null   int64  
 7   windspeed   6493 non-null   float64
 8   year        6493 non-null   int64  
 9   hour        6493 non-null   int64  
 10  dayofweek   6493 non-null   int64  
dtypes: float64(3), int64(8)
memory usage: 558.1 KB
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1 weather 4값 제거</span></span><br><span class="line"><span class="comment">#test = test[test[&#x27;weather&#x27;]!=4].reset_index(drop = True)</span></span><br><span class="line"><span class="comment">#test.shape# test값을 건딜면 제출이 안되니 그냥 보존</span></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 범주형 변수의 타입변환</span></span><br><span class="line">cate_name1 = [<span class="string">&#x27;weather&#x27;</span>,<span class="string">&#x27;season&#x27;</span>,<span class="string">&#x27;year&#x27;</span>,<span class="string">&#x27;hour&#x27;</span>,<span class="string">&#x27;dayofweek&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> cate_name1:</span><br><span class="line">    test[c] = test[c].astype(<span class="string">&#x27;category&#x27;</span>)</span><br><span class="line">test.dtypes</span><br></pre></td></tr></table></figure>




<pre><code>season        category
holiday          int64
workingday       int64
weather       category
temp           float64
atemp          float64
humidity         int64
windspeed      float64
year          category
hour          category
dayofweek     category
dtype: object
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(test.info())</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 6493 entries, 0 to 6492
Data columns (total 11 columns):
 #   Column      Non-Null Count  Dtype   
---  ------      --------------  -----   
 0   season      6493 non-null   category
 1   holiday     6493 non-null   int64   
 2   workingday  6493 non-null   int64   
 3   weather     6493 non-null   category
 4   temp        6493 non-null   float64 
 5   atemp       6493 non-null   float64 
 6   humidity    6493 non-null   int64   
 7   windspeed   6493 non-null   float64 
 8   year        6493 non-null   category
 9   hour        6493 non-null   category
 10  dayofweek   6493 non-null   category
dtypes: category(5), float64(3), int64(3)
memory usage: 337.8 KB
None
</code></pre>
<h2 id="STEP-6-모델링"><a href="#STEP-6-모델링" class="headerlink" title="STEP 6.모델링"></a>STEP 6.모델링</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split, GridSearchCV</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LinearRegression, Ridge</span><br><span class="line"><span class="keyword">from</span> xgboost <span class="keyword">import</span> XGBRegressor</span><br><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestRegressor</span><br><span class="line"><span class="keyword">from</span> lightgbm <span class="keyword">import</span> LGBMRegressor</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> mean_squared_error</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> cross_validate</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> GridSearchCV</span><br><span class="line"><span class="keyword">from</span> sklearn.pipeline <span class="keyword">import</span> Pipeline, make_pipeline</span><br></pre></td></tr></table></figure>

<h3 id="예측모델"><a href="#예측모델" class="headerlink" title="예측모델"></a>예측모델</h3><ul>
<li>변수와 타겟값을 나눠 X,y 데이터를 만든다.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X = train.drop([<span class="string">&#x27;count&#x27;</span>],axis = <span class="number">1</span>)</span><br><span class="line">y = train[<span class="string">&#x27;count&#x27;</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>수치형 변수인 temp,atemp,humidity,windspeed에 스케일링을 한다.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line">ss=StandardScaler()</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 선형회귀모델</span></span><br><span class="line">lr_reg = LinearRegression()</span><br><span class="line"><span class="comment"># 피처에 대한 표준화 진행과 K-fold를 함께 진행</span></span><br><span class="line">pipe = make_pipeline(MinMaxScaler(),lr_reg)</span><br><span class="line">scores = cross_validate(pipe,X,y,cv=<span class="number">5</span>,</span><br><span class="line">                        scoring=<span class="string">&#x27;neg_mean_squared_error&#x27;</span>,return_train_score =<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;MSLE: &#123;0:.3f&#125;&quot;</span>.<span class="built_in">format</span>(np.mean(-scores[<span class="string">&#x27;test_score&#x27;</span>])))</span><br></pre></td></tr></table></figure>

<pre><code>MSLE: 1.056
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#rf</span></span><br><span class="line">np.random.seed(<span class="number">0</span>)</span><br><span class="line">rf = RandomForestRegressor(n_estimators = <span class="number">300</span>)</span><br><span class="line"><span class="comment"># 피처에 대한 표준화 진행과 K-fold를 함께 진행</span></span><br><span class="line">pipe = make_pipeline(MinMaxScaler(),rf)</span><br><span class="line">scores = cross_validate(pipe,X,y,cv=<span class="number">5</span>,</span><br><span class="line">                        scoring=<span class="string">&#x27;neg_mean_squared_error&#x27;</span>,return_train_score =<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;MSLE: &#123;0:.3f&#125;&quot;</span>.<span class="built_in">format</span>(np.mean(-scores[<span class="string">&#x27;test_score&#x27;</span>])))</span><br></pre></td></tr></table></figure>

<pre><code>MSLE: 0.225
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#LGBM</span></span><br><span class="line">lgbm = LGBMRegressor(n_estimators = <span class="number">500</span>, objective = <span class="string">&#x27;regression&#x27;</span>)</span><br><span class="line"><span class="comment"># 피처에 대한 표준화 진행과 K-fold를 함께 진행</span></span><br><span class="line">pipe = make_pipeline(MinMaxScaler(),lgbm)</span><br><span class="line">scores = cross_validate(pipe,X,y,cv=<span class="number">5</span>,</span><br><span class="line">                        scoring=<span class="string">&#x27;neg_mean_squared_error&#x27;</span>,return_train_score =<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;MSLE: &#123;0:.3f&#125;&quot;</span>.<span class="built_in">format</span>(np.mean(-scores[<span class="string">&#x27;test_score&#x27;</span>])))</span><br></pre></td></tr></table></figure>

<pre><code>MSLE: 0.183
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 피쳐 표준화</span></span><br><span class="line">minmax = MinMaxScaler()</span><br><span class="line">minmax.fit(X) <span class="comment"># 훈련셋 모수 분포 저장</span></span><br><span class="line">X_scaled = minmax.transform(X)</span><br><span class="line">X_test_scaled = minmax.transform(test)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 최종파라미터 튜닝된 모델로 학습</span></span><br><span class="line">lgbm = LGBMRegressor(n_estimators = <span class="number">300</span>, objective = <span class="string">&#x27;regression&#x27;</span>,</span><br><span class="line">                     learning_rate = <span class="number">0.1</span>, max_depth = <span class="number">3</span>, reg_lambda =<span class="number">1</span> ,subsample = <span class="number">0.5</span>, </span><br><span class="line">                     random_state = <span class="number">99</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 학습</span></span><br><span class="line">lgbm.fit(X_scaled, y)</span><br></pre></td></tr></table></figure>




<pre><code>LGBMRegressor(max_depth=3, n_estimators=300, objective=&#39;regression&#39;,
              random_state=99, reg_lambda=1, subsample=0.5)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test에 대한 예측</span></span><br><span class="line">pred = lgbm.predict(X_test_scaled)</span><br><span class="line">fpred = np.expm1(pred)<span class="comment"># 로그변환을 풀어줌</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#lgbm 모델의 feature importance</span></span><br><span class="line">imp = pd.DataFrame(&#123;<span class="string">&#x27;feature&#x27;</span>: test.columns,</span><br><span class="line">                   <span class="string">&#x27;coefficient&#x27;</span>:lgbm.feature_importances_&#125;)</span><br><span class="line">imp = imp.sort_values(by = <span class="string">&#x27;coefficient&#x27;</span>, ascending = <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">plt.barh(imp[<span class="string">&#x27;feature&#x27;</span>],imp[<span class="string">&#x27;coefficient&#x27;</span>])</span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><img src="/images/bikesd_220711/output_77_0.png" alt="png"></p>
<ul>
<li>피처의 중요도를 뽑아봤을때 역시 hour가 가장 높은 기여도로 나왔다.</li>
</ul>
<h2 id="STEP7-제출"><a href="#STEP7-제출" class="headerlink" title="STEP7. 제출"></a>STEP7. 제출</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">del</span> submission[<span class="string">&#x27;count&#x27;</span>]</span><br><span class="line">submission[<span class="string">&#x27;count&#x27;</span>] =fpred</span><br><span class="line"></span><br><span class="line"><span class="comment">#submission.to_csv(&#x27;submission.csv&#x27;,index=False)</span></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">submission.head()</span><br></pre></td></tr></table></figure>





  <div id="df-7fa8931c-8dc7-4b8d-aea5-9bf16a3575e2">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>datetime</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2011-01-20 00:00:00</td>
      <td>8.674224</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2011-01-20 01:00:00</td>
      <td>4.650374</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2011-01-20 02:00:00</td>
      <td>2.842267</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2011-01-20 03:00:00</td>
      <td>1.616020</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2011-01-20 04:00:00</td>
      <td>1.506303</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-7fa8931c-8dc7-4b8d-aea5-9bf16a3575e2')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

<p>  &lt;svg xmlns&#x3D;”<a target="_blank" rel="noopener" href="http://www.w3.org/2000/svg&quot;">http://www.w3.org/2000/svg&quot;</a> height&#x3D;”24px”viewBox&#x3D;”0 0 24 24”<br>       width&#x3D;”24px”&gt;<br>    <path d="M0 0h24v24H0V0z" fill="none"/><br>    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/><br>  </svg><br>      </button></p>
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

<pre><code>  &lt;script&gt;
    const buttonEl =
      document.querySelector(&#39;#df-7fa8931c-8dc7-4b8d-aea5-9bf16a3575e2 button.colab-df-convert&#39;);
    buttonEl.style.display =
      google.colab.kernel.accessAllowed ? &#39;block&#39; : &#39;none&#39;;

    async function convertToInteractive(key) &#123;
      const element = document.querySelector(&#39;#df-7fa8931c-8dc7-4b8d-aea5-9bf16a3575e2&#39;);
      const dataTable =
        await google.colab.kernel.invokeFunction(&#39;convertToInteractive&#39;,
                                                 [key], &#123;&#125;);
      if (!dataTable) return;

      const docLinkHtml = &#39;Like what you see? Visit the &#39; +
        &#39;&lt;a target=&quot;_blank&quot; href=https://colab.research.google.com/notebooks/data_table.ipynb&gt;data table notebook&lt;/a&gt;&#39;
        + &#39; to learn more about interactive tables.&#39;;
      element.innerHTML = &#39;&#39;;
      dataTable[&#39;output_type&#39;] = &#39;display_data&#39;;
      await google.colab.output.renderOutput(dataTable, element);
      const docLink = document.createElement(&#39;div&#39;);
      docLink.innerHTML = docLinkHtml;
      element.appendChild(docLink);
    &#125;
  &lt;/script&gt;
&lt;/div&gt;
</code></pre>
  </div>



</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/page/0/">Previous</a></div><div class="pagination-next"><a href="/page/2/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/">1</a></li><li><a class="pagination-link" href="/page/2/">2</a></li><li><a class="pagination-link" href="/page/3/">3</a></li><li><a class="pagination-link" href="/page/4/">4</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="CHAI JE HYUNG"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">CHAI JE HYUNG</p><p class="is-size-6 is-block">GOD IS GOOD ALL THE TIME</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>SEOUL.KOREA</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">32</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/westar99" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/westar99"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://www.facebook.com/jehyung.chai"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-07-27T22:58:32.000Z">2022-07-28</time></p><p class="title"><a href="/2022/07/28/220728/"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-07-27T08:07:35.835Z">2022-07-27</time></p><p class="title"><a href="/2022/07/27/day0726/"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-07-26T22:59:24.000Z">2022-07-27</time></p><p class="title"><a href="/2022/07/27/220727/"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-07-25T08:12:31.638Z">2022-07-25</time></p><p class="title"><a href="/2022/07/25/day0725/"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-07-21T08:02:00.887Z">2022-07-21</time></p><p class="title"><a href="/2022/07/21/day0721/"> </a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2022/07/"><span class="level-start"><span class="level-item">July 2022</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/06/"><span class="level-start"><span class="level-item">June 2022</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="CHAI JEHYUNG" height="28"></a><p class="is-size-7"><span>&copy; 2022 John Doe</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>